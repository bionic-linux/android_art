{
  "comments": [
    {
      "key": {
        "uuid": "4f1f2087_7aef31b1",
        "filename": "adbconnection/Android.bp",
        "patchSetId": 5
      },
      "lineNbr": 59,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-12-16T20:51:29Z",
      "side": 1,
      "message": "I\u0027d prefer to put this in art_defaults instead to cut down on the boilerplate. It does mean a bit less fine-grained checks on what goes into the release and debug APEXes, but since we\u0027ve got art_apex_test.py there\u0027s good testing on that anyway. +rpl for opinion.",
      "range": {
        "startLine": 56,
        "startChar": 0,
        "endLine": 59,
        "endChar": 6
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0416c1b6_88ece624",
        "filename": "adbconnection/Android.bp",
        "patchSetId": 5
      },
      "lineNbr": 59,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-12-17T03:13:26Z",
      "side": 1,
      "message": "There are several modules using art_defaults that actually should be available to platform. When I actually moved this to art_defaults, following errors occurred.\n\nerror: art/tools/cpp-define-generator/Android.bp:37:1: failed to find variation \"\" for module \"asm_defines.s\" needed by \"cpp-define-generator-asm-support\"\nerror: system/core/adb/Android.bp:340:1: failed to find variation \"\" for module \"libadbconnection_server\" needed by \"libadbd_core\"\nerror: frameworks/native/vulkan/libvulkan/Android.bp:31:1: failed to find variation \"\" for module \"libnativebridge_lazy\" needed by \"libvulkan\"\n\n...\n\nI had to add \u0027apex_available: [\"//apex_available:platform\"]\u0027 to many of the places, which I don\u0027t think should be the preferred path.",
      "parentUuid": "4f1f2087_7aef31b1",
      "range": {
        "startLine": 56,
        "startChar": 0,
        "endLine": 59,
        "endChar": 6
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c7723df_65a7de13",
        "filename": "adbconnection/Android.bp",
        "patchSetId": 5
      },
      "lineNbr": 59,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-12-17T17:31:44Z",
      "side": 1,
      "message": "Sorry, still have a couple of questions:\n\n- Is that the kind of error one gets when there\u0027s a missing //apex_available:platform directive? What\u0027s the \"\" variation and why/how do apex_available affect the variations?\n\n- Even when we got a module SDK fully set up with sdk{} modules, we\u0027ll still need //apex_available:platform on the libs that constitute the SDK, right?\n\n\u003e I had to add \u0027apex_available: [\"//apex_available:platform\"]\u0027 to many of the places, which I don\u0027t think should be the preferred path.\n\nWhy not? ART APEX availability is more restrictive so I\u0027d rather have that as the default in the art/ tree, and //apex_available:platform explicitly on the libs that need to go into the SDK.",
      "parentUuid": "0416c1b6_88ece624",
      "range": {
        "startLine": 56,
        "startChar": 0,
        "endLine": 59,
        "endChar": 6
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a941b25d_1476c1cb",
        "filename": "adbconnection/Android.bp",
        "patchSetId": 5
      },
      "lineNbr": 59,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-12-18T05:10:32Z",
      "side": 1,
      "message": "\u003e Is that the kind of error one gets when there\u0027s a missing //apex_available:platform directive? What\u0027s the \"\" variation and why/how do apex_available affect the variations?\n\nThe \"\" variation is for the platform (the non-updatable part). The default value for apex_available is [\"//apex_available:platform\", \"//apex_available:any_apex\"], which means the module is by default available for the platform as well as any apex. In that case, the platform and apex variants are created whenever there is a need. However, when apex_available is set to a certain set of apexes like here, only the apex variants for the specified apexes are created. Since \"//apex_available:platform\" is missing here, the platform variant is not created and it fails to satisfy the dependency from other platform libraries.\n\n\u003e Even when we got a module SDK fully set up with sdk{} modules, we\u0027ll still need //apex_available:platform on the libs that constitute the SDK, right?\n\nEven with sdk modules, this is needed. This could be unnecessary only after we unbundle the entire ART source tree. Then these modules won\u0027t be available to anywhere other than ART because the source code itself isn\u0027t exported.\n\n\u003e Why not? ART APEX availability is more restrictive so I\u0027d rather have that as the default in the art/ tree, and //apex_available:platform explicitly on the libs that need to go into the SDK.\n\nI think both whitelist-based or blacklist-based approaches would work. I just have chosen the blacklist-based approach because I thought it is the easier path. In the future, if the team wants a stronger restriction, it\u0027d be fine to switch to the whitelist-based approach.",
      "parentUuid": "0c7723df_65a7de13",
      "range": {
        "startLine": 56,
        "startChar": 0,
        "endLine": 59,
        "endChar": 6
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0a42a1d5_a7493bbf",
        "filename": "build/Android.common_path.mk",
        "patchSetId": 5
      },
      "lineNbr": 116,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-12-16T20:51:29Z",
      "side": 1,
      "message": "Nit: This rather belongs in the change description.",
      "range": {
        "startLine": 114,
        "startChar": 70,
        "endLine": 116,
        "endChar": 58
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ba59358_c858a1ff",
        "filename": "build/Android.common_path.mk",
        "patchSetId": 5
      },
      "lineNbr": 116,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-12-17T03:23:50Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "0a42a1d5_a7493bbf",
      "range": {
        "startLine": 114,
        "startChar": 70,
        "endLine": 116,
        "endChar": 58
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e54593e8_1f75329d",
        "filename": "build/Android.common_path.mk",
        "patchSetId": 5
      },
      "lineNbr": 119,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-12-16T20:51:29Z",
      "side": 1,
      "message": "Since this is specifically listing the libs in the debug APEX, it\u0027d be more clear to rename it to something like ART_DEBUG_TARGET_SHARED_LIBRARY_DEPENDENCIES.",
      "range": {
        "startLine": 119,
        "startChar": 0,
        "endLine": 119,
        "endChar": 38
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05343c2c_dc041e64",
        "filename": "build/Android.common_path.mk",
        "patchSetId": 5
      },
      "lineNbr": 119,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-12-17T03:23:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e54593e8_1f75329d",
      "range": {
        "startLine": 119,
        "startChar": 0,
        "endLine": 119,
        "endChar": 38
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "377b4482_16c79d16",
        "filename": "build/Android.gtest.mk",
        "patchSetId": 5
      },
      "lineNbr": 505,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-12-16T20:51:29Z",
      "side": 1,
      "message": "Dito.",
      "range": {
        "startLine": 503,
        "startChar": 78,
        "endLine": 505,
        "endChar": 60
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0da92a8f_a5edf7e8",
        "filename": "build/Android.gtest.mk",
        "patchSetId": 5
      },
      "lineNbr": 505,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-12-17T03:23:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "377b4482_16c79d16",
      "range": {
        "startLine": 503,
        "startChar": 78,
        "endLine": 505,
        "endChar": 60
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "03770417_7f83e985",
        "filename": "libartbase/Android.bp",
        "patchSetId": 5
      },
      "lineNbr": 176,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-12-16T20:51:29Z",
      "side": 1,
      "message": "Please point to b/142944931 instead. Also suggest using the TODO(b/xxx) syntax. (Same goes for the other places where this comment occurs.)",
      "range": {
        "startLine": 176,
        "startChar": 11,
        "endLine": 176,
        "endChar": 22
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "444ee5d8_a2ca5db2",
        "filename": "libartbase/Android.bp",
        "patchSetId": 5
      },
      "lineNbr": 176,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-12-17T03:23:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "03770417_7f83e985",
      "range": {
        "startLine": 176,
        "startChar": 11,
        "endLine": 176,
        "endChar": 22
      },
      "revId": "03c16d2ba6ee784fdf1e3072059a7e9d15f0f925",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}