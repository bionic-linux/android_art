{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d176682b_8c7a8189",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-11-24T09:08:45Z",
      "side": 1,
      "message": "Thanks for the patch! I think the fact we\u0027re acquiring a Java monitor here is dubious in the first place. Do you know why we\u0027re doing it?",
      "revId": "62312db059a7875624533e936c474db551f3add3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "91179eec_65cc4465",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1090013
      },
      "writtenOn": "2021-11-24T09:54:02Z",
      "side": 1,
      "message": "I got your point, I don\u0027t know whether I make it correctly, but since UpdateClass() is going to acess \u0026 modify class object, acquiring class object as the monitor could protect against multiple redefinition requests(targeting the same class) in different threads?",
      "parentUuid": "d176682b_8c7a8189",
      "revId": "62312db059a7875624533e936c474db551f3add3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b6a1acfe_17c7176b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-11-24T09:55:45Z",
      "side": 1,
      "message": "You\u0027re right, and that\u0027s likely why the author of that code decided to take that lock. But I\u0027m questioning why we\u0027re taking a user-visible lock, instead of an internal one.",
      "parentUuid": "91179eec_65cc4465",
      "revId": "62312db059a7875624533e936c474db551f3add3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a8c92451_67e85daa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1090013
      },
      "writtenOn": "2021-11-24T10:02:08Z",
      "side": 1,
      "message": "Yeah, it sounds like a trade-off here, since an internal \u0026 global one may block all the redefinitions (no matter whether the target class is the same or not), it does make sense at the first place to use the class object as the lock just because it has the proper granularity?",
      "parentUuid": "b6a1acfe_17c7176b",
      "revId": "62312db059a7875624533e936c474db551f3add3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4a82d0ea_85598070",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1894735
      },
      "writtenOn": "2021-11-24T11:00:47Z",
      "side": 1,
      "message": "Thanks! lgtm. If there is a test case that was failing maybe you can add the test name and the config in which it was failing to the Test: in CL description.",
      "revId": "62312db059a7875624533e936c474db551f3add3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31e97f36_7c789144",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1894735
      },
      "writtenOn": "2021-11-24T11:00:47Z",
      "side": 1,
      "message": "I don\u0027t understand this fully too but UpdateClass is called in art::ScopedSuspendAll scope. So I guess we don\u0027t need to worry about multiple redefinitions in parallel there? Though I guess we also don\u0027t want to have multiple CheckClass concurrently too for ex: a redefinition of the class might invalidate earlier checks which is why we need some kind of lock. Though I agree it\u0027s better to use internal locks for these cases.",
      "parentUuid": "a8c92451_67e85daa",
      "revId": "62312db059a7875624533e936c474db551f3add3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d151dde2_26179cae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1090013
      },
      "writtenOn": "2021-11-27T11:40:45Z",
      "side": 1,
      "message": "Done. There is no case failing with patch set 3.",
      "parentUuid": "4a82d0ea_85598070",
      "revId": "62312db059a7875624533e936c474db551f3add3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}