{
  "comments": [
    {
      "key": {
        "uuid": "ad59120c_14fdeba5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2018-11-22T16:03:48Z",
      "side": 1,
      "message": "Could you add:\n\n  Bug: 113373927\n\nhere?",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "29e2351e_40094bd1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-24T00:24:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ad59120c_14fdeba5",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ccaeb40e_87f0cc23",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-22T15:43:06Z",
      "side": 1,
      "message": "Tried \"dex2oat -h\" from this directory, and I see in the linker debug that it still loads all libs from /system/${LIB}. Verified that this file is in /apex/com.android.runtime/etc. Shouldn\u0027t it work better?",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "02787be0_e6d26bca",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-11-22T16:43:27Z",
      "side": 1,
      "message": "Hmm, I have no idea. That worked for me though. Perhaps selinux denial? What is the label of this file? Is it accessible to the app?",
      "parentUuid": "ccaeb40e_87f0cc23",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "24865dac_4df7d418",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-22T17:52:16Z",
      "side": 1,
      "message": "Shouldn\u0027t be selinux - I\u0027ve actually disabled it completely to test this, while rpl@ is working on getting the selinux config in order.\n\n\u003e What is the label of this file? Is it accessible to the app?\n\nSorry, I don\u0027t know what you mean with label there. Permission bits look ok:\n\ntaimen:/ # ls -la /apex/com.android.runtime/                                                                                                     \ntotal 68\ndrwxr-xr-x 7 system system  4096 1970-01-01 01:00 .\ndrwxr-xr-x 6 root   root     120 2018-11-07 21:04 ..\ndrwxr-xr-x 2 system system  4096 1970-01-01 01:00 bin\ndrwxr-xr-x 2 system system  4096 1970-01-01 01:00 etc\ndrwxr-xr-x 2 system system  4096 1970-01-01 01:00 lib\ndrwxr-xr-x 2 system system  4096 1970-01-01 01:00 lib64\ndrwx------ 2 root   root   16384 2018-11-22 14:11 lost+found\n-rw-r--r-- 1 system system    52 1970-01-01 01:00 manifest.json\ntaimen:/ # ls -la /apex/com.android.runtime/etc/                                                                                                 \ntotal 24\ndrwxr-xr-x 2 system system 4096 1970-01-01 01:00 .\ndrwxr-xr-x 7 system system 4096 1970-01-01 01:00 ..\n-rw-r--r-- 1 system system 1090 1970-01-01 01:00 ld.config.txt\ntaimen:/ # ls -la /apex/com.android.runtime/bin/dex2oat                                                                                          \n-rwxr-xr-x 1 system system 539772 1970-01-01 01:00 /apex/com.android.runtime/bin/dex2oat\ntaimen:/ # id\nuid\u003d0(root) gid\u003d0(root) groups\u003d0(root),1004(input),1007(log),1011(adb),1015(sdcard_rw),1028(sdcard_r),3001(net_bt_admin),3002(net_bt),3003(inet),3006(net_bw_stats),3009(readproc),3011(uhid) context\u003du:r:su:s0\n\nHere\u0027s the logcat output: http://gpaste/6347587183443968",
      "parentUuid": "02787be0_e6d26bca",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86a28330_6a06f964",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-11-23T02:26:40Z",
      "side": 1,
      "message": "I meant selinux label, which can be shown with -Z option. (ls -Z ...)",
      "parentUuid": "24865dac_4df7d418",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f571d7a_bffae46e",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-24T00:24:02Z",
      "side": 1,
      "message": "As I said, I believe I\u0027ve disabled SELinux. Nevertheless, here are the -Z outputs (I\u0027ll need to read up on SELinux):\n\ntaimen:/apex/com.android.runtime # ls -lZ                                                                                                        \ntotal 60\ndrwxr-xr-x 2 system system u:object_r:system_file:s0      4096 1970-01-01 01:00 bin\ndrwxr-xr-x 2 system system u:object_r:system_file:s0      4096 1970-01-01 01:00 etc\ndrwxr-xr-x 2 system system u:object_r:system_lib_file:s0  4096 1970-01-01 01:00 lib\ndrwxr-xr-x 2 system system u:object_r:system_lib_file:s0  4096 1970-01-01 01:00 lib64\ndrwx------ 2 root   root   u:object_r:system_file:s0     16384 2018-11-23 16:14 lost+found\n-rw-r--r-- 1 system system u:object_r:system_file:s0        52 1970-01-01 01:00 manifest.json\ntaimen:/apex/com.android.runtime # ls -lZ bin/dex2oat                                                                                            \n-rwxr-xr-x 1 system system u:object_r:dex2oat_exec:s0 539772 1970-01-01 01:00 bin/dex2oat\ntaimen:/apex/com.android.runtime # ls -lZ etc/ld.config.txt                                                                                      \n-rw-r--r-- 1 system system u:object_r:system_file:s0 894 1970-01-01 01:00 etc/ld.config.txt",
      "parentUuid": "86a28330_6a06f964",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fb3609f6_db362d3d",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-30T14:30:14Z",
      "side": 1,
      "message": "Opened b/120267645 for this. It looks like a bug in the linker, but I\u0027m not sure since my testing setup is slightly hacked up.",
      "parentUuid": "7f571d7a_bffae46e",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8bef69e2_931db4e6",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-12-03T20:47:37Z",
      "side": 1,
      "message": "As you spotted, this was due to a typo of mine. Filed http://b/120430775 about better debug logging.",
      "parentUuid": "fb3609f6_db362d3d",
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b61b7abc_1d35d63a",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-22T15:43:06Z",
      "side": 1,
      "message": "We need some sort of expansion here to deal with this version number and the one in the search path below, right?",
      "range": {
        "startLine": 2,
        "startChar": 39,
        "endLine": 2,
        "endChar": 41
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af77bbd0_7fb6a2e7",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2018-11-22T16:03:48Z",
      "side": 1,
      "message": "Why is this needed?",
      "parentUuid": "b61b7abc_1d35d63a",
      "range": {
        "startLine": 2,
        "startChar": 39,
        "endLine": 2,
        "endChar": 41
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d765995_fb77db4e",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2018-11-22T16:19:39Z",
      "side": 1,
      "message": "Versioning like this might have been discussed at some point, but am of the understanding that the path without the suffix refers to the current version.",
      "parentUuid": "af77bbd0_7fb6a2e7",
      "range": {
        "startLine": 2,
        "startChar": 39,
        "endLine": 2,
        "endChar": 41
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "395e69fc_9e616b3c",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-22T16:36:41Z",
      "side": 1,
      "message": "The reason for this line is to pick the right linker config if a binary is started as /apex/com.android.runtime@1/bin/foo, regardless what\u0027s mounted on /apex/com.android.runtime.",
      "parentUuid": "4d765995_fb77db4e",
      "range": {
        "startLine": 2,
        "startChar": 39,
        "endLine": 2,
        "endChar": 41
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0900113f_ee2f3ae2",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-11-22T16:43:27Z",
      "side": 1,
      "message": "I don\u0027t think you need @1. You will always run art tools from /apex/com.android.runtime/bin.\n\n@1 directory is for the cases where having multiple versions of the same APEX makes sense, which isn\u0027t true for ART.",
      "parentUuid": "395e69fc_9e616b3c",
      "range": {
        "startLine": 2,
        "startChar": 39,
        "endLine": 2,
        "endChar": 41
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52aedd97_fcce03f7",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-22T17:52:16Z",
      "side": 1,
      "message": "Good, that simplifies matters. I assumed several could be mounted temporarily during upgrades or rollbacks.\n\nIf we\u0027re making that assumption in this APEX, it\u0027d be good to make it explicit with a property in the manifest too. Then it\u0027d be nice if apexd didn\u0027t mount it on @1 at all, to avoid uncertainty about this.",
      "parentUuid": "0900113f_ee2f3ae2",
      "range": {
        "startLine": 2,
        "startChar": 39,
        "endLine": 2,
        "endChar": 41
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0e518c50_4745f106",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-24T00:24:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "52aedd97_fcce03f7",
      "range": {
        "startLine": 2,
        "startChar": 39,
        "endLine": 2,
        "endChar": 41
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ed702083_88aab807",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2018-11-22T16:03:48Z",
      "side": 1,
      "message": "Shouldn\u0027t we use\n\n  com.android.runtime\n\nhere?",
      "range": {
        "startLine": 9,
        "startChar": 38,
        "endLine": 9,
        "endChar": 59
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d82fc9c_bf6a1103",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-22T16:36:41Z",
      "side": 1,
      "message": "Then a binary in /apex/com.android.runtime@1/bin/ could link to libraries in /apex/com.android.runtime@2/${LIB}, if that\u0027s what mounted on /apex/com.android.runtime.\n\nIt\u0027d be more correct to use a relative path ../${LIB} here, providing the linker would resolve it relative to the directory of the binary. I\u0027ve seen no sign that that would work though.",
      "parentUuid": "ed702083_88aab807",
      "range": {
        "startLine": 9,
        "startChar": 38,
        "endLine": 9,
        "endChar": 59
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f0d4d80b_94808352",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-24T00:24:02Z",
      "side": 1,
      "message": "Changed as per discussion above.",
      "parentUuid": "4d82fc9c_bf6a1103",
      "range": {
        "startLine": 9,
        "startChar": 38,
        "endLine": 9,
        "endChar": 59
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a151950d_1f60243f",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-12-01T05:28:47Z",
      "side": 1,
      "message": "this should be paths not path.",
      "range": {
        "startLine": 9,
        "startChar": 25,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d325bbb7_e68fb896",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-12-03T20:47:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a151950d_1f60243f",
      "range": {
        "startLine": 9,
        "startChar": 25,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df4f6a_e2ce6a7b",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-22T15:43:06Z",
      "side": 1,
      "message": "This is a small subset of the paths and other setup for the default namespace in the [system] section in /system/etc/ld.config.txt. How much of it do we need here?",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 16,
        "endChar": 48
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d22582b_6d53bf3e",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-11-24T00:24:02Z",
      "side": 1,
      "message": "I\u0027m particularly unsure whether we need to include some amount of system/vendor directories to ensure PALette dependencies are satisfied. I see for instance this in rootdir/etc/ld.config.txt:\n\n/.../\n# These are where odex files are located. libart has to be able to dlopen the files\nnamespace.default.permitted.paths +\u003d /system/framework\nnamespace.default.permitted.paths +\u003d /system/app\n/.../\n\nOrion?",
      "parentUuid": "f7df4f6a_e2ce6a7b",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 16,
        "endChar": 48
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b6ccf46_7de72678",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-12-07T12:29:18Z",
      "side": 1,
      "message": "Since this will only be used by the binaries in the APEX I don\u0027t think we need paths for all the framework stuff here. Let\u0027s at least start with this and iterate.",
      "parentUuid": "4d22582b_6d53bf3e",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 16,
        "endChar": 48
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "52ed64f7_f0282cbb",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-12-08T05:39:19Z",
      "side": 1,
      "message": "IIRC, /system/framework or /system/app were required in order to dlopen pre-compiled oat file by the zygote.\nIf dex2oat needs access to them, they should be put here.",
      "parentUuid": "8b6ccf46_7de72678",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 16,
        "endChar": 48
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2a059ab_c2551ae8",
        "filename": "build/apex/ld.config.txt",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2018-12-10T22:39:46Z",
      "side": 1,
      "message": "Noted. I\u0027m not sure about that, but as I said I think we can start with this and iterate - no need to block on it.",
      "parentUuid": "52ed64f7_f0282cbb",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 16,
        "endChar": 48
      },
      "revId": "f74f8634f4e7566f9f1a2c4d0d8a2fd6296f892a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}