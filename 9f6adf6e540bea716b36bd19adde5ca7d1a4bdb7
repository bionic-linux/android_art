{
  "comments": [
    {
      "key": {
        "uuid": "0b993cf9_bf8af384",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 2
      },
      "lineNbr": 78,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2015-02-18T22:01:27Z",
      "side": 1,
      "message": "This isn\u0027t a warning. It\u0027s at most an INFO.",
      "range": {
        "startLine": 78,
        "startChar": 4,
        "endLine": 78,
        "endChar": 73
      },
      "revId": "9f6adf6e540bea716b36bd19adde5ca7d1a4bdb7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6b6398c4_bd04c7f9",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 2
      },
      "lineNbr": 99,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2015-02-18T22:01:27Z",
      "side": 1,
      "message": "No.\n\nThis won\u0027t clean up the cache when we really should. When you generate an image, you should clean up. When we\u0027re running out of space, you should. When we had an error situation, clean up. Don\u0027t leave old files around with the hope it gets better next time.",
      "range": {
        "startLine": 91,
        "startChar": 0,
        "endLine": 99,
        "endChar": 1
      },
      "revId": "9f6adf6e540bea716b36bd19adde5ca7d1a4bdb7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "083302f6_0c0f37dd",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 2
      },
      "lineNbr": 99,
      "author": {
        "id": 1064833
      },
      "writtenOn": "2015-02-25T08:29:51Z",
      "side": 1,
      "message": "The .preloaded is removed as soon as the first boot is completed\n(https://android-review.googlesource.com/#/c/133132)\nIf we did not succeed to boot, .booting will still be there and we will flush the dalvik-cache. This will be performed by the RealPruneDalvikCache in MarkZygoteStart.\nKept as is, the dalvik-cache is always wiped on first boot even though the images are valid.\nI will investigate other solutions available to avoid this.",
      "parentUuid": "6b6398c4_bd04c7f9",
      "range": {
        "startLine": 91,
        "startChar": 0,
        "endLine": 99,
        "endChar": 1
      },
      "revId": "9f6adf6e540bea716b36bd19adde5ca7d1a4bdb7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c549d54e_b2a220ba",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 2
      },
      "lineNbr": 99,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2015-02-25T16:27:52Z",
      "side": 1,
      "message": "It is bad practice to rely on a reboot to clean (especially now that there\u0027s a counter for .booting). That has always been a quick-n-dirty thing to hopefully get back to a booting system.\n\nThis changes current behavior more than necessary. As mentioned before, there are various places where PruneDalvikCache should clean the cache, no matter what. Example is in GenerateImage. When you are generating a new image, the preloaded files are almost guaranteed out of date.\n\n(In the absence of a proof of determinism for dex2oat, my understanding was that you pre-opt the boot image into /system or /data and do not try to compile it on device.)\n\nWith that understanding, the only invocation that should change behavior is the one in RelocateImage, as far as I can see. All others are in a situation where we either know that:\n\n a) the boot image will likely *not* be what it was at preopt time\n b) we ran into an error while trying to use it (e.g., patch it)\n\nIn those cases we *should* clean up.\n\nThis is relatively easy to incorporate by either just changing the code in RelocateImage, or adding another function. This one should at least have a name change anyways to include the new behavior somehow.\n\nbdc, any opinions?",
      "parentUuid": "083302f6_0c0f37dd",
      "range": {
        "startLine": 91,
        "startChar": 0,
        "endLine": 99,
        "endChar": 1
      },
      "revId": "9f6adf6e540bea716b36bd19adde5ca7d1a4bdb7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}