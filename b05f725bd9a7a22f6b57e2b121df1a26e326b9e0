{
  "comments": [
    {
      "key": {
        "uuid": "7f526d24_3ab46978",
        "filename": "compiler/dex/quick/gen_invoke.cc",
        "patchSetId": 3
      },
      "lineNbr": 820,
      "author": {
        "id": 1042649
      },
      "writtenOn": "2014-11-25T07:02:54Z",
      "side": 1,
      "message": "This is a bit different with the original code, and it is better since it avoids duplicated copy.\n\nBut I think the correct algorithm should be :\n  first_after_last_mapped_in +\u003d adjust;\n  regs_left_to_pass_via_stack -\u003d adjust;\n  regs_left_to_pass_via_stack \u003d GenDalvikArgsBulkCopy(info, first_after_last_mapped_in, regs_left_to_pass_via_stack);\n\nOtherwise, first_after_last_mapped_in + regs_left_to_pass_via_stack will be wrong which is used by the below loop which handles the stack arguments. But maybe we need to find a better name for first_after_last_mapped_in, for example, stack_map_start.",
      "range": {
        "startLine": 820,
        "startChar": 82,
        "endLine": 820,
        "endChar": 91
      },
      "revId": "b05f725bd9a7a22f6b57e2b121df1a26e326b9e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f526d24_baa7394b",
        "filename": "compiler/dex/quick/gen_invoke.cc",
        "patchSetId": 3
      },
      "lineNbr": 820,
      "author": {
        "id": 1040038
      },
      "writtenOn": "2014-11-25T07:55:22Z",
      "side": 1,
      "message": "In both loops below (for stack and reg arguments) we are starting from the first parameter and iterates by the size of the argument. split wide we\u0027d like to handle in reg handling part. So consider the cases:\n1) no split of last wide arg. Then no problem at all. In the loop below we are iterating from the beginning up to the end (if bulk did not copied) or till the last mapped (if bulk did its job).\n2) last wide is split. In the loop for stack we sill iterate from the beginning up to the end (if bulk did not copied) and split will be skipped because we increment iterator by argument size and we will not consider high part (for the low part valid register will be reported). Or up to the last mapped. split will be skipped as well.\n\nNow in the reg part we will iterate up to the last mapped (which is low part) and will handle high part there.\n\nSo everything seems correct to me.",
      "parentUuid": "7f526d24_3ab46978",
      "range": {
        "startLine": 820,
        "startChar": 82,
        "endLine": 820,
        "endChar": 91
      },
      "revId": "b05f725bd9a7a22f6b57e2b121df1a26e326b9e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f526d24_7a9301e8",
        "filename": "compiler/dex/quick/gen_invoke.cc",
        "patchSetId": 3
      },
      "lineNbr": 820,
      "author": {
        "id": 1042649
      },
      "writtenOn": "2014-11-25T08:15:09Z",
      "side": 1,
      "message": "The problem is not on the high part split register. There is problem with the last stack register.\n\nFor example, we have the map like, 012(register/stack) 3(high part of 2) 456(stack). first_after_last_mapped_in \u003d 3, regs_left_to_pass_via_stack \u003d 4, adjust \u003d 1. It is correct without adjustment.\n\nAfter GenDalvikArgsBulkCopy(info, 3+1, 4-1), if we copied nothing in the function, regs_left_to_pass_via_stack becomes **3**. It will introduce bug in the next loop. See below comments.",
      "parentUuid": "7f526d24_baa7394b",
      "range": {
        "startLine": 820,
        "startChar": 82,
        "endLine": 820,
        "endChar": 91
      },
      "revId": "b05f725bd9a7a22f6b57e2b121df1a26e326b9e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "df3a79c4_c5ad7afb",
        "filename": "compiler/dex/quick/gen_invoke.cc",
        "patchSetId": 3
      },
      "lineNbr": 820,
      "author": {
        "id": 1040038
      },
      "writtenOn": "2014-11-25T09:27:57Z",
      "side": 1,
      "message": "Got it, you are right.",
      "parentUuid": "7f526d24_7a9301e8",
      "range": {
        "startLine": 820,
        "startChar": 82,
        "endLine": 820,
        "endChar": 91
      },
      "revId": "b05f725bd9a7a22f6b57e2b121df1a26e326b9e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "df3a79c4_45d06a88",
        "filename": "compiler/dex/quick/gen_invoke.cc",
        "patchSetId": 3
      },
      "lineNbr": 832,
      "author": {
        "id": 1042649
      },
      "writtenOn": "2014-11-25T08:15:09Z",
      "side": 1,
      "message": "Continue with the comments in line 820.\n\nThis will be 6. We know register 3 will be handled in the next loop and regs_left_to_pass_via_stack was reduced by one. But in this loop, we cover registers 012345. register 6 is missed.",
      "range": {
        "startLine": 832,
        "startChar": 13,
        "endLine": 832,
        "endChar": 69
      },
      "revId": "b05f725bd9a7a22f6b57e2b121df1a26e326b9e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}