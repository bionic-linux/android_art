{
  "comments": [
    {
      "key": {
        "uuid": "3c913fcf_8875f87b",
        "filename": "tools/buildbot-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2016-10-21T19:39:44Z",
      "side": 1,
      "message": "The above check ensures that you are already in ANDROID_BUILD_TOP, no need to require ANDROID_BUILD_TOP to be set.",
      "revId": "840226308fc1effdfae2393d6ea6380b48c2c542",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c913fcf_a8e554f0",
        "filename": "tools/buildbot-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-21T19:49:23Z",
      "side": 1,
      "message": "It\u0027s also possible to run this script and not run build/envsetup.sh first, I\u0027ve accidentally tried running scripts like that countless times, it\u0027s always safer to have *at least* the ANDROID_BUILD_TOP check.\n\nIn which case ANDROID_BUILD_TOP will just expand to empty and the rest of this stuff will fail with more obscure messages.\n\n----------------------------\n\n(Actually I don\u0027t really like the above check (L17), it can succeed arbitrarily in any directory that happens to have art in it, but it\u0027s better than nothing)\n\nHappy to replace it with an even more robust option if you prefer, something like -z $ANDROID_BUILD_TOP \u0026\u0026 PWD \u003d\u003d ANDROID_BUILD_TOP\n\nOr we can just cd into the ANDROID_BUILD_TOP directory as the first step, it seems pretty arbitrary to require execution from the root.",
      "parentUuid": "3c913fcf_8875f87b",
      "revId": "840226308fc1effdfae2393d6ea6380b48c2c542",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c913fcf_3bd8b008",
        "filename": "tools/buildbot-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2016-10-21T19:56:50Z",
      "side": 1,
      "message": "As far as I can tell, there is no requirement to source build/envsetup.sh before running this script for any reason other than to get ANDROID_BUILD_TOP, which is not used, so it seems strange to require build/envsetup.sh first.  The whole point to using get_build_var is so that you don\u0027t need envsetup.sh/lunch before running the script.",
      "parentUuid": "3c913fcf_a8e554f0",
      "revId": "840226308fc1effdfae2393d6ea6380b48c2c542",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c913fcf_3b3ef0f1",
        "filename": "tools/buildbot-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-21T20:15:22Z",
      "side": 1,
      "message": "get_build_var is not exported by envsetup.sh\n\n  aosp_master$ declare -x -F get_build_var\n  aosp_master$\n\nThat is why we need to re-source envsetup.sh again in this script [even if it was already sourced prior by the user of the script].\n\n------------\n\nI think you are right we could try to look for $PWD/build/envsetup.sh and just source it, however it still needs to lunch into the right thing somehow (and maybe it\u0027s a missing step that we check that lunch was actually ran?) or the right target build won\u0027t be selected.",
      "parentUuid": "3c913fcf_3bd8b008",
      "revId": "840226308fc1effdfae2393d6ea6380b48c2c542",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dc93c3d8_90db6262",
        "filename": "tools/buildbot-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2016-10-21T20:29:04Z",
      "side": 1,
      "message": "You can just set TARGET_PRODUCT and TARGET_VARIANT to build without using lunch, so there still isn\u0027t any strict requirement to source build/envsetup.sh before running this script.  You do need to source it inside the script, but if you are requiring running from the top of the build that is easy.\n\nChecking for build/envsetup.sh is probably more reliable than checking for art/",
      "parentUuid": "3c913fcf_3b3ef0f1",
      "revId": "840226308fc1effdfae2393d6ea6380b48c2c542",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c913fcf_c824607c",
        "filename": "tools/buildbot-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 36,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2016-10-21T19:39:44Z",
      "side": 1,
      "message": "This isn\u0027t necessary, get_build_var TARGET_OUT will already respect $OUT_DIR",
      "revId": "840226308fc1effdfae2393d6ea6380b48c2c542",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c913fcf_48b5b0d2",
        "filename": "tools/buildbot-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 36,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-21T19:49:23Z",
      "side": 1,
      "message": "Thanks for spotting this!",
      "parentUuid": "3c913fcf_c824607c",
      "revId": "840226308fc1effdfae2393d6ea6380b48c2c542",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}