{
  "comments": [
    {
      "key": {
        "uuid": "3d84dc3d_0f9d954d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-07T09:03:40Z",
      "side": 1,
      "message": "It\u0027s not clear to me from the linked bug why PackageManager was changed to use relative paths. Can you elaborate on the reason for this change?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 10
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e6e2422e_6d9f8d2e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-07T17:36:19Z",
      "side": 1,
      "message": "During installation at compile time, the PackageManager is passing shared libraries to dex2oat with -classpath. For split apps, we want the splits to have the proper dependencies, and are now passing previous parts of the split apk as shared libraries as we compile them all. These apks are staged in a temp dir during compilation, so we pass a relative path for them instead. This lets us still find them at runtime when performing the shared libraries check.",
      "parentUuid": "3d84dc3d_0f9d954d",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 10
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "50faafd9_8e1ecd99",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-11T08:16:28Z",
      "side": 1,
      "message": "A similar thing happens when we compile dex files from a staging directory. In that case, we pass the full path to the dex file with \u0027--dex-file\u0027 (or pass a file descriptor), and pass the relative path to be written to the generated oat file using the \u0027--dex-location\u0027 argument to dex2oat.\n\nTo be consistent, perhaps we should add a \u0027--classpath-locations\u0027 argument to list the relative paths? I\u0027m not sure.",
      "parentUuid": "e6e2422e_6d9f8d2e",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 10
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "17dfb57f_8751f94d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-11T18:11:59Z",
      "side": 1,
      "message": "Yea maybe we can discuss if that would make sense later, but a base classpath directory is all I need for now.",
      "parentUuid": "50faafd9_8e1ecd99",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 10
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "41abb30f_21b07688",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 389,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-07T09:03:40Z",
      "side": 1,
      "message": "This is used to resolve relative paths passed via the -classpath option?\n\nIf we are going to support relative paths for class:\n1. Why not use the same interface as standard java, which I think is relative to the current directory where the class path is specified.\n2. Shouldn\u0027t we be supporting relative paths generally in the runtime, not just in dex2oat?",
      "range": {
        "startLine": 388,
        "startChar": 1,
        "endLine": 389,
        "endChar": 17
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "93a521ba_e18c5ec0",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 389,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-07T17:36:19Z",
      "side": 1,
      "message": "Yes, this is for relative paths being passed with -classpath.\n\n1. I was originally using the current working directory for relative paths. Talking with Andreas, we thought that there might be unintended side effects, so controlling it with a switch would prevent that.\n2. If there\u0027s a need in the general runtime for it, sure.",
      "parentUuid": "41abb30f_21b07688",
      "range": {
        "startLine": 388,
        "startChar": 1,
        "endLine": 389,
        "endChar": 17
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2aac1815_4ac3feac",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 389,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-11T08:16:28Z",
      "side": 1,
      "message": "My understanding from the comment Andreas put on a previous patch set was it was bad to use the current working directory in EncodeDexFileDependencies. If you pass EncodeDexFileDependencies the relative paths to start with, then it doesn\u0027t need to use the current working directory, regardless of whether the current working directory or an extra option is used in dex2oat.\n\nIf you are going to use this extra option, please mention \"-classpath\" directly in the usage description for this option. Perhaps call the option \"--classpath-dir\" instead of \"--base-dir\" so it is clear the option applies to the classpath, and not, say, the dex file?",
      "parentUuid": "93a521ba_e18c5ec0",
      "range": {
        "startLine": 388,
        "startChar": 1,
        "endLine": 389,
        "endChar": 17
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3ece5c8a_93530754",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 389,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-11T18:11:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2aac1815_4ac3feac",
      "range": {
        "startLine": 388,
        "startChar": 1,
        "endLine": 389,
        "endChar": 17
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44ffceab_4f768837",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 389,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-12T13:34:22Z",
      "side": 1,
      "message": "Not done?",
      "parentUuid": "3ece5c8a_93530754",
      "range": {
        "startLine": 388,
        "startChar": 1,
        "endLine": 389,
        "endChar": 17
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fe3550ae_bd6db9b9",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 1495,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-07T09:03:40Z",
      "side": 1,
      "message": "Why change OpenClassPathFiles to modify class_path_locations? It looks like the only use of class_path_locations after this is to pass to EncodeDexFileDependencies. If you don\u0027t modify class_path_locations here, you don\u0027t need to change EncodeDexFileDependencies, right?",
      "range": {
        "startLine": 1495,
        "startChar": 5,
        "endLine": 1495,
        "endChar": 24
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "750b12d3_67bed961",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 1495,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-07T17:36:19Z",
      "side": 1,
      "message": "I can keep class_path_locations const if that\u0027s what you\u0027re asking. I was modifying the paths within OpenClassPathFiles, not for them to be used later by anything.",
      "parentUuid": "fe3550ae_bd6db9b9",
      "range": {
        "startLine": 1495,
        "startChar": 5,
        "endLine": 1495,
        "endChar": 24
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6082466d_f17a9bfa",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 1495,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-11T08:16:28Z",
      "side": 1,
      "message": "I\u0027m suggesting you not modify the contents of class_path_locations here, because that way you can pass the relative paths to EncodeDexFileDependencies later on, so no change is required to EncodeDexFileDependencies to support \"relativizing\" the passed in paths.",
      "parentUuid": "750b12d3_67bed961",
      "range": {
        "startLine": 1495,
        "startChar": 5,
        "endLine": 1495,
        "endChar": 24
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a6007bce_1b616286",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 1495,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-11T18:11:59Z",
      "side": 1,
      "message": "I don\u0027t think I can avoid reverting the paths in EncodeDexFileDependencies. I\u0027m passing in the opened class_path_files there, not the class_path_locations. I can\u0027t just pass class_path_locations because OpenClassPathFiles may fail to open some of them, and only the opened ones should be passed to EncodeDexFileDependencies. The opened dex files have absolute addresses.",
      "parentUuid": "6082466d_f17a9bfa",
      "range": {
        "startLine": 1495,
        "startChar": 5,
        "endLine": 1495,
        "endChar": 24
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d9ea9ca9_e822f43c",
        "filename": "dex2oat/dex2oat.cc",
        "patchSetId": 3
      },
      "lineNbr": 1495,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-12T13:34:22Z",
      "side": 1,
      "message": "Okay. I understand better now.",
      "parentUuid": "a6007bce_1b616286",
      "range": {
        "startLine": 1495,
        "startChar": 5,
        "endLine": 1495,
        "endChar": 24
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3f40dd35_c62b265f",
        "filename": "runtime/oat_file_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 447,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-07T09:03:40Z",
      "side": 1,
      "message": "Can you add a comment describing what this code does and what it is for? I think the purpose is to verify that the dex files are in the same order as the shared library paths?",
      "range": {
        "startLine": 444,
        "startChar": 1,
        "endLine": 447,
        "endChar": 63
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "caadc0f5_0f9596d4",
        "filename": "runtime/oat_file_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 447,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-07T17:36:19Z",
      "side": 1,
      "message": "Yes, this checks that the dex files are in the same order as the shared libraries dex2oat had at compile time.",
      "parentUuid": "3f40dd35_c62b265f",
      "range": {
        "startLine": 444,
        "startChar": 1,
        "endLine": 447,
        "endChar": 63
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e36fb38_3d0b6488",
        "filename": "runtime/oat_file_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 447,
      "author": {
        "id": 1057373
      },
      "writtenOn": "2017-04-11T08:16:28Z",
      "side": 1,
      "message": "Please add this statement as a comment in the code itself.",
      "parentUuid": "caadc0f5_0f9596d4",
      "range": {
        "startLine": 444,
        "startChar": 1,
        "endLine": 447,
        "endChar": 63
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eda07970_4dc98320",
        "filename": "runtime/oat_file_manager.cc",
        "patchSetId": 3
      },
      "lineNbr": 447,
      "author": {
        "id": 1010108
      },
      "writtenOn": "2017-04-11T18:11:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4e36fb38_3d0b6488",
      "range": {
        "startLine": 444,
        "startChar": 1,
        "endLine": 447,
        "endChar": 63
      },
      "revId": "19c3c5d47558e56a6d3130b3711af814b19bc050",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}