{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "87b94094_14ff5eb3",
        "filename": "dexopt_chroot_setup/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 63,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "This test relies on tradefed (and atest locally), right? Worth mentioning too.",
      "range": {
        "startLine": 61,
        "startChar": 0,
        "endLine": 63,
        "endChar": 29
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fad49e23_84c405f7",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 86,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "Suggest `log_name` to make it more obvious that this is only used for logging purposes.",
      "range": {
        "startLine": 86,
        "startChar": 34,
        "endLine": 86,
        "endChar": 38
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4892b396_fc811dc4",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 245,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "If we have races to these two APIs then it seems a lock is unlikely to save the day. Another option is to trylock and report an error if it fails.",
      "range": {
        "startLine": 245,
        "startChar": 30,
        "endLine": 245,
        "endChar": 34
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "09dfe4d8_66cda1a2",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 279,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "We don\u0027t need to restorecon [/tmp/pre_reboot_dexopt](https://cs.android.com/android/platform/superproject/main/+/main:system/sepolicy/private/file_contexts;l\u003d914;drc\u003dc5401edfb4d65686275a3471e38cefbc1913a70f) itself?",
      "range": {
        "startLine": 279,
        "startChar": 2,
        "endLine": 279,
        "endChar": 36
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "937f2166_458bae19",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 282,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "`constexpr`?\n```suggestion\n  constexpr std::vector\u003cstd::string\u003e additional_system_partitions \u003d {\n```",
      "range": {
        "startLine": 282,
        "startChar": 2,
        "endLine": 282,
        "endChar": 26
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "477a8d3e_5f70f39c",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 288,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "For clarity please wrap this (and elsewhere) in a function `IsOtaUpdate`.\n```suggestion\n  if (!IsOtaUpdate(ota_slot)) {  // Mainline update\n```",
      "range": {
        "startLine": 288,
        "startChar": 7,
        "endLine": 288,
        "endChar": 27
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5dd7aea0_e8d0e47c",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 294,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "This is always false. (Maybe planted to see if reviewers are paying attention? :)",
      "range": {
        "startLine": 294,
        "startChar": 10,
        "endLine": 294,
        "endChar": 62
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7361f162_323f9ca0",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 297,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "Please point to the init file that makes this work.\n```suggestion\n    // Run `snapshotctl map` through init to map block devices. We can\u0027t run it ourselves because it\n    // requires the UID to be 0. See `init.snapshotctl.map` in `init.rc`.\n```",
      "range": {
        "startLine": 296,
        "startChar": 0,
        "endLine": 297,
        "endChar": 32
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c4698c30_4d645b1d",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 319,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "This CL seems like a good opportunity to fill out that README file with an overview of the pre-reboot dexopt file structure.",
      "range": {
        "startLine": 314,
        "startChar": 0,
        "endLine": 319,
        "endChar": 53
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6a84ed6_18742a9d",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 385,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "Solder on and try to do our own unmounts (and delete of `CHROOT_DIR`, provided they succeed) before reporting this? If we fail to clean up the chroot it may stay broken until reboot.",
      "range": {
        "startLine": 385,
        "startChar": 6,
        "endLine": 385,
        "endChar": 19
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c1c0fc67_b452771c",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup.cc",
        "patchSetId": 3
      },
      "lineNbr": 418,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "Out of scope here, but I noticed this isn\u0027t documented in the usage in system/core/fs_mgr/libsnapshot/snapshotctl.cpp. Could be worth adding that, and also at the same time add a comment that `map` and `unmap` are used from here. (I\u0027ve no idea how stable that CLI is considered to be, but even though all this is best-effort it\u0027s still good to spread awareness so it doesn\u0027t break unnecessarily.)",
      "range": {
        "startLine": 418,
        "startChar": 37,
        "endLine": 418,
        "endChar": 54
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a021c6af_8b3fea83",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup_test.cc",
        "patchSetId": 3
      },
      "lineNbr": 62,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "Is it possible to test also with a small OTA update package fixture?\n\nIf it\u0027s too complicated then a comment that it\u0027s deferred to the OTA tests is ok.",
      "range": {
        "startLine": 62,
        "startChar": 42,
        "endLine": 62,
        "endChar": 69
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e9faebc_f2750b9c",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup_test.cc",
        "patchSetId": 3
      },
      "lineNbr": 65,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "There\u0027s a small but nonzero risk of a race if the device kicks off a real pre-reboot dexopt while the test runs. Can we prevent that somehow?",
      "range": {
        "startLine": 65,
        "startChar": 41,
        "endLine": 65,
        "endChar": 70
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "08d3bb7c_a15175e7",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup_test.cc",
        "patchSetId": 3
      },
      "lineNbr": 85,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "Worth a comment that the path in /data is the same inside the chroot as outside.\n```suggestion\n      // The test paths in /data are the same inside the chroot as outside.\n      .Add(\"--dex-file\u003d%s\", GetTestDexFileName(\"Main\"))\n```",
      "range": {
        "startLine": 85,
        "startChar": 28,
        "endLine": 85,
        "endChar": 54
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a101849e_a3c99f3f",
        "filename": "dexopt_chroot_setup/dexopt_chroot_setup_test.cc",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-04T19:24:50Z",
      "side": 1,
      "message": "Please also test that `tearDown` is idempotent.",
      "range": {
        "startLine": 93,
        "startChar": 5,
        "endLine": 93,
        "endChar": 50
      },
      "revId": "2c19e5456e2aa56723af00430729f2b66ee4da54",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}