{
  "comments": [
    {
      "key": {
        "uuid": "8780ea14_e7af02e2",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 2
      },
      "lineNbr": 679,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2016-01-14T19:05:35Z",
      "side": 0,
      "message": "This is rather unpleasant. \n\nProfiling info are collected during GC which means that the code below could race and end up using a invalid pointer.",
      "range": {
        "startLine": 679,
        "startChar": 2,
        "endLine": 679,
        "endChar": 45
      },
      "revId": "7b4199a5fa9f151fbf3af2a34f26d04215a1016c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e759a674_6843e19a",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 2
      },
      "lineNbr": 679,
      "author": {
        "id": 1015378
      },
      "writtenOn": "2016-01-14T19:13:47Z",
      "side": 0,
      "message": "I think it is still safe, harder to justify though. Profile infos are only collected if info-\u003eGetMethod()-\u003eGetProfilingInfo() is null which wont be true for the one we are allocating since we do method-\u003eSetProfilingInfo(info).\n\nThe other case to think about is when the GC sets the profile infos to null. Since there is a thread checkpoint between there and when we do the sweeping, it should be safe as long as you have no suspension points between where you add a profiling info and where you use it.",
      "parentUuid": "8780ea14_e7af02e2",
      "range": {
        "startLine": 679,
        "startChar": 2,
        "endLine": 679,
        "endChar": 45
      },
      "revId": "7b4199a5fa9f151fbf3af2a34f26d04215a1016c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "076cfa46_86680cf7",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 2
      },
      "lineNbr": 679,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2016-01-14T21:20:38Z",
      "side": 0,
      "message": "Yes, Mathieu is right, it\u0027s safe to create a ProfilingInfo object even when a GC is in progress.\n\nIt used to be a problem to allocate those ProfilingInfo, as the GC used to just clear the vector containing them, but now that we keep the ones being used for compilation, it\u0027s ok to do this change.",
      "parentUuid": "e759a674_6843e19a",
      "range": {
        "startLine": 679,
        "startChar": 2,
        "endLine": 679,
        "endChar": 45
      },
      "revId": "7b4199a5fa9f151fbf3af2a34f26d04215a1016c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}