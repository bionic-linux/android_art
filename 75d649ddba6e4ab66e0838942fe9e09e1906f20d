{
  "comments": [
    {
      "key": {
        "uuid": "7cc1f61c_e95875fa",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2016-10-13T15:11:35Z",
      "side": 1,
      "message": "Which part of the code was broken before?",
      "range": {
        "startLine": 7,
        "startChar": 5,
        "endLine": 7,
        "endChar": 12
      },
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c37d20c_a3a9a47c",
        "filename": "compiler/jni/jni_compiler_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 390,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2016-10-13T08:45:30Z",
      "side": 1,
      "message": "2",
      "range": {
        "startLine": 390,
        "startChar": 3,
        "endLine": 390,
        "endChar": 4
      },
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bcafeeab_7b9b7f77",
        "filename": "compiler/jni/quick/jni_compiler.cc",
        "patchSetId": 1
      },
      "lineNbr": 326,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-13T17:24:18Z",
      "side": 1,
      "message": "@ngeoffray:\n\n\u003e Could you point to the code that was broken before?\n\nSee this? We set FastStart here regardless of whether or not it returns a reference.",
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bcafeeab_3ea725a9",
        "filename": "compiler/jni/quick/jni_compiler.cc",
        "patchSetId": 1
      },
      "lineNbr": 525,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-13T17:24:18Z",
      "side": 1,
      "message": "@ngeoffray:\n\n\u003e Could you point to the code that was broken before?\n\nAnd here we weren\u0027t setting a FastEnd if there were references being returned.\n\nRight. Now if we look at the JNI entrypoint code, a FastStart skips the state transition, but a regular End does not.\n\nIn the bug referenced in the commit message, the problem is that we get a LOG(FATAL) when we try to do a state transition from suspended to runnable but we\u0027re already runnable.\n\nI initially was setting the FastNative flags lazily so this *just worked* correctly (in End it would\u0027ve checked it dynamically and skip the state transition) but at some point changed it and never got around to fixing the entrypoints.\n\nI mentioned this on the slides from Tues by the way, just didn\u0027t expect to hit this in a real bug the next day.",
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dc63c225_d47bbc45",
        "filename": "compiler/jni/quick/jni_compiler.cc",
        "patchSetId": 1
      },
      "lineNbr": 525,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2016-10-13T21:50:01Z",
      "side": 1,
      "message": "Oh tricky. Things being spread here doesn\u0027t really help. You could consider a refactoring where the decisions of which entry points to use are closer together.",
      "parentUuid": "bcafeeab_3ea725a9",
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fc73265a_109b2ac6",
        "filename": "compiler/jni/quick/jni_compiler.cc",
        "patchSetId": 1
      },
      "lineNbr": 525,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-13T22:38:12Z",
      "side": 1,
      "message": "I could factor those out into a helper function something like this\n\n  template \u003cPointerSize kPointerSize\u003e\n  ThreadOffset\u003ckPointerSize\u003e GetJniEntrypointOffset(bool is_fast, bool start_or_end, bool reference_return, bool synchronized) {\n    // giant if-else here\n  }\n\nIf that would be an appropriately better way?",
      "parentUuid": "dc63c225_d47bbc45",
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c37d20c_e3a3ac98",
        "filename": "runtime/thread.h",
        "patchSetId": 1
      },
      "lineNbr": 1510,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2016-10-13T08:45:30Z",
      "side": 1,
      "message": "Why this change?",
      "range": {
        "startLine": 1505,
        "startChar": 0,
        "endLine": 1510,
        "endChar": 32
      },
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bcbc4ecf_df564e5e",
        "filename": "runtime/thread.h",
        "patchSetId": 1
      },
      "lineNbr": 1510,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-13T15:08:53Z",
      "side": 1,
      "message": "ARM needs 8-byte alignment of thread_local_pos for TLAB, when I added 1 entrypoint only it lost the 8-byte alignment\n\nAndreas said to shuffle some fields around to fix it.",
      "parentUuid": "5c37d20c_e3a3ac98",
      "range": {
        "startLine": 1505,
        "startChar": 0,
        "endLine": 1510,
        "endChar": 32
      },
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fcac0670_eba3854a",
        "filename": "runtime/thread.h",
        "patchSetId": 1
      },
      "lineNbr": 1510,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2016-10-13T15:11:35Z",
      "side": 1,
      "message": "Do we have a static_assert somewhere?",
      "parentUuid": "bcbc4ecf_df564e5e",
      "range": {
        "startLine": 1505,
        "startChar": 0,
        "endLine": 1510,
        "endChar": 32
      },
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bcafeeab_1e2fc9f6",
        "filename": "runtime/thread.h",
        "patchSetId": 1
      },
      "lineNbr": 1510,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2016-10-13T17:24:18Z",
      "side": 1,
      "message": "runtime/arch/arm/quick_entrypoints_arm.S:#error \"Thread::thread_local_pos/end must be consecutive and are 8 byte aligned for performance\"",
      "parentUuid": "fcac0670_eba3854a",
      "range": {
        "startLine": 1505,
        "startChar": 0,
        "endLine": 1510,
        "endChar": 32
      },
      "revId": "75d649ddba6e4ab66e0838942fe9e09e1906f20d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}