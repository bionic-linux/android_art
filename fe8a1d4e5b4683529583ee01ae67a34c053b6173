{
  "comments": [
    {
      "key": {
        "uuid": "b140d043_50182cc4",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 293,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2016-01-29T11:03:45Z",
      "side": 1,
      "message": "It\u0027s a matter of personal taste, but I\u0027d use the RegisterFrom helper here, as we do in compiler/optimizing/code_generator_arm64.cc:\n\n  Register op1_reg \u003d RegisterFrom(op1, type);\n  Register op2_reg \u003d RegisterFrom(op2, type);\n\n(and pass `type` instead of `is_long` to this method).",
      "range": {
        "startLine": 292,
        "startChar": 0,
        "endLine": 293,
        "endChar": 71
      },
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5422228b_abc46d6b",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 293,
      "author": {
        "id": 1074526
      },
      "writtenOn": "2016-01-29T18:04:43Z",
      "side": 1,
      "message": "I agree, I like such utils better too (but for now I just complied with the surrounding style). Perhaps I clean this up with my latter efforts.",
      "parentUuid": "b140d043_50182cc4",
      "range": {
        "startLine": 292,
        "startChar": 0,
        "endLine": 293,
        "endChar": 71
      },
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1116843_5a7955a3",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1052304
      },
      "writtenOn": "2016-01-29T12:05:57Z",
      "side": 1,
      "message": "Three instructions are necessary, but we can spare one conditional instruction by using an arithmetic shift.\n\n__ Sub(out, op1, op2, SetFlags);\n__ Asr(out, out, op1.size() - 1);\n// At this point `out` contains:\n//   * -1 if op1 \u003c op2\n//   * 0 otherwise\n// Now fix the result when op1 \u003e op2.\n__ Cinc(out, out, gt);",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "112fdc8d_6b8ea11e",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-01-29T12:17:50Z",
      "side": 1,
      "message": "This doesn\u0027t work due to arithmetic overflows: INT_MIN \u003c INT_MAX but (INT_MIN - INT_MAX) \u003e\u003e 31 \u003d\u003d 0.",
      "parentUuid": "f1116843_5a7955a3",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "71fc982b_de1fa548",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1052304
      },
      "writtenOn": "2016-01-29T13:15:32Z",
      "side": 1,
      "message": "You are right it would only work for unsigned arithmetic.\n\nThen would this sequence be clearer?\n\n    __ Cmp();\n    __ Cset(out, ne);      // If not equal, the result is -1 or +1.\n    __ Cneg(out, out, lt); // Negate +1 to -1 when op1 \u003c op2.",
      "parentUuid": "112fdc8d_6b8ea11e",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1116843_9a8ecde4",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1052304
      },
      "writtenOn": "2016-01-29T13:26:14Z",
      "side": 1,
      "message": "Not even sure it would work for unsigned arithmetic. I need to double check all this. Anyway it does not matter here.",
      "parentUuid": "71fc982b_de1fa548",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "71fc982b_9e191d65",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1052304
      },
      "writtenOn": "2016-01-29T13:46:45Z",
      "side": 1,
      "message": "And it does not: 0xFFFFFFFF, 0x1.\nI think it can work if we restrict the input ranges. Maybe this staid in our mind from v8\u0027s smis (31bit integers).",
      "parentUuid": "f1116843_9a8ecde4",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7153b827_26ac565d",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-01-29T14:36:36Z",
      "side": 1,
      "message": "The CMP+CSET/NE+CNEG/LT should be just as good as the CMP+CSET/GT+CINV/LT. Both work perfectly for the signed comparison. (If we wanted an unsigned compare, we would have to replace LT-\u003eLO, GT-\u003eHI, but I cannot see why we would ever need that.)\n\nAnd the CMP+CSET/NE+CNEG/LT approach is exactly what I would want for Thumb2:\n\n    cmp op1, op2\n    ite eq\n    moveq out, #0       // 16-bit if out is low reg.\n    movne out, #1       // 16-bit if out is low reg.\n    it lt\n    rsblt out, out, #0  // 16-bit if out is low reg.\n\n(mov out, #-1 would be 32-bit) so maybe we should use that for consistency.",
      "parentUuid": "71fc982b_9e191d65",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d468d2a0_420bc8b0",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1074526
      },
      "writtenOn": "2016-01-29T18:04:43Z",
      "side": 1,
      "message": "So, what\u0027s the verdict. Should I change, or it this good to go?",
      "parentUuid": "7153b827_26ac565d",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7153b827_6675ae62",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-01-29T18:15:16Z",
      "side": 1,
      "message": "Your choice.\n\nThere\u0027s actually also a Thumb2 approach similar to CMP+CSET/GT+CINV/LT:\n\n    cmp op1, op2\n    ite le\n    movle out, #0       // 16-bit if out is low reg.\n    movgt out, #1       // 16-bit if out is low reg.\n    it lt\n    sublt out, out, #1  // 16-bit if out is low reg.\n\n(With 0-1 being used instead of ~0.)",
      "parentUuid": "d468d2a0_420bc8b0",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7153b827_467ab252",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 296,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-01-29T18:19:13Z",
      "side": 1,
      "message": "Though the NE+LT actually allows\n\n    subs out, op1, op2  // 16-bit if all are low regs.\n    it ne\n    movne out, #1       // 16-bit if out is low reg.\n    it lt\n    rsblt out, out, #0  // 16-bit if out is low reg.",
      "parentUuid": "7153b827_6675ae62",
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d139c4d1_712578ec",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 297,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2016-01-29T11:03:45Z",
      "side": 1,
      "message": "Nit: extra white space.",
      "range": {
        "startLine": 297,
        "startChar": 18,
        "endLine": 297,
        "endChar": 28
      },
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5422228b_ab9d4d7f",
        "filename": "compiler/optimizing/intrinsics_arm64.cc",
        "patchSetId": 2
      },
      "lineNbr": 297,
      "author": {
        "id": 1074526
      },
      "writtenOn": "2016-01-29T18:04:43Z",
      "side": 1,
      "message": "Ah, I liked to line up the conditions, but it is again style yes. Removed.",
      "parentUuid": "d139c4d1_712578ec",
      "range": {
        "startLine": 297,
        "startChar": 18,
        "endLine": 297,
        "endChar": 28
      },
      "revId": "fe8a1d4e5b4683529583ee01ae67a34c053b6173",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}