{
  "comments": [
    {
      "key": {
        "uuid": "8b5ca306_d8e0adb9",
        "filename": "compiler/image_writer.cc",
        "patchSetId": 4
      },
      "lineNbr": 1074,
      "author": {
        "id": 1022530
      },
      "writtenOn": "2016-11-10T19:37:55Z",
      "side": 1,
      "message": "Minor point: would the following code work (without assuming kClassLoader is the last in the enum)?\n\n  for (int32_t i \u003d 0; i \u003c image_roots_size; ++i) {\n    // image_roots[ImageHeader::kClassLoader] will be set later for app image.\n    if (i !\u003d ImageHeader::kClassLoader) {\n      CHECK(image_roots-\u003eGet(i) !\u003d nullptr);\n    }\n  }\n\nOr have \n\n  static_assert(ImageHeader::kClassLoader + 1u \u003d\u003d ImageHeader::kImageRootsMax,\n                \"Class loader should be the last image root.\");\n\nhere too?",
      "range": {
        "startLine": 1071,
        "startChar": 0,
        "endLine": 1074,
        "endChar": 3
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7008401c_986375ef",
        "filename": "compiler/image_writer.cc",
        "patchSetId": 4
      },
      "lineNbr": 1074,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-11-14T19:33:12Z",
      "side": 1,
      "message": "Done (with the static_assert).",
      "parentUuid": "8b5ca306_d8e0adb9",
      "range": {
        "startLine": 1071,
        "startChar": 0,
        "endLine": 1074,
        "endChar": 3
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8b5ca306_38de09c2",
        "filename": "compiler/image_writer.cc",
        "patchSetId": 4
      },
      "lineNbr": 1495,
      "author": {
        "id": 1022530
      },
      "writtenOn": "2016-11-10T19:37:55Z",
      "side": 1,
      "message": "Is it the case that we always have one class loader in the app image?",
      "range": {
        "startLine": 1495,
        "startChar": 4,
        "endLine": 1495,
        "endChar": 40
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "500dfc2a_d7fd3cc1",
        "filename": "compiler/image_writer.cc",
        "patchSetId": 4
      },
      "lineNbr": 1495,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-11-14T19:33:12Z",
      "side": 1,
      "message": "I think so. That\u0027s how we set it up in the dex2oat.\n\nDoes the transactional interpreter used for AOT class initialization allow creating new class loaders and defining classes?",
      "parentUuid": "8b5ca306_38de09c2",
      "range": {
        "startLine": 1495,
        "startChar": 4,
        "endLine": 1495,
        "endChar": 40
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3045e884_a1b6b821",
        "filename": "compiler/image_writer.cc",
        "patchSetId": 4
      },
      "lineNbr": 1495,
      "author": {
        "id": 1022530
      },
      "writtenOn": "2016-11-14T22:27:28Z",
      "side": 1,
      "message": "I\u0027m not sure. Does anyone know?\n\nI think that app image doesn\u0027t currently support class initialization.",
      "parentUuid": "500dfc2a_d7fd3cc1",
      "range": {
        "startLine": 1495,
        "startChar": 4,
        "endLine": 1495,
        "endChar": 40
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "705120f4_5671e488",
        "filename": "compiler/image_writer.cc",
        "patchSetId": 4
      },
      "lineNbr": 1495,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-11-29T15:18:28Z",
      "side": 1,
      "message": "I investigated and the conclusion is that for app image we don\u0027t execute \u003cclinit\u003e at all, see compiler_driver.cc, InitializeClassVisitor::Visit(),\n\n    bool can_init_static_fields \u003d\n        manager_-\u003eGetCompiler()-\u003eGetCompilerOptions().IsBootImage() \u0026\u0026\n        manager_-\u003eGetCompiler()-\u003eIsImageClass(descriptor) \u0026\u0026\n        !StringPiece(descriptor).ends_with(\"$NoPreloadHolder;\");\n\nWe use only the EncodedStaticFieldValueIterator to process the \"encoded_array_item\"s indicated by \"static_values_off\". However, that\u0027s used only for integral values as both javac+dx and jack will generate a \u003cclinit\u003e even for\n\n    static Object o \u003d null;\n\nor\n\n    static String s \u003d \"dummy\";\n\ndespite the availability of VALUE_NULL and VALUE_STRING types in encoded_value.",
      "parentUuid": "3045e884_a1b6b821",
      "range": {
        "startLine": 1495,
        "startChar": 4,
        "endLine": 1495,
        "endChar": 40
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8b5ca306_bba5b3f1",
        "filename": "runtime/image.h",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1015378
      },
      "writtenOn": "2016-11-10T21:15:00Z",
      "side": 1,
      "message": "I seems like it would be easier to just always have this root even in the non app image case.",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 192,
        "endChar": 37
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4bf54bfd_7eafb1ca",
        "filename": "runtime/image.h",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-11-11T14:06:49Z",
      "side": 1,
      "message": "Is there an easy way to get hold of the class loader for the boot image?",
      "parentUuid": "8b5ca306_bba5b3f1",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 192,
        "endChar": 37
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8b5ca306_12d83c36",
        "filename": "runtime/image.h",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1015378
      },
      "writtenOn": "2016-11-11T18:34:36Z",
      "side": 1,
      "message": "If we don;t need for the boot image we could just leave it null.",
      "parentUuid": "4bf54bfd_7eafb1ca",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 192,
        "endChar": 37
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b012b845_fa5a696c",
        "filename": "runtime/image.h",
        "patchSetId": 4
      },
      "lineNbr": 192,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2016-11-14T19:33:12Z",
      "side": 1,
      "message": "I\u0027d prefer not having the null in the array for the boot image.",
      "parentUuid": "8b5ca306_12d83c36",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 192,
        "endChar": 37
      },
      "revId": "5a11ac6037998b87d860da9d51ca4dfdbb606d45",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}