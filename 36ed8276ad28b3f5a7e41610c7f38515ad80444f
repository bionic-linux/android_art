{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "684ba87d_919afb32",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T21:58:30Z",
      "side": 1,
      "message": "After some internet searching and thinking at lunch, I\u0027m unsure whether this is accurate. Could it also be that the kernel just decides to do this when the previous page is faulted to avoid a second fault? Unless you know better than me, I would delete the \"h/w\". I do think something is doing some kind of prefetching, but that\u0027s all I know.",
      "range": {
        "startLine": 9,
        "startChar": 21,
        "endLine": 9,
        "endChar": 24
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9276d981_34bb1aa9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2022-12-09T22:09:31Z",
      "side": 1,
      "message": "Replied on the other comment. PTAL.",
      "parentUuid": "684ba87d_919afb32",
      "range": {
        "startLine": 9,
        "startChar": 21,
        "endLine": 9,
        "endChar": 24
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "92532d97_e5c4dc6e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T23:05:12Z",
      "side": 1,
      "message": "I\u0027m still a bit nervous about claiming these are h/w prefetches here without understanding this better. Weasel-word like in the other place? E.g. \"h/w prefetch type accesses\" \u003d\u003d\u003e \"possible prefetch accesses\"? It could be explicit software prefetches.\n\nI\u0027m also still not completely sure whether there could be a futex issue here. Condition variables can be destroyed and deallocated between the last notification and when the notified thread resumes. The notified thread must not touch the futex after it wakes up, but there could conceivably be an issue with the wake-up code in the kernel mapping it? I have no idea.",
      "parentUuid": "9276d981_34bb1aa9",
      "range": {
        "startLine": 9,
        "startChar": 21,
        "endLine": 9,
        "endChar": 24
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0dbec754_02c842b6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T21:58:30Z",
      "side": 1,
      "message": "Generally LGTM, but I have some questions about whether this is the best approach.",
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c304714e_8d501be7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T23:05:12Z",
      "side": 1,
      "message": "LGTM. A couple of minor suggestions for a comment and the commit message.",
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8293ac95_a357d5b5",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3011,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T21:58:30Z",
      "side": 1,
      "message": "\"h/w or kernel\"? Again unless you know better.",
      "range": {
        "startLine": 3011,
        "startChar": 64,
        "endLine": 3011,
        "endChar": 68
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d40a3320_10bca38c",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3011,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2022-12-09T22:09:31Z",
      "side": 1,
      "message": "I don\u0027t think it can be kernel because I\u0027m always seeing the first page of from-space getting accessed. Kernel won\u0027t prefetch the page in another vma. And since this is a file-back vma, kernel couldn\u0027t have merged the vma with the preceding mapping.",
      "parentUuid": "8293ac95_a357d5b5",
      "range": {
        "startLine": 3011,
        "startChar": 64,
        "endLine": 3011,
        "endChar": 68
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "215884ff_5690d75d",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3011,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T23:05:12Z",
      "side": 1,
      "message": "Makes sense. I think there are also explicit prefetch instructions. I\u0027ve found it hard to discover whether any of these can cause page faults or give up on a missing mapping. This is sufficiently weasel-worder, it seems fine.",
      "parentUuid": "d40a3320_10bca38c",
      "range": {
        "startLine": 3011,
        "startChar": 64,
        "endLine": 3011,
        "endChar": 68
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "14fb8cef_e3558e29",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3016,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T21:58:30Z",
      "side": 1,
      "message": "It doesn\u0027t work to do MADV_REMOVE first and then MPROTECT? I gues the problem is that there is a window in the middle where things can still go wrong?",
      "range": {
        "startLine": 3015,
        "startChar": 6,
        "endLine": 3016,
        "endChar": 29
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f0663e57_1e7b601c",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3016,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2022-12-09T22:09:31Z",
      "side": 1,
      "message": "Exactly. I was able to reproduce, with your suggestion, a case where again the page got accessed. This way, it makes it impossible.",
      "parentUuid": "14fb8cef_e3558e29",
      "range": {
        "startLine": 3015,
        "startChar": 6,
        "endLine": 3016,
        "endChar": 29
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b53ca6d_32e5050e",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3023,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T21:58:30Z",
      "side": 1,
      "message": "Do we potentially have the same issue here? Or why else is this undesirable?\n\nI wonder whether another possible fix might be to ensure that the preceding N pages are not accessible. That admittedly seems brittle.",
      "range": {
        "startLine": 3023,
        "startChar": 6,
        "endLine": 3023,
        "endChar": 97
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "161e3265_a755e7ba",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3023,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2022-12-09T22:09:31Z",
      "side": 1,
      "message": "We don\u0027t have the issue in this case because in this case, the to-space in next GC cycle will use a fresh MAP_ANONYMOUS+MAP_SHARED pseudo-file. So even if there is some prefetching taking place on the from-space, it would not cause us any issues. And therefore, we don\u0027t have to incur the overhead of mprotect. Also, this is the most likely case for us, so here performance matters.",
      "parentUuid": "2b53ca6d_32e5050e",
      "range": {
        "startLine": 3023,
        "startChar": 6,
        "endLine": 3023,
        "endChar": 97
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e335b10d_865a04c3",
        "filename": "runtime/gc/collector/mark_compact.cc",
        "patchSetId": 2
      },
      "lineNbr": 3023,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2022-12-09T23:05:12Z",
      "side": 1,
      "message": "The comment makes it sound like MADV_REMOVE here is problematic. It sounds like this is really just fine. Maybe clarify?",
      "parentUuid": "161e3265_a755e7ba",
      "range": {
        "startLine": 3023,
        "startChar": 6,
        "endLine": 3023,
        "endChar": 97
      },
      "revId": "36ed8276ad28b3f5a7e41610c7f38515ad80444f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}