{
  "comments": [
    {
      "key": {
        "uuid": "9b25a80b_81bb3532",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "Do you need to pass this? Can you get it from the passed \u0027klass\u0027 instead?",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eed87037_7767b3d6",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1121591
      },
      "writtenOn": "2018-02-27T14:03:53Z",
      "side": 1,
      "message": "Yes. \u0027klass\u0027 comes from CL\u0027s class table. Which might and most certainly does contain classes, located in different linear allocs.",
      "parentUuid": "9b25a80b_81bb3532",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b52e99e6_70496c8a",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-03-01T14:07:26Z",
      "side": 1,
      "message": "WDYM? A class loader has only one linear alloc doesn\u0027t it? So instead of passing it, can you fetch it from klass?",
      "parentUuid": "eed87037_7767b3d6",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "69010bea_23d1227a",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1121591
      },
      "writtenOn": "2018-03-01T18:53:04Z",
      "side": 1,
      "message": "I mean I take a class_table from a ClassLoader and visit all the classes in it. Class visitor then calls this method ResetSIInHierarchyByDeletedAllocation.\nConsider class hierarchy from the test (AbstractCHA defined in the main dex and ConcreteCHA [extends AbstractCHA] defined in the secondary dex. ConreteCHA shall be unloaded after all). Then the class loader under deletion has 2 classes in its class_table: \nAbstractCHA, that belongs to the original application class loader and its own linear alloc.\nConcreteCHA, that belongs to the unloaded class loader and its own linear alloc that is going to be invalidated.\n\nIf visitor calls this method when visiting AbstractCHA, the invalidated allocation could not be obtained from the class. The class shall be just skipped.",
      "parentUuid": "b52e99e6_70496c8a",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fa65ab80_9de72109",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-03-02T12:41:35Z",
      "side": 1,
      "message": "Sorry, I still don\u0027t understand this.\n\nAre you telling me that:\nClassLinker::GetAllocatorForClassLoader(klass-\u003eGetClassLoader) !\u003d alloc ?",
      "parentUuid": "69010bea_23d1227a",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ae83481_35a7af12",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1121591
      },
      "writtenOn": "2018-03-02T13:25:30Z",
      "side": 1,
      "message": "Exactly.\n\nFor example, 616-cha-unloading:\nklass LConcreteCHATester; Loader 0x12c045d0 allocator 0x559670e75460, alloc 0x559670e75460\nklass LAbstractCHATester; Loader 0x12c02488 allocator 0x559670e76510, alloc 0x559670e75460",
      "parentUuid": "fa65ab80_9de72109",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fd246ddb_3f6c42b9",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-03-02T13:30:53Z",
      "side": 1,
      "message": "But that method (ResetSIInHierarchyByDeletedAllocation) is only called for classes of a class loader with alloc \u003d classloader\u0027s alloc.\n\nSo what am I missing?",
      "parentUuid": "6ae83481_35a7af12",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bce44574_071fcc96",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 81,
      "author": {
        "id": 1121591
      },
      "writtenOn": "2018-03-02T13:41:53Z",
      "side": 1,
      "message": "The method is called for classes from classloader\u0027s class table. There are also classes, defined by other classloaders (i.e different allocs).\n\nThe call chain is ClassLinker::DeleteClassLoader(class_table, alloc) \u003d\u003e ClassLinker::CHAOnDeleteUpdateClassVisitor \u003d\u003e for (klass in class_table) Visit(klass, alloc) \u003d\u003e CHA::ResetSIInHierarchyByDeletedAllocation(klass, alloc)\n\nI\u0027m not quite sure what\u0027s a better way to get classes, defined by a given classloader, which is in the process of deletion... Other than iterate over its class_table and filter out non-related classes.",
      "parentUuid": "fd246ddb_3f6c42b9",
      "range": {
        "startLine": 81,
        "startChar": 67,
        "endLine": 81,
        "endChar": 91
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb80dd0c_e178456c",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "Do you need to pass this? Can you get this from the class linker instead?",
      "range": {
        "startLine": 82,
        "startChar": 68,
        "endLine": 82,
        "endChar": 97
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c7ca05f_f70b774a",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1121591
      },
      "writtenOn": "2018-02-27T14:03:53Z",
      "side": 1,
      "message": "Followed the same idea, as you suggested in class_linker.cc\u0027s CHAOnDeleteUpdateClassVisitor and its cha_ field.\nI\u0027m not sure if there\u0027s a reason to not pass pointer_size.",
      "parentUuid": "eb80dd0c_e178456c",
      "range": {
        "startLine": 82,
        "startChar": 68,
        "endLine": 82,
        "endChar": 97
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "470dae25_86dbaa1d",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 105,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "superclass",
      "range": {
        "startLine": 105,
        "startChar": 79,
        "endLine": 105,
        "endChar": 90
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "68d0ce52_e528eccd",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 107,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "do not override methods from super classes",
      "range": {
        "startLine": 107,
        "startChar": 35,
        "endLine": 107,
        "endChar": 72
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "21de10c8_29a6b667",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 123,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "Why don\u0027t you check super_it comes from the same class loader, in which case you don\u0027t need to do anything?",
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4b03ebc_f0ca3d12",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 123,
      "author": {
        "id": 1121591
      },
      "writtenOn": "2018-02-27T14:03:53Z",
      "side": 1,
      "message": "Initially I was thinking that the only way to check is a super class is going to be deleted is via LinearAlloc\u0027s Contains method, which might proceed even longer than the whole loop\u0027s body itself.\nIndeed, comparing the classloaders is the way to go.",
      "parentUuid": "21de10c8_29a6b667",
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a95e827d_e96a61af",
        "filename": "runtime/cha.cc",
        "patchSetId": 6
      },
      "lineNbr": 149,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "indentation is off",
      "range": {
        "startLine": 148,
        "startChar": 8,
        "endLine": 149,
        "endChar": 22
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "52937e61_efa910a5",
        "filename": "runtime/cha.h",
        "patchSetId": 6
      },
      "lineNbr": 119,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "nit: ResetSingleImplementationInHierarchy ?",
      "range": {
        "startLine": 119,
        "startChar": 7,
        "endLine": 119,
        "endChar": 44
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "225573fe_f9749f6d",
        "filename": "runtime/cha.h",
        "patchSetId": 6
      },
      "lineNbr": 120,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "Nit: one per line",
      "range": {
        "startLine": 119,
        "startChar": 45,
        "endLine": 120,
        "endChar": 96
      },
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8215afa2_56a01495",
        "filename": "test/616-cha-unloading/src/Main.java",
        "patchSetId": 6
      },
      "lineNbr": 1,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-02-26T14:58:25Z",
      "side": 1,
      "message": "Missing copyright",
      "revId": "35c2108b537b70578ffd996f96b8b3db9a1e298e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}