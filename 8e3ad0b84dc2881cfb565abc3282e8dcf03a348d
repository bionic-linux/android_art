{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "147b5bb7_c39f4996",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 335,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2021-02-10T21:33:18Z",
      "side": 1,
      "message": "Add docs: what\u0027s being validated and what return code should be expected.",
      "range": {
        "startLine": 335,
        "startChar": 13,
        "endLine": 335,
        "endChar": 24
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1b1be1f8_b03b7e32",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 335,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2021-02-16T09:22:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "147b5bb7_c39f4996",
      "range": {
        "startLine": 335,
        "startChar": 13,
        "endLine": 335,
        "endChar": 24
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "448d6945_0519e7c3",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-02-10T15:44:41Z",
      "side": 1,
      "message": "Isn\u0027t this already going to try to load the image? If yes, maybe it\u0027s just a matter of checking if it has successfully loaded it?",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "793d3784_ca7c2479",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2021-02-10T16:45:58Z",
      "side": 1,
      "message": "Yes, but we\u0027re not loading it again here (?).\n\nThe code is trying to check we have the full deck of .art, .oat and .vdex files for the boot class path. If there is a less literal check that covers the same, happy to go there, but obviously have found it already.",
      "parentUuid": "448d6945_0519e7c3",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e2d1f138_839ec63c",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-02-10T18:32:16Z",
      "side": 1,
      "message": "\u003e Yes, but we\u0027re not loading it again here (?).\n\nRight, but the checks below are not required if the runtime has successfully loaded the boot image.\n\nThere\u0027s also the question about bitness. Do we need dexoptanalyzer32 and dexoptanalyzer64?",
      "parentUuid": "793d3784_ca7c2479",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "410f3095_f12f2c4b",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2021-02-10T21:33:18Z",
      "side": 1,
      "message": "I think CreateRuntime might succeed even if some checks before fail. We will fall back to run imageless but the runtime creation should still be ok. Worth double checking :)",
      "parentUuid": "e2d1f138_839ec63c",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0eeacec1_3e663707",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-02-11T08:53:56Z",
      "side": 1,
      "message": "\u003e I think CreateRuntime might succeed even if some checks before fail.\n\nYes, but what I\u0027m saying is we could check at the runtime to see if it was successful in loading the image.",
      "parentUuid": "410f3095_f12f2c4b",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5627cef5_3109cd7a",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2021-02-16T09:22:23Z",
      "side": 1,
      "message": "Do you think this functionality already exists or should exist?",
      "parentUuid": "0eeacec1_3e663707",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57bf9146_c1185e3b",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-02-16T10:14:39Z",
      "side": 1,
      "message": "Heap::GetBootImageSpaces could look like the closest thing? but I guess it\u0027s ok to skip for now, and your code can go.\n\nI do worry about the 32/64 - how do we already make that happen for system server (which is executing on arm64, but fulfils requests of up-to-date oat files for 32 bit oat files).",
      "parentUuid": "5627cef5_3109cd7a",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58deb331_b796ff7f",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 338,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2021-02-16T12:04:01Z",
      "side": 1,
      "message": "We\u0027re using GetBootImageSpaces() here in the checks here to gather inputs. VerifyBootClassPathChecksums not only checks the checksums, but also deals with awkwards cases like single-image as we have from odrefresh. The code here could recreate the logic for single-image counting checks here, but not having checksums verified seems more fragile.\n\nFor 32/64 for system_server: the ISA is passed as an argument on the command-line appropriate to what is being validated and CreateRuntime() already uses this. Given we\u0027re just opening files and reading headers, we might expect this to be fine.\n\nWe do this elsewhere already since 2017:\n\n https://cs.android.com/android/platform/superproject/+/master:frameworks/native/cmds/installd/dexopt.cpp;drc\u003dbf00bf32a70aedca874f6f8b0f78e2260b95ec3b;l\u003d1159\n\nwhich was introduced here:\n\nhttp://ag/c/platform/frameworks/native/+/1786897/15/cmds/installd/dexopt.cpp#1213",
      "parentUuid": "57bf9146_c1185e3b",
      "range": {
        "startLine": 338,
        "startChar": 9,
        "endLine": 338,
        "endChar": 22
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6cfc94c9_6a745e73",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 353,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2021-02-10T21:33:18Z",
      "side": 1,
      "message": "needs an extra space",
      "range": {
        "startLine": 353,
        "startChar": 49,
        "endLine": 353,
        "endChar": 50
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fdc6cc61_166af06e",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 353,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2021-02-16T09:22:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6cfc94c9_6a745e73",
      "range": {
        "startLine": 353,
        "startChar": 49,
        "endLine": 353,
        "endChar": 50
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6b1fb90_5defb605",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 359,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2021-02-10T21:33:18Z",
      "side": 1,
      "message": "checksums",
      "range": {
        "startLine": 359,
        "startChar": 53,
        "endLine": 359,
        "endChar": 54
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3165e73d_8544d019",
        "filename": "dexoptanalyzer/dexoptanalyzer.cc",
        "patchSetId": 4
      },
      "lineNbr": 359,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2021-02-16T09:22:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d6b1fb90_5defb605",
      "range": {
        "startLine": 359,
        "startChar": 53,
        "endLine": 359,
        "endChar": 54
      },
      "revId": "8e3ad0b84dc2881cfb565abc3282e8dcf03a348d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}