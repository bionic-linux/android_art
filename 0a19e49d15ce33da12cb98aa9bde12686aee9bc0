{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "be64b7fb_ae22a987",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 129,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-26T18:21:42Z",
      "side": 1,
      "message": "With the removal of the `committed_` flag there\u0027s a small theoretical risk that this deletes another unrelated temporary file that happened to take the same temporary name if this one has been committed, since mkstemps(3) only guarantees that it\u0027s unique among existing files. I don\u0027t think we actually need to bother about it given the [implementation](https://cs.android.com/android/platform/superproject/main/+/main:bionic/libc/upstream-openbsd/lib/libc/stdio/mktemp.c;l\u003d85;drc\u003d9a4b68e20d617b2cb3355071521f16e8c3d538df), but thought it worth a mention.\n\nAnother possible approach to that could be to let an empty `temp_path_` mean that the file has been committed.",
      "range": {
        "startLine": 129,
        "startChar": 6,
        "endLine": 129,
        "endChar": 21
      },
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9fc1201e_9db6a65e",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 129,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-04-28T17:05:11Z",
      "side": 1,
      "message": "This cleanup is only for the loop below that calls `Keep` on every file, which doesn\u0027t change the file path but only closes the file.\n\nThe actual move happens in `MoveAllOrAbandon`, and I maintain a set `committed_files` there as an equivalence of the removed `committed_` flag.",
      "parentUuid": "be64b7fb_ae22a987",
      "range": {
        "startLine": 129,
        "startChar": 6,
        "endLine": 129,
        "endChar": 21
      },
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "52da2240_b48c0465",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 129,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-29T12:03:01Z",
      "side": 1,
      "message": "Ok, I missed that the cleanup was disabled before the `MoveAllOrAbandon` call.",
      "parentUuid": "9fc1201e_9db6a65e",
      "range": {
        "startLine": 129,
        "startChar": 6,
        "endLine": 129,
        "endChar": 21
      },
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5cd60bbe_26f73ef5",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 134,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-29T12:03:01Z",
      "side": 1,
      "message": "I still see no coverage on this line (only), but that must clearly be wrong. It\u0027s not very trustworthy, unfortunately.",
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f914d23_83aeba3b",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 151,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-29T12:03:01Z",
      "side": 1,
      "message": "This branch is still shows as uncovered. If that\u0027s correct then please consider a test for it.",
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0bbc8992_bf8e4af2",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 151,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-04-29T12:40:00Z",
      "side": 1,
      "message": "Added a test case.",
      "parentUuid": "7f914d23_83aeba3b",
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d7e8075_06853782",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 170,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-26T18:21:42Z",
      "side": 1,
      "message": "All the cleanup code shows as uncovered to me. Doesn\u0027t `NewFileCommitAllFailedToCommit` and `NewFileCommitAllFailedToMoveOldFile` trigger this?",
      "range": {
        "startLine": 149,
        "startChar": 0,
        "endLine": 170,
        "endChar": 5
      },
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a38b6064_9c7b0c8a",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 170,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-04-28T17:05:11Z",
      "side": 1,
      "message": "I see it being covered. https://screenshot.googleplex.com/Bb3ECfqpjfZucLp",
      "parentUuid": "2d7e8075_06853782",
      "range": {
        "startLine": 149,
        "startChar": 0,
        "endLine": 170,
        "endChar": 5
      },
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2df163af_c7f3da95",
        "filename": "artd/file_utils.cc",
        "patchSetId": 14
      },
      "lineNbr": 170,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-04-29T12:03:01Z",
      "side": 1,
      "message": "Now I see it too. I wonder if coverage is updated incrementally or something. If so that\u0027s not great. Next time I\u0027ll grab a screenshot and file a ticket.",
      "parentUuid": "a38b6064_9c7b0c8a",
      "range": {
        "startLine": 149,
        "startChar": 0,
        "endLine": 170,
        "endChar": 5
      },
      "revId": "0a19e49d15ce33da12cb98aa9bde12686aee9bc0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}