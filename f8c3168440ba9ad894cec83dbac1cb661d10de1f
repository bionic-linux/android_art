{
  "comments": [
    {
      "key": {
        "uuid": "e2709778_ed67e1af",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-08-03T07:47:45Z",
      "side": 1,
      "message": "dependencies",
      "range": {
        "startLine": 7,
        "startChar": 12,
        "endLine": 7,
        "endChar": 24
      },
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a97202ff_ff7c7b3e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-03T07:57:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e2709778_ed67e1af",
      "range": {
        "startLine": 7,
        "startChar": 12,
        "endLine": 7,
        "endChar": 24
      },
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7b308845_c7594521",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-08-03T07:47:45Z",
      "side": 1,
      "message": "David, Roland, can you take a look too?",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "be6649f0_25a6b866",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-08-03T07:47:45Z",
      "side": 1,
      "message": "Where is the apex dependency for target?",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e252d8da_a0f302bb",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-03T07:57:02Z",
      "side": 1,
      "message": "It should be provided by \"com.android.art.debug\" but not by \"*.release\" (http://cs/android/art/build/apex/Android.bp?l\u003d74\u0026rcl\u003dd3ee902ed06b635eedebc796543a67299eb6cd05)\n\nI\u0027m not sure if I should add `target.required: [\"com.android.art\"]` because from what I see APEXes are usually installed via explicitly adding it to PRODUCT_PACKAGES. Plus I thought ART APEX is always install on device?",
      "parentUuid": "be6649f0_25a6b866",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2cdd0dcf_3ab0f2fd",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2020-08-03T13:52:07Z",
      "side": 1,
      "message": "I think the dependency on `dex2oatd` for the device case should be something like:\n\n    target: {\n        android: {\n            required: [\"com.android.art.dex2oatd\"],\n        },\n    },\n\nAdding Jiyong to confirm.\n\nNote that on target, those tests are currently only bundled with the Testing ART APEX. (This may change in the future if we manage to leverage the `for_test` property for ART gtests on device.)",
      "parentUuid": "e252d8da_a0f302bb",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "950c1236_36b68849",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2020-08-04T02:34:26Z",
      "side": 1,
      "message": "The name of the apex variant is \u003cmodulename\u003e.\u003capexname\u003e like dex2oatd.com.android.art.debug.",
      "parentUuid": "2cdd0dcf_3ab0f2fd",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e04e5be_9290ce22",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-04T03:02:34Z",
      "side": 1,
      "message": "Doesn\u0027t the \u003cmodule\u003e.\u003capex\u003e install symbol files but not actual file?",
      "parentUuid": "950c1236_36b68849",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17c38bed_0593d182",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2020-08-04T03:15:34Z",
      "side": 1,
      "message": "Ah, you are right. I didn\u0027t read the prior comments carefully. Yes, the dependency to the target variant doesn\u0027t need to be specified here as dex2oatd is already listed in the `binaries` property of the `com.android.art.debug` APEX.",
      "parentUuid": "5e04e5be_9290ce22",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f8994d3f_d1199b1d",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-04T04:16:10Z",
      "side": 1,
      "message": "I also don\u0027t think this should be `required: [\"com.android.art.debug\"]` as it may cause both \"debug\" and \"release\" be installed on device. Also from this doc (https://cs.android.com/android/platform/superproject/+/master:art/test/README.md), I think ART tests and dependencies are handled by the test scripts, such as replacing \"com.android.art.release\" with \"com.android.art.testing\" at runtime, so target.android.required needn\u0027t be specifies here.",
      "parentUuid": "17c38bed_0593d182",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d17e3d7_21927b66",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2020-08-04T10:15:10Z",
      "side": 1,
      "message": "David, do you remember why we needed this explicit dependency? Retrospectively I\u0027m not sure it is needed, even in these two device testing scenario I\u0027m thinking of:\n- when using the Testing ART APEX (current situation): the ART gtests are bundled with the Testing ART APEX, which includes `dex2oatd2`, which means we\u0027re fine;\n- when not using the Testing ART APEX (perhaps in the future, see Bug 162734417): the ART gtests should not have an explicit dependency on the ART APEX or its components, as we should be able to build them independently of the ART APEX (maybe we might need stub libraries, but I think that\u0027s different).",
      "parentUuid": "f8994d3f_d1199b1d",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bca3478c_7cabad6a",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1065473
      },
      "writtenOn": "2020-08-04T11:10:51Z",
      "side": 1,
      "message": "We need the dependency on host so that if we build just art_dex2oat_tests it will also build the dex2oat, which is needed to run the test.\n\nWe currently don\u0027t need the dependency on device, since the apex contains it already.",
      "parentUuid": "2d17e3d7_21927b66",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a8c19ae_0c0a9a13",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-05T07:07:28Z",
      "side": 1,
      "message": "Does this mean all of these `required: [\u003ctool\u003e]` should actually be host.required ?",
      "parentUuid": "bca3478c_7cabad6a",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a280081_bcdac207",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1065473
      },
      "writtenOn": "2020-08-05T07:39:25Z",
      "side": 1,
      "message": "I guess that is a theoretical debate.  The on device tests still require the tools for execution, so it seems appropriate have them marked as such, even if just for documentation - that is as long as the property is harmless.\n\nOn the other hand, in practice the tools will be always build anyway since they are needed for the apex.  So if there some random mac build issue, I see no harm in restricting it to host.required.",
      "parentUuid": "1a8c19ae_0c0a9a13",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc1bb4c6_cfde4393",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-05T08:52:04Z",
      "side": 1,
      "message": "\u003e The on device tests still require the tools for execution, so it seems appropriate have them marked as such, even if just for documentation\n\nAgreed. However the requirements (dex2oatd...) are in \"com.android.art.testing\", and adding this requirement to art_*_test would result in a circular dependency. So we cannot do this unless the testcases are moved out of art.testing",
      "parentUuid": "8a280081_bcdac207",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "032b8da3_95d8dc38",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-05T09:14:10Z",
      "side": 1,
      "message": "\u003e So if there some random mac build issue, I see no harm in restricting it to host.required.\n\nThis is not a mac specific issue. This is an actual issue, it\u0027s just that due to our build system\u0027s limitation, this issue is not detected when building on linux host D:",
      "parentUuid": "fc1bb4c6_cfde4393",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf383941_066c43a4",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1065473
      },
      "writtenOn": "2020-08-05T11:20:00Z",
      "side": 1,
      "message": "Ah, right, it is a cyclic dependency issue?  Is that worth mentioning in the commit message?",
      "parentUuid": "032b8da3_95d8dc38",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1ba0ca17_35cb57d4",
        "filename": "dex2oat/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 465,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2020-08-05T11:46:56Z",
      "side": 1,
      "message": "Added some explanation.\n\nI have one question, for the device testcases, say art_dex2oat_tests, does it require the *host* dex2oatd to run? or does it only need the *device* dex2oatd (which is in the testing APEX)?\n\nIf it\u0027s the latter case, we should also add `target.android.host_required: [\"dex2oatd\"]`",
      "parentUuid": "bf383941_066c43a4",
      "revId": "f8c3168440ba9ad894cec83dbac1cb661d10de1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}