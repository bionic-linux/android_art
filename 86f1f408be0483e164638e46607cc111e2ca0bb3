{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "9c028d69_33c9b3dd",
        "filename": "libartservice/service/java/com/android/server/art/DexUseManagerLocal.java",
        "patchSetId": 2
      },
      "lineNbr": 578,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-07-17T19:09:12Z",
      "side": 1,
      "message": "This is a semantic change compared to before this CL chain, isn\u0027t it?\n\nBefore this did we just ignore notifications on shared libs, which meant they typically didn\u0027t get dexopted (unless they\u0027re also a regular primary or secondary dex)?\n\nIf that\u0027s correct then I guess this is a good thing, but the description isn\u0027t accurate. It also merits a test.",
      "range": {
        "startLine": 578,
        "startChar": 16,
        "endLine": 578,
        "endChar": 78
      },
      "revId": "86f1f408be0483e164638e46607cc111e2ca0bb3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "073f2b09_40b0b261",
        "filename": "libartservice/service/java/com/android/server/art/DexUseManagerLocal.java",
        "patchSetId": 2
      },
      "lineNbr": 578,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-07-17T21:15:52Z",
      "side": 1,
      "message": "As I said in the CL description, this is not supposed to be a semantic change. Before this change, because an apk shared library is just like a normal package, we find the shared library package during the iteration over the package list. After this change, we return earlier for it since we can get the package name in this way.\n\nThis only thing I\u0027m not 100% sure is that the package name we get here is exactly the same as the one we get during the iteration. Thus, I took your suggestion to split this change to a separate CL.",
      "parentUuid": "9c028d69_33c9b3dd",
      "range": {
        "startLine": 578,
        "startChar": 16,
        "endLine": 578,
        "endChar": 78
      },
      "revId": "86f1f408be0483e164638e46607cc111e2ca0bb3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7f29e607_8abe08cd",
        "filename": "libartservice/service/java/com/android/server/art/DexUseManagerLocal.java",
        "patchSetId": 2
      },
      "lineNbr": 578,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-07-18T15:11:09Z",
      "side": 1,
      "message": "\u003e Before this change, because an apk shared library is just like a normal package, we find the shared library package during the iteration over the package list.\n\nOh, I see. Why is it that this will return earlier? Is it because a shared lib used by many packages will be visited from the first of those packages?\n\nIn any case, as mentioned above I hope we can cache them now and then this won\u0027t be necessary. (But it\u0027s still good to have in a separate CL.)",
      "parentUuid": "073f2b09_40b0b261",
      "range": {
        "startLine": 578,
        "startChar": 16,
        "endLine": 578,
        "endChar": 78
      },
      "revId": "86f1f408be0483e164638e46607cc111e2ca0bb3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ce3fd70f_4daab018",
        "filename": "libartservice/service/java/com/android/server/art/DexUseManagerLocal.java",
        "patchSetId": 2
      },
      "lineNbr": 578,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-07-19T10:40:45Z",
      "side": 1,
      "message": "\u003e Why is it that this will return earlier? Is it because a shared lib used by many packages will be visited from the first of those packages?\n\nIt\u0027s because the reason why we load the library in the first place is because we are loading a commonly used package that uses this library as a dependency.",
      "parentUuid": "7f29e607_8abe08cd",
      "range": {
        "startLine": 578,
        "startChar": 16,
        "endLine": 578,
        "endChar": 78
      },
      "revId": "86f1f408be0483e164638e46607cc111e2ca0bb3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5cce6bc5_fd0c52ef",
        "filename": "libartservice/service/java/com/android/server/art/DexUseManagerLocal.java",
        "patchSetId": 2
      },
      "lineNbr": 578,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-07-19T15:00:30Z",
      "side": 1,
      "message": "So basically this trades presumed faster lookups of common shared libs for more work overall for other files. It\u0027s not really obvious that\u0027s a net win. If we can\u0027t make the cache work as discussed above then it\u0027d be good to see how much this gives on top of the cache, i.e. \"(1) + (2) + **(4)**\" vs \"(1) + (2) + (3) + (4)\" in http://b/328673771#comment5.",
      "parentUuid": "ce3fd70f_4daab018",
      "range": {
        "startLine": 578,
        "startChar": 16,
        "endLine": 578,
        "endChar": 78
      },
      "revId": "86f1f408be0483e164638e46607cc111e2ca0bb3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f997d43_dace2909",
        "filename": "libartservice/service/java/com/android/server/art/DexUseManagerLocal.java",
        "patchSetId": 2
      },
      "lineNbr": 578,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-07-19T15:08:29Z",
      "side": 1,
      "message": "\u003e this trades presumed faster lookups of common shared libs\n\nMy mistake, that should be \"this trades caching of common shared libs /.../\", and I  can agree that ought to be beneficial if the ideas above don\u0027t work. Numbers would still be nice, but in that case I wouldn\u0027t give that much confidence to a single app test like in http://b/328673771#comment5, so nvm.",
      "parentUuid": "5cce6bc5_fd0c52ef",
      "range": {
        "startLine": 578,
        "startChar": 16,
        "endLine": 578,
        "endChar": 78
      },
      "revId": "86f1f408be0483e164638e46607cc111e2ca0bb3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}