{
  "comments": [
    {
      "key": {
        "uuid": "03c746dd_15db327c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 33,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T21:19:49Z",
      "side": 1,
      "message": "Test stanza missing.",
      "range": {
        "startLine": 30,
        "startChar": 0,
        "endLine": 33,
        "endChar": 49
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f124cb53_248a89c3",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 38,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T21:19:49Z",
      "side": 1,
      "message": "What\u0027s still using this?",
      "range": {
        "startLine": 38,
        "startChar": 9,
        "endLine": 38,
        "endChar": 26
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "180f8c01_c3cd7cd0",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 38,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T21:39:55Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "f124cb53_248a89c3",
      "range": {
        "startLine": 38,
        "startChar": 9,
        "endLine": 38,
        "endChar": 26
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e85134fe_29dda4b2",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 40,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T21:19:49Z",
      "side": 1,
      "message": "Update and remove the dummy implementation in that header.",
      "range": {
        "startLine": 40,
        "startChar": 9,
        "endLine": 40,
        "endChar": 27
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d47e513b_47794b4d",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 40,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T21:39:55Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "e85134fe_29dda4b2",
      "range": {
        "startLine": 40,
        "startChar": 9,
        "endLine": 40,
        "endChar": 27
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5b6f9aa8_a728e9a4",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 40,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T22:38:40Z",
      "side": 1,
      "message": "With the host emulation you want, we\u0027ll have to keep this for now.",
      "parentUuid": "d47e513b_47794b4d",
      "range": {
        "startLine": 40,
        "startChar": 9,
        "endLine": 40,
        "endChar": 27
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "42c46a33_a7a5d78a",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T21:19:49Z",
      "side": 1,
      "message": "This changes semantics. We lose support for named regions on the host. I\u0027m not happy about that.",
      "range": {
        "startLine": 258,
        "startChar": 44,
        "endLine": 258,
        "endChar": 59
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3cdf85b_c8613cdf",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T21:38:51Z",
      "side": 1,
      "message": "That is true. I can mention that in the CL if you want. I wasn\u0027t sure if this was used, and was also thinking who really depends on that on the host side. Most if not all hosts don\u0027t even have ashmem enabled by default (like my host). Ashmem is only for Android, and for Android kernels we already have a prctl.\n\nIn the future, the prctl could be upstreamed (I have planned for that) and then all Linux systems including hosts can have the needed prctl.",
      "parentUuid": "42c46a33_a7a5d78a",
      "range": {
        "startLine": 258,
        "startChar": 44,
        "endLine": 258,
        "endChar": 59
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5b4defa0_26c86974",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T21:49:58Z",
      "side": 1,
      "message": "*We* use it. We run lots and lots of host tests, and have facilities to dump maps (e.g., for issues with heaps). It\u0027s immensely helpful to understand what regions constitute what.\n\nI\u0027m not against dumping ashmem, but support for named host regions - and if it\u0027s emulated like libcutils does it (and we relied on) is IMHO important.",
      "parentUuid": "d3cdf85b_c8613cdf",
      "range": {
        "startLine": 258,
        "startChar": 44,
        "endLine": 258,
        "endChar": 59
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4860a4c8_23acb01c",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T21:57:57Z",
      "side": 1,
      "message": "Ah I see.\nSo I could just call ashmem_create_region if its a host-only build, for now. Would that work?",
      "parentUuid": "5b4defa0_26c86974",
      "range": {
        "startLine": 258,
        "startChar": 44,
        "endLine": 258,
        "endChar": 59
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2a9d811b_03dbf24c",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T21:59:48Z",
      "side": 1,
      "message": "By the way, for host-only emulation, the name is being ignored, the only benefit is you get to see the data in the map:\n\nint ashmem_create_region(const char* /*ignored*/, size_t size) {",
      "parentUuid": "4860a4c8_23acb01c",
      "range": {
        "startLine": 258,
        "startChar": 44,
        "endLine": 258,
        "endChar": 59
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2831f071_981a8840",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T22:30:21Z",
      "side": 1,
      "message": "Hm. I wonder whether we lost our own facility earlier. I do remember us having had named mmaps through tmp file names. So ignore, I guess.",
      "parentUuid": "2a9d811b_03dbf24c",
      "range": {
        "startLine": 258,
        "startChar": 44,
        "endLine": 258,
        "endChar": 59
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6905ac82_b3b9bef7",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T22:30:21Z",
      "side": 1,
      "message": "What happens if you call the prctl and the call is unsupported? Should this all be the check in line 280, so there\u0027s no work to do once \"upstream\" kernels support set-vma?",
      "range": {
        "startLine": 258,
        "startChar": 6,
        "endLine": 258,
        "endChar": 20
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "feb0f3a8_ce392441",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T22:38:40Z",
      "side": 1,
      "message": "Well its too late now, I spent the last 30 minutes adding it back for you. :D\n\nI think its still useful if you want to see the contents of the maps on the host-only tests (if any)...\n\nare you suggesting I nuke it and don\u0027t create file-backed maps at all?",
      "parentUuid": "2831f071_981a8840",
      "range": {
        "startLine": 258,
        "startChar": 44,
        "endLine": 258,
        "endChar": 59
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4b340b39_ebf135a3",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T22:38:40Z",
      "side": 1,
      "message": "If its an Android kernel then it will support it, if its not an Android kernel - then somebody set the wrong KIsTarget* flags which ended up calling here. If its an Android kernel that doesn\u0027t support it, then the vendor or whoever screwed up the merge down from the common kernel (which will make this and other places that call this prctl lose the functionality)",
      "parentUuid": "6905ac82_b3b9bef7",
      "range": {
        "startLine": 258,
        "startChar": 6,
        "endLine": 258,
        "endChar": 20
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c863ee68_8b4e1b1c",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 258,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T22:56:21Z",
      "side": 1,
      "message": "I meant what happens if PR_SET_VMA is defined, but the kernel doesn\u0027t support it. Does the prctl just return -1 or is the behavior not predictable? I\u0027d like to simplify the condition as much as possible under the assumption that the Android kernel patch will be upstreamed eventually.",
      "parentUuid": "4b340b39_ebf135a3",
      "range": {
        "startLine": 258,
        "startChar": 6,
        "endLine": 258,
        "endChar": 20
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1f7655cc_fc5bf276",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 259,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2018-08-24T21:19:49Z",
      "side": 1,
      "message": "Wrong indent.",
      "range": {
        "startLine": 259,
        "startChar": 2,
        "endLine": 259,
        "endChar": 6
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89731534_e5eb58b8",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 11
      },
      "lineNbr": 259,
      "author": {
        "id": 1124848
      },
      "writtenOn": "2018-08-24T21:39:55Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1f7655cc_fc5bf276",
      "range": {
        "startLine": 259,
        "startChar": 2,
        "endLine": 259,
        "endChar": 6
      },
      "revId": "d9156bf727455827a13ed0634667ddfb58442f2a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}