{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b847fd5e_ec3ebcba",
        "filename": "runtime/gc/heap.cc",
        "patchSetId": 1
      },
      "lineNbr": 207,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2024-03-01T17:22:05Z",
      "side": 0,
      "message": "Why not change here directly? You can change the static_assert to be on `kPreferredAllocSpaceAgain`.",
      "range": {
        "startLine": 207,
        "startChar": 31,
        "endLine": 207,
        "endChar": 34
      },
      "revId": "7a490b995aa96270220862f486c40d1ff8bdd728",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2476c741_7292f5a7",
        "filename": "runtime/gc/heap.cc",
        "patchSetId": 1
      },
      "lineNbr": 207,
      "author": {
        "id": 1958325
      },
      "writtenOn": "2024-03-01T18:12:36Z",
      "side": 0,
      "message": "Oh yeah I tried to do that at the beginning. However `IsAligned()` with a pointer rather than an integral isn\u0027t a valid `constexpr`. This is why I added `kPreferredAllocSpaceBeginAsUint` as an intermediate `constexpr` value.\n\nThat being said, maybe it would be better to turn `kPreferredAllocSpaceBegin` be an integral, and add `reinterpret_cast\u003cuint8_t*\u003e(..)` to the uses. Then we would move all this in heap.h:\n\n```c++\n#if defined(__LP64__) || !defined(ADDRESS_SANITIZER)\n  static constexpr int kMaxPMDSize \u003d (kMaxPageSize / sizeof(uint64_t)) * kMaxPageSize;\n  static constexpr size_t kPreferredAllocSpaceBegin \u003d 320 * MB - kDefaultNonMovingSpaceCapacity;\n  static_assert(IsAligned\u003ckMaxPMDSize\u003e(kPreferredAllocSpaceBegin),\n                \"kPreferredAllocSpaceBegin should be aligned to the maximum \"\n                \"supported PMD size.\");\n#else\n#ifdef __ANDROID__\n  // For 32-bit Android, use 0x20000000 because asan reserves 0x04000000 - 0x20000000.\n  static constexpr size_t kPreferredAllocSpaceBegin \u003d 0x20000000;\n#else\n  // For 32-bit host, use 0x40000000 because asan uses most of the space below this.\n  static constexpr size_t kPreferredAllocSpaceBegin \u003d 0x40000000;\n#endif\n#endif\n\n```\nDoes this seem better? I guess that would address your other comment too?\n\nUnless there\u0027s a way to check is a pointer is aligned with a `static_assert`/`constexpr`, that\u0027d be best I think",
      "parentUuid": "b847fd5e_ec3ebcba",
      "range": {
        "startLine": 207,
        "startChar": 31,
        "endLine": 207,
        "endChar": 34
      },
      "revId": "7a490b995aa96270220862f486c40d1ff8bdd728",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}