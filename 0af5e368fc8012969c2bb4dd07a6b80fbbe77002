{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "20908927_f79d71b2",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2022-06-09T14:19:32Z",
      "side": 1,
      "message": "I think this will affect many log messages in dex2oat and other tools as well. Do we want that? Maybe it\u0027s better to set it in defaults for various shared runtime libraries instead? E.g. libartbase, runtime, libdexfile, etc.",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e2aab47e_62eed97f",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2022-06-10T09:47:46Z",
      "side": 1,
      "message": "Right - you\u0027re saying I\u0027m introducing a regression where currently the tag for dex2oat would always be \"dex2oat\" and now I\u0027m changing it to be ART?\n\nThat would be tricky to resolve though - dex2oat uses libart.so and libart.so will be compiled with the \"art\" tag.\n\nTom, is there a solution for this? Can we make the dex2oat process always use the tag \"dex2oat\"? If not, I\u0027d rather we be consistent, so either:\n1) Use the \u0027art\u0027 tag (this CL)\n2) Use the process name tag (the current behavior)",
      "parentUuid": "20908927_f79d71b2",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0bc97ec_d2c3b03b",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2022-06-10T11:30:31Z",
      "side": 1,
      "message": "That\u0027s also an aspect, but as you say, it\u0027s tricky to resolve, and with the argument b/234733378 I suppose the dex2oat tag on such messages from libart are considered regressions as well(*).\n\nHowever, I was more thinking that this defaults get inherited into all compilation units, not only libart, libdexfile, etc. So we\u0027d get the \"art\" tag in top level messages in dex2oat/*.cc as well.\n\n*) Then it\u0027s another question whether it\u0027s a good idea to fix a regression that occurred as far back as 2017. Arguably it\u0027d be a new regression for everything that has started to depend on the de-facto tags after that date.",
      "parentUuid": "e2aab47e_62eed97f",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a1d90fd_1449bed0",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2022-06-11T00:23:37Z",
      "side": 1,
      "message": "dex2oat as the tag for that process is part of the regression, though I understand why that process is special and may want to be tagged differently. It should be possible to keep dex2oat for that process and use art for others:\n\nIf I understand correctly:\n* dex2oat gets its tag from its process name and not a LOG_TAG define? \n* It is built as a separate executable so it should be able to specify its own LOG_TAG in it\u0027s Android.bp\n* The caveat is that this CL specifies LOG_TAG as the default that dex2oat uses, so it would need to override the default\n\nI believe this can be done by adding the below to the Android.bp that builds dex2oat\n\"-ULOG_TAG\"\n\"-DLOG_TAG\u003d\\\"dex2oat\\\"\"\n\nI\u0027m basing that belief on how target specific #define overrides are done, for example here: https://cs.android.com/android/platform/superproject/+/master:system/core/init/Android.bp;l\u003d128.\n\nIf that doesn\u0027t work the Soong team could be consulted.",
      "parentUuid": "b0bc97ec_d2c3b03b",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37029ef4_26af6347",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2022-06-15T12:35:24Z",
      "side": 1,
      "message": "Can this really be done? dex2oat and zygote shared libart.so - and libart.so can only be compiled with one LOG_TAG.",
      "parentUuid": "6a1d90fd_1449bed0",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "153f1aac_5835c059",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2022-06-15T20:51:32Z",
      "side": 1,
      "message": "Ah, right. That would only change the LOG_TAG for the dex2oat specific files, not the ones that had already been compiled into libart.so.  If you use the LOG_TAG approach, zygote and dex2oat will all have the \u0027art\u0027 log tag.\n\nIs that a problem though? It seems that most Java processes use LOG_TAG to differentiate the internal classes that generated the logs, since the pid can be used to filter logs by process. Are there some files within ART that are only used by either zygote or dex2oat that would benefit from more specific LOG_TAG within that file? The rest would remain as \u0027art\u0027.",
      "parentUuid": "37029ef4_26af6347",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7b615a96_6c9853f9",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2022-06-16T08:20:02Z",
      "side": 1,
      "message": "I fail to really weigh the severity of b/234733378 compared to having \u0027art\u0027 as a log tag for most of our libraries. If b/234733378 really should be fixed, and we want this CL, then I\u0027m willing to accept the \"regression\" of dex2oat emitting \"art\" log tags.",
      "parentUuid": "153f1aac_5835c059",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "785a974a_d7ca6f98",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2022-06-16T16:41:10Z",
      "side": 1,
      "message": "The issue if b/234733378 is not fixed is that it will lead to confusion, especially when developers (platform and potentially app developers) are on-boarded. Our team has many new-to-Android developers and some engineers whose only experience with Android is triaging failures, so confusion in the logs has been a big concern. In the app case, it would be a big help if logs emitted from ART were tagged as such. \n\nI understand the benefit of keeping dex2oat emitting `dex2oat` logs since many non-Java / non-App processes use a single tag for their logs. There are some options, though they\u0027re not too clean. I don\u0027t believe there\u0027s a restriction that LOG_TAG must be a literal, so a variable could be used in libart and set appropriately.\n\nI\u0027ll add enh@ here in case he sees something that I don\u0027t which would more easily allow the dex2oat case to stay as-is.",
      "parentUuid": "7b615a96_6c9853f9",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4c52d0d_7bf00a89",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2022-06-16T16:55:24Z",
      "side": 1,
      "message": "i actually thought that using the process name was a feature, because we used to have the opposite problem (similar to the \"all stacks that end in abort() get assigned to the libc team, who have to say \u0027you called abort, and we did what you asked\u0027\").\n\nbut we did leave this LOG_TAG stuff in specifically so teams could choose their poison (because, yeah, neither is ideal, and we don\u0027t let you store _both_, which is i think the core problem --- different people legitimately disagree about which is more important, not least because it can depend on \"what\u0027s the bug you\u0027re looking at?\").\n\n(the truncation is sad, though. personally i\u0027d rather fix that!)",
      "parentUuid": "785a974a_d7ca6f98",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07b0eb87_e253d8e3",
        "filename": "build/Android.bp",
        "patchSetId": 8
      },
      "lineNbr": 153,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2022-06-17T09:13:28Z",
      "side": 1,
      "message": "I agree that process name is a nice feature - and didn\u0027t think that it indeed probably also helped the ART team not getting assigned all crashes due to the app.",
      "parentUuid": "a4c52d0d_7bf00a89",
      "range": {
        "startLine": 152,
        "startChar": 8,
        "endLine": 153,
        "endChar": 28
      },
      "revId": "0af5e368fc8012969c2bb4dd07a6b80fbbe77002",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}