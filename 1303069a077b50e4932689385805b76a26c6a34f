{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5a227712_57ff1bde",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2021-03-11T01:21:41Z",
      "side": 1,
      "message": "Could you please address the comments before submission? ",
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae83df03_243a3d4b",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3162,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-11T00:58:06Z",
      "side": 1,
      "message": "My question was really about why we need to do this in chunks rather all at once. What\u0027s the performance advantage? Clearly the additional kernel entries don\u0027t help.",
      "range": {
        "startLine": 3161,
        "startChar": 7,
        "endLine": 3162,
        "endChar": 51
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "933b2f88_4b173b77",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3162,
      "author": {
        "id": 1017430
      },
      "writtenOn": "2021-03-11T01:06:00Z",
      "side": 1,
      "message": "madvise(MADV_WILLNEED) will prefetch max(fd readahead size, optimal block size for device) per call, hence the need for chunks. (128KB is a good default.)",
      "parentUuid": "ae83df03_243a3d4b",
      "range": {
        "startLine": 3161,
        "startChar": 7,
        "endLine": 3162,
        "endChar": 51
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e6f8e92b_049728b0",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3162,
      "author": {
        "id": 1651269
      },
      "writtenOn": "2021-03-11T01:41:05Z",
      "side": 1,
      "message": "Would adding the above information (from Tim) as a comment address the clarity concern? Please let me know.",
      "parentUuid": "933b2f88_4b173b77",
      "range": {
        "startLine": 3161,
        "startChar": 7,
        "endLine": 3162,
        "endChar": 51
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3842f220_7fb46cbe",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3162,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-11T01:53:38Z",
      "side": 1,
      "message": "Thanks! I don\u0027t see that documented in the madvise man page, so I think it would be great to have a comment saying that here.",
      "parentUuid": "933b2f88_4b173b77",
      "range": {
        "startLine": 3161,
        "startChar": 7,
        "endLine": 3162,
        "endChar": 51
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "53488e6e_4964c1f6",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3162,
      "author": {
        "id": 1651269
      },
      "writtenOn": "2021-03-12T02:27:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3842f220_7fb46cbe",
      "range": {
        "startLine": 3161,
        "startChar": 7,
        "endLine": 3162,
        "endChar": 51
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "645838d0_f0ca2c47",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-11T00:58:06Z",
      "side": 1,
      "message": "I think the usual reporting mechanism here is LOG(WARNING) \u003c\u003c ...\nDoes ScopedTrace also show up in the log? Will it be visible in Bugreports?\nIt looks like EINTR is not a possibility. EAGAIN is, but unless we see it a lot, this is probably the right response in that case. So I\u0027m OK with this so long as it leaves a trace in logcat.",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d9c9db5a_d5e03a3f",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1017430
      },
      "writtenOn": "2021-03-11T01:06:00Z",
      "side": 1,
      "message": "given that this is an opportunistic performance improvement, putting additional data in logcat is IMO not worth it; logcat is so noisy that this will be lost.",
      "parentUuid": "645838d0_f0ca2c47",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0aa6250_915b53e0",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2021-03-11T01:21:41Z",
      "side": 1,
      "message": "are you sure you want this in the trace? A log(error) seems more appropriate.\n\nIf you\u0027re planning to use this for trace-monitoring, add a comment on why not using the usual error logging. (and logging the number of bytes already madvised is probably a good idea).",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "afb3484d_ecbd0916",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1651269
      },
      "writtenOn": "2021-03-11T01:36:27Z",
      "side": 1,
      "message": "Following Tim\u0027s comment, we do not plan to do anything actionable based on the errors. I can remove the tracepoint.\n\nDo we want to spam the logcat with bytes? We\u0027ll make ~(50MB/128KB) madvise calls per file type, per app launch.\n\nLet me know.",
      "parentUuid": "a0aa6250_915b53e0",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "473365f7_cf73af2d",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2021-03-11T01:40:40Z",
      "side": 1,
      "message": "This will be at most once per file, right? Cause you break after. And we don\u0027t really expect it to happen either. So I think an error logging is fine.",
      "parentUuid": "afb3484d_ecbd0916",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0390adeb_aa201261",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-11T01:53:38Z",
      "side": 1,
      "message": "I agree with Calin, in that I think a failure here is very unexpected, and thus likely to be actionable, and thus should be in the logcat. I\u0027m not opposed to tracing it as well. (Is an empty ScopedTrace like this really visible there, though?) In my view, any really unexpected behavior like this should go in the log, and we should clean up the other stuff, so that the actionable stuff remains visible.\n\nIf there is a reason we should expect this to occasionally fail on a healthy device, I withdraw my comment. But I don\u0027t think so.",
      "parentUuid": "d9c9db5a_d5e03a3f",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "20b9bb46_49056243",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1651269
      },
      "writtenOn": "2021-03-12T02:27:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "473365f7_cf73af2d",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9221c7a4_ec956c62",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1651269
      },
      "writtenOn": "2021-03-12T02:27:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0390adeb_aa201261",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4aac4996_547d053f",
        "filename": "runtime/runtime.cc",
        "patchSetId": 8
      },
      "lineNbr": 3172,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-12T02:50:41Z",
      "side": 1,
      "message": "If we start seeing any of these, I would include strerror(errno) as well. But that currently seems unlikely enough that this should be fine.",
      "parentUuid": "20b9bb46_49056243",
      "range": {
        "startLine": 3172,
        "startChar": 8,
        "endLine": 3172,
        "endChar": 73
      },
      "revId": "1303069a077b50e4932689385805b76a26c6a34f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}