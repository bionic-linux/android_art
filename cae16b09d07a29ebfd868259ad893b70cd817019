{
  "comments": [
    {
      "key": {
        "uuid": "0f302a55_05786a50",
        "filename": "runtime/native/sun_misc_Unsafe.cc",
        "patchSetId": 14
      },
      "lineNbr": 515,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-10-22T20:38:27Z",
      "side": 1,
      "message": "Looking at the old java implemenation you seem to be assuming that FromManagedThread will throw an exception or something if the object is not a jthread. This is not true though. In fact FromManagedThread will simply read an field at an offset into the object. This will only return null if the thread is not runnning anymore.\n\nTo match the old behavior you should check that the \u0027jthread\u0027 arg is an actual Thread object and throw an error if it isn\u0027t.",
      "range": {
        "startLine": 515,
        "startChar": 24,
        "endLine": 515,
        "endChar": 68
      },
      "revId": "cae16b09d07a29ebfd868259ad893b70cd817019",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8a12e68_6eb460ec",
        "filename": "runtime/native/sun_misc_Unsafe.cc",
        "patchSetId": 14
      },
      "lineNbr": 515,
      "author": {
        "id": 1059543
      },
      "writtenOn": "2018-10-22T20:40:55Z",
      "side": 1,
      "message": "What layer should I do that check in? LockSupport.unpark has a type-safe API, and Unsafe isn\u0027t public API... and all the other methods in Unsafe are, well unsafe...",
      "parentUuid": "0f302a55_05786a50",
      "range": {
        "startLine": 515,
        "startChar": 24,
        "endLine": 515,
        "endChar": 68
      },
      "revId": "cae16b09d07a29ebfd868259ad893b70cd817019",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "773e9481_72bf48f8",
        "filename": "runtime/native/sun_misc_Unsafe.cc",
        "patchSetId": 14
      },
      "lineNbr": 515,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-10-22T20:47:07Z",
      "side": 1,
      "message": "Changing the java api is a no-go (it\u0027s not public but is on the Greylist IIRC so it\u0027s kind-of public). I\u0027d just put it in this function here.\n\nJust add something like:\n\n  if (jthread \u003d\u003d nullptr || !env-\u003eIsInstanceOf(jthread, WellKnownClasses::java_lang_Thread)) {\n    // Throw error\n    return;\n  }",
      "parentUuid": "0f302a55_05786a50",
      "range": {
        "startLine": 515,
        "startChar": 24,
        "endLine": 515,
        "endChar": 68
      },
      "revId": "cae16b09d07a29ebfd868259ad893b70cd817019",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "11064917_2a8e40eb",
        "filename": "runtime/native/sun_misc_Unsafe.cc",
        "patchSetId": 14
      },
      "lineNbr": 515,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-10-22T20:48:41Z",
      "side": 1,
      "message": "Alternatively you could make this be called by Unsafe.nativeUnpark(Thread thr) and leave unpark as a java wrapper that does the check.",
      "parentUuid": "773e9481_72bf48f8",
      "range": {
        "startLine": 515,
        "startChar": 24,
        "endLine": 515,
        "endChar": 68
      },
      "revId": "cae16b09d07a29ebfd868259ad893b70cd817019",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}