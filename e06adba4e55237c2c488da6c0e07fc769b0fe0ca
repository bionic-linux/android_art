{
  "comments": [
    {
      "key": {
        "uuid": "e27a7932_f223ec3e",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1057043
      },
      "writtenOn": "2016-03-01T22:21:23Z",
      "side": 1,
      "message": "I wonder why we have 3 inputs here when it looks like there should be just 1. MIPS64 and ARM64 versions are implemented similarly. What am I missing?",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "42f42502_a13598d9",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2016-03-02T10:24:28Z",
      "side": 1,
      "message": "Right, I forgot to add a comment about that.  We\u0027re still figuring out why the ARM64 and MIPS64 were implemented this way, but those implementations passing three arguments are wrong.\n\nAs you noticed, we\u0027ve started to address this in https://android-review.googlesource.com/#/c/205382/.  Chris, could you alter this very CL (https://android-review.googlesource.com/#/c/197445) to pass just one argument to the MIPS32 StringNewStringFromString intrinsic?  Thanks.",
      "parentUuid": "e27a7932_f223ec3e",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e27a7932_4b37a638",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1071873
      },
      "writtenOn": "2016-03-02T17:07:06Z",
      "side": 1,
      "message": "After making the change the emulator boots but I can\u0027t connect using \"adb shell\". When I put the second, and third arguments back, \"adb shell\" resumes working. Need to test to see if I can just delete the third argument.",
      "parentUuid": "42f42502_a13598d9",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "82037dbe_db55279b",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2016-03-02T17:14:25Z",
      "side": 1,
      "message": "This is odd.  I\u0027ll try to test on the emulator on my side as well.",
      "parentUuid": "e27a7932_4b37a638",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e27a7932_4bb8060f",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1071873
      },
      "writtenOn": "2016-03-02T18:24:59Z",
      "side": 1,
      "message": "I just did a sanity test on only passing two arguments (build emulator, run emulator, run test/082-inline-execute), and the tests pass (\"--optimizing\", \"\", \"--no-prebuild --optimizing\", and \"--no-prebuild). More exhaustive testing may show that this is broken too.\n\nI\u0027ve also been tracking through the code and it lead me to\n- lines 231/244 of /runtime/entrypoints/quick/quick_alloc_entrypoints.cc, then to \n- lines 43/87 of runtime/arch/quick_alloc_entrypoints.S, and finally to\n- line 1274 of runtime/arch/mips/quick_entrypoints_mips.S.\n\nThis code/macro (line 1274 of runtime/arch/mips/quick_entrypoints_mips.S) passes the Thread::Current (\"move $a1, rSELF\") as the second argument so, to me, it makes a certain amount of sense that the code works when passed two arguments (deleting only the third/last argument) but deleting the last two arguments causes a problem.\n\nDid I follow the code properly, and get to the correct place?",
      "parentUuid": "82037dbe_db55279b",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a2e32149_2cca0893",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1071873
      },
      "writtenOn": "2016-03-03T09:04:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e27a7932_4bb8060f",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a2b16159_144e5a39",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2016-03-03T14:49:27Z",
      "side": 1,
      "message": "I think your reasoning is correct, but I\u0027m not sure to understand the conclusion.\n\nThe ONE_ARG_DOWNCALL macro supposedly generates an entrypoint taking one argument (through A0 on MIPS), passing it (delegating) to an actual routine (artAllocStringFromStringFromCode*, defined in runtime/entrypoints/quick/quick_alloc_entrypoints.cc), as well as Thread::Current (though A1).  So it does not make sense for me to pass more than one argument, as the artAllocStringFromStringFromCode* routines take two arguments (mirror::String* string, Thread* self).\n\nI haven\u0027t tried your CL on the MIPS emulator yet, but will do ASAP.",
      "parentUuid": "a2e32149_2cca0893",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a26ec178_6333abad",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1071873
      },
      "writtenOn": "2016-03-03T15:52:09Z",
      "side": 1,
      "message": "Long story short I think my conclusion was wrong. I think when tested the change w/only one argument I made some other mistake. Retested and another code search and decided to try the change again. Now it works.",
      "parentUuid": "a2b16159_144e5a39",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "82ea9d1e_79017624",
        "filename": "compiler/optimizing/intrinsics_mips.cc",
        "patchSetId": 13
      },
      "lineNbr": 1936,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2016-03-03T21:09:01Z",
      "side": 1,
      "message": "jeffhao, what\u0027s the reason for this weird 64-bit code with many inputs? (coming from commit 848f70a3d)",
      "parentUuid": "a26ec178_6333abad",
      "range": {
        "startLine": 1934,
        "startChar": 0,
        "endLine": 1936,
        "endChar": 89
      },
      "revId": "e06adba4e55237c2c488da6c0e07fc769b0fe0ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}