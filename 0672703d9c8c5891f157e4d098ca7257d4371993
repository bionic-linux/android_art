{
  "comments": [
    {
      "key": {
        "uuid": "f0079550_1046e436",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 211,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2015-10-07T08:56:03Z",
      "side": 1,
      "message": "At this level, this looks like black magic. Why isn\u0027t the allocator dealing with all of this?",
      "range": {
        "startLine": 203,
        "startChar": 0,
        "endLine": 211,
        "endChar": 93
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d00a915c_29abc1b2",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 211,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2015-10-07T21:01:57Z",
      "side": 1,
      "message": "Happy to change this to whatever you suggest.\n---\n\nWell, I can move it into AllocateMemory but then the return type is still \n\n   std::aligned_storage\u003clong expression, long expression\u003e::type*\n\nwhich is perfectly fine if you want me to change this to\n\n   // Allocate well-aligned memory to store an ArtLambdaMethod.\n   auto* uninitialized_lambda_method \u003d lambda::LeakingAllocator::AllocateMemory\u003cArtLambdaMethod\u003e(self);\n\nor it could just use a void* but I find that loses the alignment and the size information which is problematic.\n\nI suppose even in this case it might not even matter too much that if it was \"auto*\" since it gets used only for in-place new which works on any non-const void* (unfortunately there\u0027s no easy way to say non-const auto).\n\n----\nThe real simple answer is that AllocateMemory can over-allocate (for structs that have a [0]sized array element, \"flexible arrays\") so I just wanted to reuse that same mechanism for allocating non-flexible structs.\n\nIn the end that whole class is going to go away so I didn\u0027t want to put too much thought into it, other than clearly marking every call site to be updated later.",
      "parentUuid": "f0079550_1046e436",
      "range": {
        "startLine": 203,
        "startChar": 0,
        "endLine": 211,
        "endChar": 93
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a154685_65c7a674",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 211,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2015-10-09T09:28:55Z",
      "side": 1,
      "message": "What bothers me really is the alignment concerns. Why should allocation sites care about allocation alignments?",
      "parentUuid": "d00a915c_29abc1b2",
      "range": {
        "startLine": 203,
        "startChar": 0,
        "endLine": 211,
        "endChar": 93
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e55355fb_d9c8a73d",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 211,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2015-10-09T17:53:41Z",
      "side": 1,
      "message": "Well, I can move it to LeakingAllocator, not a problem.\n\n-----\n\nIn general though doing a \n\n  new (some_ptr) T(...)\n\nthe alignof(*some_ptr) should be at least as much as alignof(T)\n\notherwise the in-place new is unsound (undefined behavior).",
      "parentUuid": "8a154685_65c7a674",
      "range": {
        "startLine": 203,
        "startChar": 0,
        "endLine": 211,
        "endChar": 93
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70664538_d4357c13",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 247,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2015-10-07T08:56:03Z",
      "side": 1,
      "message": "nit: this one the line above and the arguments each on their line?",
      "range": {
        "startLine": 247,
        "startChar": 8,
        "endLine": 247,
        "endChar": 65
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b0435d80_0d0d1d04",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 247,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2015-10-07T21:01:57Z",
      "side": 1,
      "message": "This way is preferred because the arguments are aligned to the (\n\nIt\u0027s always preferable to align to the (, {, etc over doing a \"i give up, so just wrap and indent 4 spaces\" type of alignment.\n\n----\nAs for something like\n\n   var \u003d foo(x,\n             y,\n             z)\n\nThat doesn\u0027t actually fit because the \"\u003d ...\" part of the expression is pretty long.\n\nI can update the guide if this was stated ambiguous earlier?",
      "parentUuid": "70664538_d4357c13",
      "range": {
        "startLine": 247,
        "startChar": 8,
        "endLine": 247,
        "endChar": 65
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aadf6a22_fed7a11a",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 247,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2015-10-09T09:28:55Z",
      "side": 1,
      "message": "What I\u0027m suggesting is:\n\ninit_lm \u003d new () ArtLambdaMethod(\n  called_method,\n  captured,\n  ...)\n\nWhy is it always preferable to align to the \u0027(\u0027?",
      "parentUuid": "b0435d80_0d0d1d04",
      "range": {
        "startLine": 247,
        "startChar": 8,
        "endLine": 247,
        "endChar": 65
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "45426131_bfa49ffb",
        "filename": "runtime/interpreter/interpreter_common.h",
        "patchSetId": 1
      },
      "lineNbr": 247,
      "author": {
        "id": 1021471
      },
      "writtenOn": "2015-10-09T17:53:41Z",
      "side": 1,
      "message": "That\u0027s just the rule we have in the style guide, always align to the ( of the expression you are in if possible. \n\nThe indent 4 spaces to the right thing is only when one of the args can\u0027t fit cause maybe the parameter name or the function name is too long.\n\nAndreas wanted a consistent set of guidelines for how to indent and this provides a simple clear-cut \"priority A,B,C\" set of indentation rules.",
      "parentUuid": "aadf6a22_fed7a11a",
      "range": {
        "startLine": 247,
        "startChar": 8,
        "endLine": 247,
        "endChar": 65
      },
      "revId": "0672703d9c8c5891f157e4d098ca7257d4371993",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}