{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d75a106c_0702c330",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2021-03-31T07:23:11Z",
      "side": 1,
      "message": "Thanks Martin! I was wondering if this is also necessary with go/ag/14047085 in place?",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9dc05f4f_82527035",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2021-03-31T11:40:07Z",
      "side": 1,
      "message": "It depends on whether you need this to test to work with ART prebuilts or not. If it does then it can run on platform head against prebuilts of the ART module, otherwise it\u0027d only run on fixed platform images against master-art head.\n\nIf it should be used with prebuilts then we shouldn\u0027t do this CL, but rather add the necessary prebuilt modules, which at least means exporting test_com.android.art as a prebuilt module.\n\nSo what\u0027s the plan here?",
      "parentUuid": "d75a106c_0702c330",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5df16b32_d58b55a2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2021-03-31T11:42:08Z",
      "side": 1,
      "message": "Also, if the test should work with ART prebuilts in platform builds then it can\u0027t be in art/, because we\u0027ll remove the ART repos from the platform manifests.",
      "parentUuid": "9dc05f4f_82527035",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce94828e_10dedbba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2021-03-31T11:46:11Z",
      "side": 1,
      "message": "Yeah, I do think we should run this as part of the platform, because a part of what we\u0027re testing (odsign) is in the platform. So I think I\u0027ll move the test to system/security/ondevice-signing . If I do that, plus:\ngo/ag/14049406 and go/ag/14047085, I wonder if that is enough.",
      "parentUuid": "5df16b32_d58b55a2",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54e637f7_43cd3255",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2021-03-31T12:01:49Z",
      "side": 1,
      "message": "Then, if the test should also work on ART head it\u0027ll have to work in the master-art manifest. Short term it may be ok to add system/security to master-art if it doesn\u0027t bring in too many dependencies, but longer term we\u0027d need prebuilts for the test.\n\nIn any case, would you move test_com.android.art with the test then? What\u0027s the purpose of it?\n\n\u003e go/ag/14049406 and go/ag/14047085, I wonder if that is enough.\n\nI guess you\u0027re doing that because you need an APEX signed with the internal dev key to test with? If so, and if the test APEX is moved with the test then you\u0027d need essentially the same thing but maybe with the override_apex in a different location.",
      "parentUuid": "ce94828e_10dedbba",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5b3c626_d775e55a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2021-03-31T12:08:40Z",
      "side": 1,
      "message": "I think I\u0027m also fine with running this test only in the platform, but if I understand you correctly that means we need a test prebuilt as soon as ART gets moved out of the platform manifest?\n\nThe reason I need test_com.android.art is that I need to trigger the \"on-device signing\" flow for new artifacts; the odrefresh binary inside the ART apex determines whether new artifacts need to be generated, and the easiest way to trigger it to generate new artifacts is to install an ART apex which has a higher version number.\n\nI\u0027m not sure how easy it is to move test_com.android.art itself - I think it needs to be in the ART tree because it needs to be built exactly like the ART apex. (In fact, it is just an ART apex with a higher module version number).",
      "parentUuid": "54e637f7_43cd3255",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "47829a8c_b18f3609",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2021-03-31T12:29:11Z",
      "side": 1,
      "message": "Yes, we\u0027ll need prebuilts of the test_com.android.art APEX right away when the test is in system/security, because I\u0027m working on getting platform to use prebuilts right now and will enable it in platform builds as soon as I can.\n\n\u003e In fact, it is just an ART apex with a higher module version number\n\nI see. That means we\u0027ll need a new set of prebuilt APEXes both in packages/modules/ArtPrebuilt and vendor/unbundled_google/modules/ArtGooglePrebuilt. It\u0027ll add ~200 MB in both places, and considering we want to do frequent prebuilt drops eventually that\u0027ll become a bit of a concern - I wonder if it may be possible to take a stock prebuilt and repackage it with the higher version number? It\u0027d need to be resigned then, though.\n\nShort term though, new prebuilts are probably fine.\n\nI see it\u0027s currently an instance of the debug APEX rather than the release one. Does it have to be that? The debug APEXes are ~50% bigger.",
      "parentUuid": "a5b3c626_d775e55a",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d5e005dd_a56c70bf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2021-03-31T12:38:42Z",
      "side": 1,
      "message": "Yeah the re-signing might be an issue, though I guess we only need this to run on -userdebug builds, so presumably we do have the keys available. I don\u0027t know enough about the APEX build system whether that is feasible. If possible I\u0027d like to at least get these tests going asap, as they\u0027re required for marking the feature complete.\n\nWould the following sequence be an option:\n1) First get the tests going as they are (eg running from platform/art)\n2) Get prebuilts going for the test apex, and move the test to system/security\n3) Potential future optimization: get rid of test APEX prebuilt, repackage the existing APEX with a higher version number..",
      "parentUuid": "47829a8c_b18f3609",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "75d3ead0_886219b3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2021-03-31T12:39:44Z",
      "side": 1,
      "message": "Oh and re: the debug apex, I guess there\u0027s not really a reason for that, but since the test runs on -userdebug, I wanted to keep it as close as possible to the \"normal\" apex on -userdebug (which is the debug APEX IIUC). But if switching to release helps with the sizes, I\u0027m totally fine with that.",
      "parentUuid": "d5e005dd_a56c70bf",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8ef43adf_f5cbcd53",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2021-03-31T12:54:14Z",
      "side": 1,
      "message": "For step 1 we\u0027d go ahead with this CL then.\n\nDo you plan to add the test to TH pre- or postsubmit testing at step 1? If so, in which builds? Then I wouldn\u0027t be able to switch them to prebuilts before #2 is done.\n\nAs for the debug APEX, yes please switch it to be based on the release. The debug variant is actually no longer used for userdebug, now it\u0027s only used in AOSP eng builds.",
      "parentUuid": "75d3ead0_886219b3",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5366389_08496897",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2021-03-31T13:00:09Z",
      "side": 1,
      "message": "I was planning to add them to the TEST_MAPPING for system/security/ondevice-signing, which would put them in presubmit for regular platform builds (I guess in aosp / sc-dev / internal master branches?)",
      "parentUuid": "8ef43adf_f5cbcd53",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "340a93d7_9aff2909",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2021-03-31T13:09:17Z",
      "side": 1,
      "message": "Yeah, then I\u0027d be effectively blocked until step #2, which means it needs to happen quite soon afterwards. I can help out setting up the prebuilts. Is there a ticket tracking this?\n\nBtw, re #3, yes I\u0027m fairly sure we can (re)sign in platform builds (except for \"user\" images) - that\u0027s what we do when building from source after all. There\u0027s also been talk about changing the prebuilt APEXes to another format, e.g. a zip file or even the unpacked file system - this isn\u0027t the first time we\u0027ve needed to unpack them and get to info inside.",
      "parentUuid": "f5366389_08496897",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3e247fd6_b028ab42",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2021-03-31T13:19:56Z",
      "side": 1,
      "message": "There\u0027s a ticket for the feature test, but I was planning to close that once they\u0027re running. I\u0027m happy to create a new one, which component should it be in? I can also help out with getting the prebuilt setup, let me know whatever is best for you. What timeline are you looking at for when #2 needs to be done?",
      "parentUuid": "340a93d7_9aff2909",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5960ff91_2c9dd789",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2021-03-31T13:43:00Z",
      "side": 1,
      "message": "I filed b/184143265 for it then. Let\u0027s continue the discussion on planning there.\n\nFor the moment I\u0027ll go ahead with this CL, so resolving this issue.",
      "parentUuid": "3e247fd6_b028ab42",
      "revId": "b30a5a1f26ea26d59baa7722fcf31aaa3c727563",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}