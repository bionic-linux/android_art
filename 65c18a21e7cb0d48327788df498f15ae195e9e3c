{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "418568d8_4d0036dd",
        "filename": "runtime/base/mutex.cc",
        "patchSetId": 3
      },
      "lineNbr": 538,
      "author": {
        "id": 1452753
      },
      "writtenOn": "2021-03-07T01:38:54Z",
      "side": 1,
      "message": "If ART_USE_FUTEXES is not 1, WaitBrieflyFor will not be called. Does the pthread mode work well?",
      "range": {
        "startLine": 533,
        "startChar": 0,
        "endLine": 538,
        "endChar": 6
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0d39cec9_c7d31d20",
        "filename": "runtime/base/mutex.cc",
        "patchSetId": 3
      },
      "lineNbr": 538,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-07T02:25:52Z",
      "side": 1,
      "message": "It will not have the performance advantages of spinning here. We generally don\u0027t worry too much about performance in the pthread case; Android always uses futexes.",
      "parentUuid": "418568d8_4d0036dd",
      "range": {
        "startLine": 533,
        "startChar": 0,
        "endLine": 538,
        "endChar": 6
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b31a764f_0374feef",
        "filename": "runtime/base/mutex.cc",
        "patchSetId": 3
      },
      "lineNbr": 538,
      "author": {
        "id": 1452753
      },
      "writtenOn": "2021-03-07T05:30:48Z",
      "side": 1,
      "message": "Is there a performance testing data about this change comparing with the old solution?",
      "parentUuid": "0d39cec9_c7d31d20",
      "range": {
        "startLine": 533,
        "startChar": 0,
        "endLine": 538,
        "endChar": 6
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63fa2a7c_9745053d",
        "filename": "runtime/base/mutex.cc",
        "patchSetId": 3
      },
      "lineNbr": 538,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-07T05:52:14Z",
      "side": 1,
      "message": "The added test here works as microbenchmark. The new version is much faster in the presence of monitor contention; details vary depending on configuration. This does not show up for many benchmarks; it did make a significant difference for H2.",
      "parentUuid": "b31a764f_0374feef",
      "range": {
        "startLine": 533,
        "startChar": 0,
        "endLine": 538,
        "endChar": 6
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff99fef1_da679594",
        "filename": "runtime/base/mutex.cc",
        "patchSetId": 3
      },
      "lineNbr": 538,
      "author": {
        "id": 1452753
      },
      "writtenOn": "2021-03-07T06:43:17Z",
      "side": 1,
      "message": "Sorry, could you tell me about the meaning of \"H2\"?  Does it mean the second half year of 2020?",
      "parentUuid": "63fa2a7c_9745053d",
      "range": {
        "startLine": 533,
        "startChar": 0,
        "endLine": 538,
        "endChar": 6
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "df773e5a_bf85136c",
        "filename": "runtime/base/mutex.cc",
        "patchSetId": 3
      },
      "lineNbr": 538,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-07T18:23:12Z",
      "side": 1,
      "message": "This was tested with something similar to the Dacapo H2 benchmark. I\u0027m not sure exactly how the configuration was chosen.",
      "parentUuid": "ff99fef1_da679594",
      "range": {
        "startLine": 533,
        "startChar": 0,
        "endLine": 538,
        "endChar": 6
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e615681_1b015434",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 240,
      "author": {
        "id": 1452753
      },
      "writtenOn": "2021-03-08T08:40:48Z",
      "side": 1,
      "message": "lockCount should be lock_count_. It may cause compiling failure if ART_USE_FUTEXES disabled.",
      "range": {
        "startLine": 240,
        "startChar": 34,
        "endLine": 240,
        "endChar": 43
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8355ebc5_c8b88cb7",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 240,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-08T18:13:38Z",
      "side": 1,
      "message": "Thanks for reporting! It looks like this is used even less than I had thought. I don\u0027t think that fix is sufficient. I filed a bug and I\u0027ll look into it.",
      "parentUuid": "7e615681_1b015434",
      "range": {
        "startLine": 240,
        "startChar": 34,
        "endLine": 240,
        "endChar": 43
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ca206235_2c7a474c",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 240,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-08T20:03:31Z",
      "side": 1,
      "message": "Uploaded https://android-review.googlesource.com/c/platform/art/+/1621747 .",
      "parentUuid": "8355ebc5_c8b88cb7",
      "range": {
        "startLine": 240,
        "startChar": 34,
        "endLine": 240,
        "endChar": 43
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6601af4_c5ef5eb0",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 240,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-08T23:25:46Z",
      "side": 1,
      "message": "Did you have a particular need for compiling without ART_USES_FUTEXES? There are enough other issues with ART in that mode that it doesn\u0027t appear to be useful. My current plan is to just remove the support from monitor.cc.",
      "parentUuid": "ca206235_2c7a474c",
      "range": {
        "startLine": 240,
        "startChar": 34,
        "endLine": 240,
        "endChar": 43
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22f1022c_b54d4707",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 240,
      "author": {
        "id": 1452753
      },
      "writtenOn": "2021-03-09T01:28:33Z",
      "side": 1,
      "message": "I just want to test the performance difference between pthread mutex and futex on monitor in android 11. It seems it is impossible now.",
      "parentUuid": "a6601af4_c5ef5eb0",
      "range": {
        "startLine": 240,
        "startChar": 34,
        "endLine": 240,
        "endChar": 43
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9f171379_ce58f063",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 240,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-09T01:43:26Z",
      "side": 1,
      "message": "Yes, it looks like that hasn\u0027t really been possible for a long time. The pthread version of Mutex should still be usable, but Java execution isn\u0027t supported at all. So long as I\u0027ve been here, it was never meant to perform competitively.",
      "parentUuid": "22f1022c_b54d4707",
      "range": {
        "startLine": 240,
        "startChar": 34,
        "endLine": 240,
        "endChar": 43
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef2e3eaa_53538fd8",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 444,
      "author": {
        "id": 1452753
      },
      "writtenOn": "2021-03-10T10:59:12Z",
      "side": 1,
      "message": "As called_monitors_callback is set false initially, those codes are never been ran. Sould they be removed?",
      "range": {
        "startLine": 440,
        "startChar": 4,
        "endLine": 444,
        "endChar": 5
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5a32c6e7_2d01a072",
        "filename": "runtime/monitor.cc",
        "patchSetId": 3
      },
      "lineNbr": 444,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2021-03-11T02:37:37Z",
      "side": 1,
      "message": "Indeed, this does not make sense. I filed a bug to look more carefully. Probably the code should just be deleted.",
      "parentUuid": "ef2e3eaa_53538fd8",
      "range": {
        "startLine": 440,
        "startChar": 4,
        "endLine": 444,
        "endChar": 5
      },
      "revId": "65c18a21e7cb0d48327788df498f15ae195e9e3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}