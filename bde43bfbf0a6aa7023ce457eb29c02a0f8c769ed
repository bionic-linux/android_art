{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "322473b0_32edb287",
        "filename": "libartbase/base/common_art_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 262,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-05-14T21:28:48Z",
      "side": 1,
      "message": "This is quite ugly, but it gets the job done. The real problem is the inconsistency with how the zip file gets created and/or extracted, but I\u0027m not trying to fix that since it probably has repercussions in many other places (there\u0027s e.g. [this comment](https://cs.android.com/android/platform/superproject/main/+/main:art/build/Android.gtest.mk;l\u003d52-53;drc\u003d69dc24557f951ce2513d0ea77f35a499fa58467b)).",
      "range": {
        "startLine": 250,
        "startChar": 0,
        "endLine": 262,
        "endChar": 3
      },
      "revId": "bde43bfbf0a6aa7023ce457eb29c02a0f8c769ed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dfc023c1_d9f530d2",
        "filename": "libartbase/base/common_art_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 262,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2024-05-15T16:31:37Z",
      "side": 1,
      "message": "Agreed â€“ This looks like a reasonable workaround. Thanks for fixing this!",
      "parentUuid": "322473b0_32edb287",
      "range": {
        "startLine": 250,
        "startChar": 0,
        "endLine": 262,
        "endChar": 3
      },
      "revId": "bde43bfbf0a6aa7023ce457eb29c02a0f8c769ed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3eeca83f_8f461918",
        "filename": "libartbase/base/common_art_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 263,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2024-05-15T16:31:37Z",
      "side": 1,
      "message": "Should this be `LOG(FATAL)`? Otherwise nothing prevents this function from returning the erroneous `\"\u003cno boot classpath found\u003e\"` line 265. Or maybe use using `android::base::Result` (or `std::optional\u003cstd::string\u003e`) as this function\u0027s return type?",
      "range": {
        "startLine": 263,
        "startChar": 2,
        "endLine": 263,
        "endChar": 12
      },
      "revId": "bde43bfbf0a6aa7023ce457eb29c02a0f8c769ed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a87b4a72_661729d6",
        "filename": "libartbase/base/common_art_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 263,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-05-15T17:07:50Z",
      "side": 1,
      "message": "Returning a `Result` or `std::optional` means handling a new error in the callers, which then propagates upwards. I suspect that\u0027ll result in a bit of refactoring that I don\u0027t want to take on here.\n\nThis way a typical error comes out like this:\n\n```\n05-15 18:04:26.438 2562998 2562998 E art_compiler_tests: image_space.cc:2115 Error reading named image component header for \u003cno boot classpath found\u003e/apex/art_boot_images/javalib/boot.art, error: Unable to open file \"\u003cno boot classpath found\u003e/apex/art_boot_images/javalib/x86_64/boot.art\" for reading image header\n05-15 18:04:26.438 2562998 2562998 E art_compiler_tests: image_space.cc:3359 Could not create image space with image file \u0027\u003cno boot classpath found\u003e/apex/art_boot_images/javalib/boot.art\u0027. Attempting to fall back to imageless running. Error was: Unable to open file \"\u003cno boot classpath found\u003e/apex/art_boot_images/javalib/x86_64/boot.art\" for reading image header\n05-15 18:04:26.442 2562998 2562998 W art_compiler_tests: runtime.cc:1392 Failed to open .dex from file \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/core-oj.jar\u0027 / fd -1: Unable to open \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/core-oj.jar\u0027 : No such file or directory\n05-15 18:04:26.442 2562998 2562998 W art_compiler_tests: runtime.cc:1392 Failed to open .dex from file \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/core-libart.jar\u0027 / fd -1: Unable to open \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/core-libart.jar\u0027 : No such file or directory\n05-15 18:04:26.442 2562998 2562998 W art_compiler_tests: runtime.cc:1392 Failed to open .dex from file \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/okhttp.jar\u0027 / fd -1: Unable to open \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/okhttp.jar\u0027 : No such file or directory\n05-15 18:04:26.442 2562998 2562998 W art_compiler_tests: runtime.cc:1392 Failed to open .dex from file \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/bouncycastle.jar\u0027 / fd -1: Unable to open \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/bouncycastle.jar\u0027 : No such file or directory\n05-15 18:04:26.442 2562998 2562998 W art_compiler_tests: runtime.cc:1392 Failed to open .dex from file \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/apache-xml.jar\u0027 / fd -1: Unable to open \u0027\u003cno boot classpath found\u003e/apex/com.android.art/javalib/apache-xml.jar\u0027 : No such file or directory\n05-15 18:04:26.442 2562998 2562998 W art_compiler_tests: runtime.cc:1392 Failed to open .dex from file \u0027\u003cno boot classpath found\u003e/apex/com.android.i18n/javalib/core-icu4j.jar\u0027 / fd -1: Unable to open \u0027\u003cno boot classpath found\u003e/apex/com.android.i18n/javalib/core-icu4j.jar\u0027 : No such file or directory\n05-15 18:04:26.442 2562998 2562998 W art_compiler_tests: runtime.cc:1392 Failed to open .dex from file \u0027\u003cno boot classpath found\u003e/apex/com.android.conscrypt/javalib/conscrypt.jar\u0027 / fd -1: Unable to open \u0027\u003cno boot classpath found\u003e/apex/com.android.conscrypt/javalib/conscrypt.jar\u0027 : No such file or directory\n05-15 18:04:26.442 2562998 2562998 E art_compiler_tests: runtime.cc:2011 Could not initialize without image: Boot classpath is empty.\n05-15 18:04:26.442 2562998 2562998 F art_compiler_tests: common_runtime_test.cc:127 Failed to create runtime\n```\n\nNote that it\u0027s only a warning at runtime.cc:1392, so a fatal here may be too aggressive.\n\nWith the return value below the errors or warnings will fairly clearly show what the problem is, assuming they\u0027ll print out the path. Then it\u0027s simple to code search for the string to find this place (if the error message logged here isn\u0027t visible enough already).",
      "parentUuid": "3eeca83f_8f461918",
      "range": {
        "startLine": 263,
        "startChar": 2,
        "endLine": 263,
        "endChar": 12
      },
      "revId": "bde43bfbf0a6aa7023ce457eb29c02a0f8c769ed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "11bdf99b_1d27433b",
        "filename": "libartbase/base/common_art_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 263,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-05-15T17:12:12Z",
      "side": 1,
      "message": "Sorry, I snipped away a bit too much - just before the log above there\u0027s this message:\n\n```\n05-15 18:05:02.677 2567954 2567954 E art_runtime_tests: common_art_test.cc:263 Neither location has a boot classpath (forgot \"m art-host-tests\"?): /usr/local/google/home/mast/android/aosp/out/host/linux-x86/testcases/art_common/out/host/linux-x86 or /usr/local/google/home/mast/android/aosp/out/host/linux-x86\n```",
      "parentUuid": "a87b4a72_661729d6",
      "range": {
        "startLine": 263,
        "startChar": 2,
        "endLine": 263,
        "endChar": 12
      },
      "revId": "bde43bfbf0a6aa7023ce457eb29c02a0f8c769ed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ab1df1ae_f1fbca1a",
        "filename": "libartbase/base/common_art_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 263,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-05-17T16:13:37Z",
      "side": 1,
      "message": "Roland, does this sound ok to you?",
      "parentUuid": "11bdf99b_1d27433b",
      "range": {
        "startLine": 263,
        "startChar": 2,
        "endLine": 263,
        "endChar": 12
      },
      "revId": "bde43bfbf0a6aa7023ce457eb29c02a0f8c769ed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}