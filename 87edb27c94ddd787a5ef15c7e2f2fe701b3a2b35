{
  "comments": [
    {
      "key": {
        "uuid": "a1f643a8_22243ace",
        "filename": "runtime/entrypoints/quick/quick_trampoline_entrypoints.cc",
        "patchSetId": 2
      },
      "lineNbr": 865,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-12T08:47:06Z",
      "side": 1,
      "message": "Add a comment.",
      "range": {
        "startLine": 863,
        "startChar": 0,
        "endLine": 865,
        "endChar": 3
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f9f3d696_d662f784",
        "filename": "runtime/entrypoints/quick/quick_trampoline_entrypoints.cc",
        "patchSetId": 2
      },
      "lineNbr": 865,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-06-14T16:04:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a1f643a8_22243ace",
      "range": {
        "startLine": 863,
        "startChar": 0,
        "endLine": 865,
        "endChar": 3
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "60abe3f9_55c43810",
        "filename": "runtime/entrypoints/quick/quick_trampoline_entrypoints.cc",
        "patchSetId": 2
      },
      "lineNbr": 1159,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-12T08:47:06Z",
      "side": 1,
      "message": "its",
      "range": {
        "startLine": 1159,
        "startChar": 63,
        "endLine": 1159,
        "endChar": 67
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2fd4f1eb_8802935b",
        "filename": "runtime/entrypoints/quick/quick_trampoline_entrypoints.cc",
        "patchSetId": 2
      },
      "lineNbr": 1167,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-12T08:47:06Z",
      "side": 1,
      "message": "? Can you use another word?",
      "range": {
        "startLine": 1167,
        "startChar": 61,
        "endLine": 1167,
        "endChar": 70
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fcc02d92_70e6605e",
        "filename": "runtime/entrypoints/quick/quick_trampoline_entrypoints.cc",
        "patchSetId": 2
      },
      "lineNbr": 1167,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-06-14T16:04:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2fd4f1eb_8802935b",
      "range": {
        "startLine": 1167,
        "startChar": 61,
        "endLine": 1167,
        "endChar": 70
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2b71d940_caea62c2",
        "filename": "runtime/instrumentation.cc",
        "patchSetId": 2
      },
      "lineNbr": 1243,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-12T08:47:06Z",
      "side": 1,
      "message": "walker",
      "range": {
        "startLine": 1243,
        "startChar": 15,
        "endLine": 1243,
        "endChar": 22
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "34385297_8aa63dd1",
        "filename": "runtime/instrumentation.cc",
        "patchSetId": 2
      },
      "lineNbr": 1243,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-06-14T16:04:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2b71d940_caea62c2",
      "range": {
        "startLine": 1243,
        "startChar": 15,
        "endLine": 1243,
        "endChar": 22
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da4efb2e_df205b7b",
        "filename": "runtime/interpreter/interpreter.cc",
        "patchSetId": 2
      },
      "lineNbr": 249,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-12T08:47:06Z",
      "side": 1,
      "message": "Not a big fan of having to send this to the main path of the interpreter. The fact there could be someone that already did the instrumentation work sounds more like unfortunate design. Could we avoid it?",
      "range": {
        "startLine": 249,
        "startChar": 4,
        "endLine": 249,
        "endChar": 43
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "787d552a_5a019613",
        "filename": "runtime/interpreter/interpreter.cc",
        "patchSetId": 2
      },
      "lineNbr": 249,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-06-14T16:04:32Z",
      "side": 1,
      "message": "Not easily. The problem is that we don\u0027t have any good way to detect duplicate calls and filter them out there. We previously just used whether or not we were jumping to the interpreter to decide if we should send the events in instrumentation method entry but that means we can suspend which could allow the jit-gc to get rid of the code we want to run.\n\nPassing down this information was the least-bad solution I could come up with and the only one that both worked and didn\u0027t require either permanently turning off jit-gc or caused deadlocks.",
      "parentUuid": "da4efb2e_df205b7b",
      "range": {
        "startLine": 249,
        "startChar": 4,
        "endLine": 249,
        "endChar": 43
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9724a4e4_533968e9",
        "filename": "runtime/interpreter/interpreter.cc",
        "patchSetId": 2
      },
      "lineNbr": 249,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-15T13:25:58Z",
      "side": 1,
      "message": "Why would it be a problem for the JIT GC to occur? These are very rare events, and yeah it\u0027d be great to keep the JITted code around while in the trampoline, it\u0027s not the end of the world if we remove it. Kind of like bad timing, just like when the JIT GC removes code just before we enter the method.",
      "parentUuid": "787d552a_5a019613",
      "range": {
        "startLine": 249,
        "startChar": 4,
        "endLine": 249,
        "endChar": 43
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a46518f_3a193b23",
        "filename": "runtime/interpreter/interpreter.cc",
        "patchSetId": 2
      },
      "lineNbr": 249,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-06-15T16:30:48Z",
      "side": 1,
      "message": "it wouldn\u0027t but it\u0027s hard to figure out a good way to keep that data around. I had a prototype where instead of doing this we would stick the held jit-entrypoint in a list that the jit-gc will keep live. I wasn\u0027t able to get it to work consistently because it kept running into problems with the synchronization we do for the jit-gc (sync via condition variables is always complicated) and deadlocking. I ended up giving up on that and just doing this which was much simpler to verify is correct. You cannot have deadlocks if you never lock anything.",
      "parentUuid": "9724a4e4_533968e9",
      "range": {
        "startLine": 249,
        "startChar": 4,
        "endLine": 249,
        "endChar": 43
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cebedbd0_abbc63e7",
        "filename": "runtime/interpreter/interpreter.cc",
        "patchSetId": 2
      },
      "lineNbr": 249,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-15T16:34:53Z",
      "side": 1,
      "message": "Yeah, you don\u0027t want to keep that data around. So looks to me you can remove the need of passing that flag with JIT GC issues discarded?",
      "parentUuid": "1a46518f_3a193b23",
      "range": {
        "startLine": 249,
        "startChar": 4,
        "endLine": 249,
        "endChar": 43
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f3f0086a_cfc6adea",
        "filename": "runtime/interpreter/interpreter.cc",
        "patchSetId": 2
      },
      "lineNbr": 249,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2018-06-15T16:44:17Z",
      "side": 1,
      "message": "If we turned off jit-gc we could avoid needing to do any of this.\n\nAgain we would need to disable it permanently on the first tracing use to be correct and giving any app a way to force jit code not to be recovered seems unwise.",
      "parentUuid": "cebedbd0_abbc63e7",
      "range": {
        "startLine": 249,
        "startChar": 4,
        "endLine": 249,
        "endChar": 43
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "65abe066_547f599c",
        "filename": "runtime/interpreter/interpreter.cc",
        "patchSetId": 2
      },
      "lineNbr": 249,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-06-15T16:47:33Z",
      "side": 1,
      "message": "Confused here. You say the problem is that we don\u0027t want to lose the JIT code at the time you\u0027re in the hooks, that you end up in this situation of having notified already. But I\u0027m telling you it\u0027s not a big deal. So if it\u0027s not a big deal to lose the JIT code, then we don\u0027t need that extra flag of whether you\u0027ve been notified.",
      "parentUuid": "f3f0086a_cfc6adea",
      "range": {
        "startLine": 249,
        "startChar": 4,
        "endLine": 249,
        "endChar": 43
      },
      "revId": "87edb27c94ddd787a5ef15c7e2f2fe701b3a2b35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}