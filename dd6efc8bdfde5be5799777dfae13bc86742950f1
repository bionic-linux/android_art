{
  "comments": [
    {
      "key": {
        "uuid": "6d35d7ec_c857aef7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1098853
      },
      "writtenOn": "2020-09-10T15:54:12Z",
      "side": 1,
      "message": "oh actually, is it true that on real devices madvise ignores it and doesn\u0027t fail? I haven\u0027t checked myself",
      "range": {
        "startLine": 10,
        "startChar": 19,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "edcc51dc_4483ad03",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-09-10T16:06:29Z",
      "side": 1,
      "message": "Note that we ignore the return value. The question is how does the kernel interpret the call.\n\n\"man madvise\" lists the following error:\n\n  EINVAL [...] or length is negative.\n\nThat makes no sense for `size_t length`. Given how ill-defined this seems to be I would not be surprised if the behavior varied for different architectures.",
      "parentUuid": "6d35d7ec_c857aef7",
      "range": {
        "startLine": 10,
        "startChar": 19,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c90b02f_ea0d3906",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2020-09-10T17:19:55Z",
      "side": 1,
      "message": "time to go diving into the kernel I guess.",
      "parentUuid": "edcc51dc_4483ad03",
      "range": {
        "startLine": 10,
        "startChar": 19,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86667804_db2a02f3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2020-09-10T18:06:27Z",
      "side": 1,
      "message": "ndesaulniers seems to think this is unlikely to be the issue. I\u0027ll test it out on an emulator.",
      "parentUuid": "1c90b02f_ea0d3906",
      "range": {
        "startLine": 10,
        "startChar": 19,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a7bb2a9a_4ec559f5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-09-11T08:11:39Z",
      "side": 1,
      "message": "If you\u0027re running a 32-bit emulator on a 64-bit host and passing madvise() calls to the host kernel, translating the 32-bit size_t to a 64-bit size_t changes the \"negative\" value (if interpreted as ssize_t) to a positive one.",
      "parentUuid": "86667804_db2a02f3",
      "range": {
        "startLine": 10,
        "startChar": 19,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2143530d_74c69e57",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2020-09-11T16:28:32Z",
      "side": 1,
      "message": "that was my guess too from looking at do_madvise (https://github.com/torvalds/linux/blob/dd9fb9bb3340c791a2be106fdc895db75f177343/mm/madvise.c#L1078). ndesaulniers didn\u0027t think it was likely and said he thought there was a shim to prevent that though.\n\nAlso I thought that the emulator was a VM not paravirtualization (unless you think the bug resides in qemu/kvm).\n\nIn any event Sergey tried this and it seems to work so I guess that must be it.\n\nIt is strange we didn\u0027t hear about this on real devices if this is the real cause. Maybe we just got lucky with the sizes.",
      "parentUuid": "a7bb2a9a_4ec559f5",
      "range": {
        "startLine": 10,
        "startChar": 19,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ded0ebb_a1d6560d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2020-09-10T01:20:41Z",
      "side": 1,
      "message": "Feasible to add a regression test?",
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3cbc01f6_10cf5afa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2020-09-11T16:28:32Z",
      "side": 1,
      "message": "not easily TBH.\n\nmadvise is supposed to just ignores the negative length and usually seems to. I\u0027m still not sure how exactly this failure works. Nick (kernel person) I talked to seemed to think this was unlikely to be the cause.",
      "parentUuid": "9ded0ebb_a1d6560d",
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30b30fd4_5f78d8ed",
        "filename": "runtime/indirect_reference_table.cc",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-09-10T08:23:50Z",
      "side": 1,
      "message": "Update `max_entries_` to reflect this rounding.",
      "range": {
        "startLine": 83,
        "startChar": 29,
        "endLine": 83,
        "endChar": 36
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12260d50_e263daae",
        "filename": "runtime/indirect_reference_table.cc",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2020-09-11T16:28:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "30b30fd4_5f78d8ed",
      "range": {
        "startLine": 83,
        "startChar": 29,
        "endLine": 83,
        "endChar": 36
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b685a1c5_8bfac240",
        "filename": "runtime/indirect_reference_table.cc",
        "patchSetId": 1
      },
      "lineNbr": 457,
      "author": {
        "id": 1015378
      },
      "writtenOn": "2020-09-09T21:53:52Z",
      "side": 1,
      "message": "There is ZeroAndReleasePages that has handling for negative sizes, could also use that.",
      "range": {
        "startLine": 457,
        "startChar": 2,
        "endLine": 457,
        "endChar": 9
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9572796_448ed511",
        "filename": "runtime/indirect_reference_table.cc",
        "patchSetId": 1
      },
      "lineNbr": 457,
      "author": {
        "id": 1047769
      },
      "writtenOn": "2020-09-09T21:58:09Z",
      "side": 1,
      "message": "I mean the negative size was a bug anyway. Really what was meant was DONT_NEED everything after the last entry, if it was on the last page and the End wasn\u0027t page aligned then release_start would be after release_end so negative length.",
      "parentUuid": "b685a1c5_8bfac240",
      "range": {
        "startLine": 457,
        "startChar": 2,
        "endLine": 457,
        "endChar": 9
      },
      "revId": "dd6efc8bdfde5be5799777dfae13bc86742950f1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}