{
  "comments": [
    {
      "key": {
        "uuid": "8afd1475_66517695",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1016,
      "author": {
        "id": 1042649
      },
      "writtenOn": "2014-05-08T11:15:04Z",
      "side": 1,
      "message": "I don\u0027t think it will be changed.",
      "range": {
        "startLine": 1016,
        "startChar": 4,
        "endLine": 1016,
        "endChar": 7
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8afd1475_e60726a3",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1017,
      "author": {
        "id": 1042649
      },
      "writtenOn": "2014-05-08T11:15:04Z",
      "side": 1,
      "message": "ldaxr  w1, [x4]    // load lock_word, acquire lock",
      "range": {
        "startLine": 1017,
        "startChar": 4,
        "endLine": 1017,
        "endChar": 8
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8afd1475_26476edc",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1019,
      "author": {
        "id": 1042649
      },
      "writtenOn": "2014-05-08T11:15:04Z",
      "side": 1,
      "message": "stlxr  w3, w2, [x4]    // store lock_word, release lock",
      "range": {
        "startLine": 1019,
        "startChar": 4,
        "endLine": 1019,
        "endChar": 8
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ca138c9f_d3829eeb",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1019,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2014-05-08T22:19:18Z",
      "side": 1,
      "message": "This doesn\u0027t need to be a release store.  See F.3.1 in the ARMv8 manual.\n\nSo long as the ldx uses acquire, the barrier can be dropped and nothing else is needed.  I\u0027d vote for moving everything from dmb to acquire/release in one fell swoop, since the documentation seems less than crystal clear on acquire/release/dmb interaction.",
      "parentUuid": "8afd1475_26476edc",
      "range": {
        "startLine": 1019,
        "startChar": 4,
        "endLine": 1019,
        "endChar": 8
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eac4d062_ef38bd5b",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1019,
      "author": {
        "id": 1037216
      },
      "writtenOn": "2014-05-09T18:16:20Z",
      "side": 1,
      "message": "Agreed. The acquire ensures the following instructions happen after the load, and the stxr catches stores on other PEs.",
      "parentUuid": "ca138c9f_d3829eeb",
      "range": {
        "startLine": 1019,
        "startChar": 4,
        "endLine": 1019,
        "endChar": 8
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aa49f8a5_c49cb48e",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1021,
      "author": {
        "id": 1010118
      },
      "writtenOn": "2014-05-07T00:06:04Z",
      "side": 1,
      "message": "dmb ishld ? (new in v8)",
      "range": {
        "startLine": 1021,
        "startChar": 0,
        "endLine": 1021,
        "endChar": 94
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2aa8a88f_2442e8cb",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1048,
      "author": {
        "id": 1037216
      },
      "writtenOn": "2014-05-09T18:16:20Z",
      "side": 1,
      "message": "\"lock\" should be \"unlock\".",
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a58b470_40ffe2d0",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1066,
      "author": {
        "id": 1010118
      },
      "writtenOn": "2014-05-07T00:06:04Z",
      "side": 1,
      "message": "ishst?",
      "range": {
        "startLine": 1066,
        "startChar": 11,
        "endLine": 1066,
        "endChar": 14
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a58b470_00a84afe",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1066,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2014-05-07T01:03:07Z",
      "side": 1,
      "message": "This needs to be a LoadStore and StoreStore barrier.  Andreas and I concluded form the table in the documentation that ish is probably the best we can do here.\n\nMuch more importantly, the barrier needs to go BEFORE the stores that effects the release of the lock.  Otherwise memory operations inside the critical sections can become visible after the lock release becomes effective, allowing other threads to acquire the lock before they see changes performed by this critical section.\n\nIf the same code is used for ARM32, it should be fixed there, too.\n\nI conjecture that just replacing the str with an strl, removing the dmb, will work as well and run faster.  The documentation is not as clear as I would personally like about the interaction of acquire/release operations and dmb.",
      "parentUuid": "8a58b470_40ffe2d0",
      "range": {
        "startLine": 1066,
        "startChar": 11,
        "endLine": 1066,
        "endChar": 14
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2aa8a88f_241748af",
        "filename": "runtime/arch/arm64/quick_entrypoints_arm64.S",
        "patchSetId": 1
      },
      "lineNbr": 1066,
      "author": {
        "id": 1037216
      },
      "writtenOn": "2014-05-09T18:16:20Z",
      "side": 1,
      "message": "From my reading, a \"strl\" would be sufficient.\nload/stores before strl will be visible before the strl itself is.\nI would leave this as it is, with the dmb moved before the str - I\u0027ll try and get a definitive answer.",
      "parentUuid": "8a58b470_00a84afe",
      "range": {
        "startLine": 1066,
        "startChar": 11,
        "endLine": 1066,
        "endChar": 14
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6a346007_e9b0971d",
        "filename": "runtime/arch/x86_64/quick_entrypoints_x86_64.S",
        "patchSetId": 1
      },
      "lineNbr": 700,
      "author": {
        "id": 1010118
      },
      "writtenOn": "2014-05-07T00:06:04Z",
      "side": 1,
      "message": "was this a copy of old code brought over from x86? I remember there was a similar issue there.",
      "range": {
        "startLine": 700,
        "startChar": 0,
        "endLine": 700,
        "endChar": 34
      },
      "revId": "f57fb73c332eddd2a5717785894c304ffaa41a1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}