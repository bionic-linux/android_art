{
  "comments": [
    {
      "key": {
        "uuid": "9103969d_e476714e",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 57,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-04-15T21:23:56Z",
      "side": 1,
      "message": "Can this happen? If you add the corresponding dependency on libdexfile_external from libart I was hoping we can count on either one always being present when we get here, and so we can fail hard instead of opportunistically loading one and hope for the best.",
      "range": {
        "startLine": 57,
        "startChar": 73,
        "endLine": 57,
        "endChar": 90
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a861d0b2_d0b1c207",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 57,
      "author": {
        "id": 1065473
      },
      "writtenOn": "2019-04-16T09:32:34Z",
      "side": 1,
      "message": "I believe debuggerd does not load ART runtime at all.  But it does need to backtrace through dex.",
      "parentUuid": "9103969d_e476714e",
      "range": {
        "startLine": 57,
        "startChar": 73,
        "endLine": 57,
        "endChar": 90
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5c88f18d_c8a8c2de",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 57,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-04-16T13:54:13Z",
      "side": 1,
      "message": "Ok. If the runtime is loaded later then the check in globals.cc will cause a fatal instead. Maybe worth mentioning there that this could be the reason.",
      "parentUuid": "a861d0b2_d0b1c207",
      "range": {
        "startLine": 57,
        "startChar": 73,
        "endLine": 57,
        "endChar": 90
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3234cf9_585453a9",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 57,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-04-18T13:09:47Z",
      "side": 1,
      "message": "Haven\u0027t seen any follow-up on this.",
      "parentUuid": "5c88f18d_c8a8c2de",
      "range": {
        "startLine": 57,
        "startChar": 73,
        "endLine": 57,
        "endChar": 90
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89454822_9df366d9",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 57,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-10-23T12:58:25Z",
      "side": 1,
      "message": "I added the comment in https://r.android.com/953538",
      "parentUuid": "d3234cf9_585453a9",
      "range": {
        "startLine": 57,
        "startChar": 73,
        "endLine": 57,
        "endChar": 90
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e7d8eddb_ca460f38",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 60,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-04-16T13:54:13Z",
      "side": 1,
      "message": "The repeated dlopen\u0027s here makes the logic a bit cumbersome. Consider loading the debug variant with RTLD_NOLOAD and keep the handle, only falling back to the non-debug one if that fails.",
      "range": {
        "startLine": 58,
        "startChar": 4,
        "endLine": 60,
        "endChar": 75
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "18627312_cf878e72",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 60,
      "author": {
        "id": 1065473
      },
      "writtenOn": "2019-04-16T15:52:21Z",
      "side": 1,
      "message": "That is what I started with.  But if you want to keep the so_name for log messages, it gets messy.  And at least two dlopens are needed anyway.",
      "parentUuid": "e7d8eddb_ca460f38",
      "range": {
        "startLine": 58,
        "startChar": 4,
        "endLine": 60,
        "endChar": 75
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8da13eae_5ee8f0ed",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 60,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-04-16T17:49:02Z",
      "side": 1,
      "message": "Isn\u0027t something like this straightforward enough?\n\n  // First check if the debug library is already loaded because [...]\n  const char* so_name \u003d \"libdexfiled_external.so\";\n  void* handle \u003d dlopen(so_name, RTLD_NOLOAD | RTLD_NOW | RTLD_NODELETE);\n  if (handle \u003d\u003d nullptr) {\n    // We\u0027re either running in non-debug mode, or the runtime hasn\u0027t\n    // been loaded at all. Load the non-debug library in either case.\n    so_name \u003d \"libdexfile_external.so\";\n    handle \u003d dlopen(so_name, RTLD_NOW | RTLD_GLOBAL | RTLD_NODELETE);\n  }\n\n(Saves one dlopen call in the debug case, although I can\u0027t say I care about that very much.)",
      "parentUuid": "18627312_cf878e72",
      "range": {
        "startLine": 58,
        "startChar": 4,
        "endLine": 60,
        "endChar": 75
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "763d5087_75b5320f",
        "filename": "libdexfile/external/dex_file_supp.cc",
        "patchSetId": 8
      },
      "lineNbr": 60,
      "author": {
        "id": 1065473
      },
      "writtenOn": "2019-04-17T11:49:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8da13eae_5ee8f0ed",
      "range": {
        "startLine": 58,
        "startChar": 4,
        "endLine": 60,
        "endChar": 75
      },
      "revId": "cf9c37663047bca41ed2db790c99dcaec0fd1b17",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}