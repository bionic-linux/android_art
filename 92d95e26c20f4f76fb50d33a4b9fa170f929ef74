{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "aeaf884e_a148da2d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-05-12T10:46:37Z",
      "side": 1,
      "message": "Vladimir, friendly ping.",
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "39df11be_6466fbfa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-05-13T08:48:16Z",
      "side": 1,
      "message": "Friendly TH-reminder ðŸ˜Š",
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "27cd7428_9342cec9",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 2522,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2021-05-13T09:13:33Z",
      "side": 1,
      "message": "This is incompatible with my suggestion below to move the aligning to `FinishVdexFile()`.",
      "range": {
        "startLine": 2522,
        "startChar": 2,
        "endLine": 2522,
        "endChar": 49
      },
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3ff74174_52053e99",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 2522,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2021-05-13T16:20:07Z",
      "side": 1,
      "message": "This is moot.",
      "parentUuid": "27cd7428_9342cec9",
      "range": {
        "startLine": 2522,
        "startChar": 2,
        "endLine": 2522,
        "endChar": 49
      },
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9123db6_1e57efcf",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 2531,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2021-05-13T16:20:07Z",
      "side": 1,
      "message": "Actually, the original bug is here and we should fix it here.\n\nThe `WriteVerifierDeps()` was adding padding to make the VerifierDeps aligned based on `vdex_size_` but the `VerifierDeps::Encode()` was then adding its own padding based on the `buffer-\u003esize()`. So I think we should just fix the `VerifierDeps::Encode()` to assume that the original `buffer-\u003esize()` may contain padding for alignment. Given that the offsets are written that way, the alignment of individual dex file\u0027s data there looks really odd.\n\nPlease revert all changes in OatWriter and fix `VerifierDeps::Encode()`.",
      "range": {
        "startLine": 2531,
        "startChar": 17,
        "endLine": 2531,
        "endChar": 23
      },
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "34b833ac_7c6e8421",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 2531,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-05-14T08:23:15Z",
      "side": 1,
      "message": "The issue is VerifierDeps::Encode (and all its callers) uses buffer-\u003esize() as offset, but that breaks as we\u0027ll want to have the verifier_deps start at an aligned offset and not point to where we do the padding.",
      "parentUuid": "a9123db6_1e57efcf",
      "range": {
        "startLine": 2531,
        "startChar": 17,
        "endLine": 2531,
        "endChar": 23
      },
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2329e8a2_b9855270",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 2531,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-05-14T08:39:39Z",
      "side": 1,
      "message": "(and all its callers) -\u003e (and all the functions it calls)",
      "parentUuid": "34b833ac_7c6e8421",
      "range": {
        "startLine": 2531,
        "startChar": 17,
        "endLine": 2531,
        "endChar": 23
      },
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "56488f81_712682cc",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 2531,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-05-14T13:04:05Z",
      "side": 1,
      "message": "As discussed, keeping the alignment logic in WriteVerifierDeps.",
      "parentUuid": "2329e8a2_b9855270",
      "range": {
        "startLine": 2531,
        "startChar": 17,
        "endLine": 2531,
        "endChar": 23
      },
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "566c3fcb_03bf5c1d",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 3232,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2021-05-13T09:13:33Z",
      "side": 1,
      "message": "This does not look like a good place for the alignment. You should add the alignment in `FinishVdexFile()` if the `buffer` has any data and attribute it to `size_verifier_deps_alignment_` or `size_vdex_lookup_table_alignment_` depending on whether the verifier deps are null.",
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f243de4_dd9c7141",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 3232,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-05-13T12:24:53Z",
      "side": 1,
      "message": "I\u0027m doing this here as that\u0027s when the mmaps are being created. FinishVdexFile adjusts the mmap based on the buffer containing verifierdeps and typelookuptable data, and it\u0027s much simpler if that buffer doesn\u0027t start with padding.\n\nI could push_front the padding after populating the buffer, but that seems unoptimal.",
      "parentUuid": "566c3fcb_03bf5c1d",
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e874723f_98d07eb2",
        "filename": "dex2oat/linker/oat_writer.cc",
        "patchSetId": 2
      },
      "lineNbr": 3232,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2021-05-13T16:20:07Z",
      "side": 1,
      "message": "This is moot.",
      "parentUuid": "1f243de4_dd9c7141",
      "revId": "92d95e26c20f4f76fb50d33a4b9fa170f929ef74",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}