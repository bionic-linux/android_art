{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "183d5e08_158237b5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2021-10-13T14:41:02Z",
      "side": 1,
      "message": "This is my third attempt at figuring out how to implement this, and perhaps surprisingly it\u0027s the least ugly so far.\n",
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4f954b4e_ed80921b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2021-10-14T09:13:38Z",
      "side": 1,
      "message": "I am so stupid; most of this is unnecessary.",
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8ba505cd_ea3e9d67",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2021-10-14T16:12:07Z",
      "side": 1,
      "message": "OK, I changed my mind, and this is I think reasonable.\n\nOnly the final copy from staging to \u003csomewhere\u003e matters, but where the \u003csomewhere\u003e comes from now depends on e.g. GetBootImageExtensionImagePath, with various consistency checks.\nI\u0027m happier making them all return consistent values (which this change does) rather than just hacking it in the final stage in e.g. CompileBootExtensionArtifacts.\n\nJiakai - WDYT?",
      "parentUuid": "4f954b4e_ed80921b",
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7b351cab_2293e05d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-10-15T07:10:04Z",
      "side": 1,
      "message": "Yes, that\u0027s exactly what I would do. In odrefresh, we run dex2oat multiple times, and an output of a previous run can be an input of the current run. For example, when we compile a system server jar, we use the boot image generated in a previous run (https://cs.android.com/android/platform/superproject/+/master:art/odrefresh/odrefresh.cc;l\u003d1477;drc\u003d8d12ed67ba98bd0dce58bcebddf89cdb10fe3106). Therefore, it\u0027s essential that all functions return consistent values for the paths to the artifacts. Your approach looks good to me.",
      "parentUuid": "8ba505cd_ea3e9d67",
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "46d1fd17_c57cf579",
        "filename": "libartbase/base/file_utils.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-10-13T16:08:47Z",
      "side": 1,
      "message": "Slightly off topic question.  Is this the ONLY directory to store the output?  (I hope so)\n\nI\u0027ll be trying to run odrefresh in the VM, and am thinking to pass the output directory as a FD (over authfs), and let odrefresh use openat(2) to create the output file.  If that\u0027s indeed doable, then I might later replace this new flag with its --dalvik-cache-dir-fd or --output-dir-fd.",
      "range": {
        "startLine": 375,
        "startChar": 13,
        "endLine": 375,
        "endChar": 36
      },
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9faee5a5_5d0c3ce6",
        "filename": "libartbase/base/file_utils.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2021-10-13T16:16:47Z",
      "side": 1,
      "message": "\u003e   Is this the ONLY directory to store the output?  (I hope so)\nNo. Actually we write things initially to ../staging, and then move them from staging to dalvik-cache, for greater atomicity (I think). See e.g. http://cs/android/art/odrefresh/odrefresh.cc?l\u003d1384.\n\n\u003e pass the output directory as a FD (over authfs), and let odrefresh use openat(2) to create the output file\nDoes that work with authfs? Cool!\n\n\u003e  I might later replace this new flag with its --dalvik-cache-dir-fd or --output-dir-fd.\nFine by me. I\u0027m about to modify the tests (and composd) to use this flag, but it\u0027s all mutable.",
      "parentUuid": "46d1fd17_c57cf579",
      "range": {
        "startLine": 375,
        "startChar": 13,
        "endLine": 375,
        "endChar": 36
      },
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ac85fb43_7f1c739d",
        "filename": "libartbase/base/file_utils.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2021-10-13T16:22:17Z",
      "side": 1,
      "message": "\u003e Does that work with authfs? Cool!\n\nNot yet, I need to make it cool :)",
      "parentUuid": "9faee5a5_5d0c3ce6",
      "range": {
        "startLine": 375,
        "startChar": 13,
        "endLine": 375,
        "endChar": 36
      },
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "55ae8389_5a3cde81",
        "filename": "libartbase/base/file_utils.cc",
        "patchSetId": 2
      },
      "lineNbr": 375,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-10-15T07:10:04Z",
      "side": 1,
      "message": "\u003e Not yet, I need to make it cool :)\n\nThis sounds cool! Looking forward to it :)\n\nOne thing worth noting is that we may want to move cache-info.xml outside of dalvik-cache so that it can be generated outside the VM for simplicity, as I brought up in b/202845876.",
      "parentUuid": "ac85fb43_7f1c739d",
      "range": {
        "startLine": 375,
        "startChar": 13,
        "endLine": 375,
        "endChar": 36
      },
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "edb574c7_50b4b90c",
        "filename": "libartbase/base/file_utils_test.cc",
        "patchSetId": 2
      },
      "lineNbr": 279,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-10-15T07:10:04Z",
      "side": 1,
      "message": "Please restore the state using an RAII as test cases are not guaranteed to run in a fixed order.",
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc549a4f_715fe7ef",
        "filename": "odrefresh/include/odrefresh/odrefresh.h",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-10-15T07:10:04Z",
      "side": 1,
      "message": "Maybe out of the scope of this CL: I\u0027m wondering why we need this as it\u0027s just a hardcoded version of GetApexDataDalvikCacheDirectory(). Maybe it\u0027s the time to get rid of it?",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 28,
        "endChar": 55
      },
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6dbb0b78_9e2f7894",
        "filename": "odrefresh/odrefresh.cc",
        "patchSetId": 2
      },
      "lineNbr": 707,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-10-15T07:10:04Z",
      "side": 1,
      "message": "Please update this.",
      "range": {
        "startLine": 707,
        "startChar": 25,
        "endLine": 707,
        "endChar": 52
      },
      "revId": "7c7bca176592caa5e0bc8a1521be6a808dfae2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}