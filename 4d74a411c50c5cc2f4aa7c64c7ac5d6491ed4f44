{
  "comments": [
    {
      "key": {
        "uuid": "222e2150_09d687fd",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-01-26T14:40:23Z",
      "side": 1,
      "message": "That would sound like a bug if not. The page should have no longer any reference to it so should be dropped.",
      "range": {
        "startLine": 1061,
        "startChar": 49,
        "endLine": 1062,
        "endChar": 32
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2616338_2ea10dbb",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-27T17:55:37Z",
      "side": 1,
      "message": "I\u0027d rather check this by looking at /proc/self/pagemap -\u003e /proc/kpageflags \u0026 /proc/kpagecount .",
      "parentUuid": "222e2150_09d687fd",
      "range": {
        "startLine": 1061,
        "startChar": 49,
        "endLine": 1062,
        "endChar": 32
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b6a25fca_e7f2672a",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-28T12:01:27Z",
      "side": 1,
      "message": "I checked on host:\n\n  - create memfd, write 16GiB, watch the memory usage go up.\n    - this is not reflected in /proc/\u003cpid\u003e/{stat,statm,status}\n  - mmap(MAP_PRIVATE) the 16GiB, memory usage stays the same.\n  - close the fd, memory usage stays the same.\n  - read the mmapped region, memory usage remains the same.\n    - minflt goes up by ~ 256Ki (one per 16 pages)\n  - overwrite to the mmaped region, memory usage goes up by another 1GiB\n    - minflt goes up by ~ 4Mi (one per page)\n\nSo, the kernel keeps the in-memory file separate from the mmaped memory when we copy-on-write and the contents are retained despite the pages being unreachable (fd is closed).\n\nI\u0027ll implement a force-copy approach so that the in-memory file completely disappears.",
      "parentUuid": "b2616338_2ea10dbb",
      "range": {
        "startLine": 1061,
        "startChar": 49,
        "endLine": 1062,
        "endChar": 32
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "297ff5b3_21a5286f",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-01-28T12:48:10Z",
      "side": 1,
      "message": "(What happens if you force dropping the page cache?)\n\nOn the other hand, why do we want it to disappear? Can it not be used right away by the zygote?",
      "parentUuid": "b6a25fca_e7f2672a",
      "range": {
        "startLine": 1061,
        "startChar": 49,
        "endLine": 1062,
        "endChar": 32
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ef092c2_6dfff4b8",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-28T12:53:27Z",
      "side": 1,
      "message": "(The backing storage is RAM, so dropping the page cache should not have any effect.)\n\nThe file is pure memory overhead. Even if we decided to relocate the contents in place (either in dex2oat or in zygote by using MAP_SHARED and remapping it MAP_PRIVATE after relocation), zygote is going to touch some pages and we do not want to keep the old useless pages around.",
      "parentUuid": "297ff5b3_21a5286f",
      "range": {
        "startLine": 1061,
        "startChar": 49,
        "endLine": 1062,
        "endChar": 32
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f2b1e22d_855d7b5c",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1586,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-01-26T14:40:23Z",
      "side": 1,
      "message": "drop?",
      "range": {
        "startLine": 1586,
        "startChar": 4,
        "endLine": 1586,
        "endChar": 9
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "454249c8_14a099ef",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1586,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-27T16:37:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f2b1e22d_855d7b5c",
      "range": {
        "startLine": 1586,
        "startChar": 4,
        "endLine": 1586,
        "endChar": 9
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "817c6942_d97bb604",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1667,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-01-26T14:40:23Z",
      "side": 1,
      "message": "Can you add a comment what the difference between the two is?",
      "range": {
        "startLine": 1666,
        "startChar": 0,
        "endLine": 1667,
        "endChar": 57
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b5b1d6a8_1034a70a",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1667,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-27T16:37:19Z",
      "side": 1,
      "message": "This is surely not the right place to add documentation. We do have the following in parsed_options.cc :\n\n  UsageMessage(stream, \"  -Xbootclasspath-locations:bootclasspath\\n\"\n                       \"     (override the dex locations of the -Xbootclasspath files)\\n\");",
      "parentUuid": "817c6942_d97bb604",
      "range": {
        "startLine": 1666,
        "startChar": 0,
        "endLine": 1667,
        "endChar": 57
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "25741085_ba7e98f2",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1724,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2020-01-27T18:00:21Z",
      "side": 1,
      "message": "const?",
      "range": {
        "startLine": 1724,
        "startChar": 4,
        "endLine": 1724,
        "endChar": 10
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "83617b06_dec552d0",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1724,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-28T12:01:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "25741085_ba7e98f2",
      "range": {
        "startLine": 1724,
        "startChar": 4,
        "endLine": 1724,
        "endChar": 10
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "54894ec3_6b50fe84",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1796,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2020-01-27T18:00:21Z",
      "side": 1,
      "message": "Why rfind and not find? Can there be multiple bangs in one component?",
      "range": {
        "startLine": 1796,
        "startChar": 45,
        "endLine": 1796,
        "endChar": 50
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb61554d_b4991174",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1796,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2020-01-27T18:00:21Z",
      "side": 1,
      "message": "const?",
      "range": {
        "startLine": 1796,
        "startChar": 4,
        "endLine": 1796,
        "endChar": 10
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e3b3e13e_5d08e950",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1796,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-28T12:01:27Z",
      "side": 1,
      "message": "Done (copy paste error; fixing at line 1724 exposed a missing check)",
      "parentUuid": "54894ec3_6b50fe84",
      "range": {
        "startLine": 1796,
        "startChar": 45,
        "endLine": 1796,
        "endChar": 50
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3cdf5cde_8e24c07c",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 1796,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-28T12:01:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "eb61554d_b4991174",
      "range": {
        "startLine": 1796,
        "startChar": 4,
        "endLine": 1796,
        "endChar": 10
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6db3f26b_fa7503a9",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 2941,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2020-01-26T14:40:23Z",
      "side": 1,
      "message": "given this tis the only difference with the call line 2930, just refactor and add a boolean:\nuse_in_memory_image \u003d vdex_fd-\u003eget() !\u003d -1\n\n?",
      "range": {
        "startLine": 2940,
        "startChar": 0,
        "endLine": 2941,
        "endChar": 51
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8fdb63fd_982f7d8b",
        "filename": "runtime/gc/space/image_space.cc",
        "patchSetId": 1
      },
      "lineNbr": 2941,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-01-27T16:37:19Z",
      "side": 1,
      "message": "This is calling a different overload of OatFile::Open().",
      "parentUuid": "6db3f26b_fa7503a9",
      "range": {
        "startLine": 2940,
        "startChar": 0,
        "endLine": 2941,
        "endChar": 51
      },
      "revId": "4d74a411c50c5cc2f4aa7c64c7ac5d6491ed4f44",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}