{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "fd9eefab_f8423c17",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2024-03-15T18:07:30Z",
      "side": 1,
      "message": "\"to avoid a race with finalizers introduced by the dex file.\"",
      "range": {
        "startLine": 9,
        "startChar": 37,
        "endLine": 10,
        "endChar": 69
      },
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3bed33ea_a4372841",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-03-15T18:34:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fd9eefab_f8423c17",
      "range": {
        "startLine": 9,
        "startChar": 37,
        "endLine": 10,
        "endChar": 69
      },
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "93166dac_b3545405",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2024-03-15T18:07:30Z",
      "side": 1,
      "message": "Looks fine to me, other than the two comments below. I only looked briefly at the finalization/cleaner code.",
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e002af55_d7063c90",
        "filename": "libartservice/service/java/com/android/server/art/ArtdRefCache.java",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-03-15T18:44:57Z",
      "side": 1,
      "message": "Is this used from somewhere outside tests?",
      "range": {
        "startLine": 119,
        "startChar": 16,
        "endLine": 119,
        "endChar": 21
      },
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4458f60b_8b51f9e5",
        "filename": "libartservice/service/java/com/android/server/art/ArtdRefCache.java",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2024-03-15T18:07:30Z",
      "side": 1,
      "message": "Please add the\n\nReference.reachabilityFence(this)\n\nback at the end of this. For dull correctness it should be in a finally clause as before, but it doesn\u0027t really matter.",
      "range": {
        "startLine": 170,
        "startChar": 12,
        "endLine": 170,
        "endChar": 31
      },
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9cdf0ed8_74d36abb",
        "filename": "libartservice/service/java/com/android/server/art/ArtdRefCache.java",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-03-15T18:23:47Z",
      "side": 1,
      "message": "Originally, `Reference.reachabilityFence(this)` was for preventing the `close()` method from being called twice: once by our code and once by the finalizer concurrently. With `Cleaner`, this doesn\u0027t seem to possibility happen because [the doc](https://docs.oracle.com/javase%2F9%2Fdocs%2Fapi%2F%2F/java/lang/ref/Cleaner.Cleanable.html#clean--) says\n\n\u003e The cleanable\u0027s cleaning action is invoked at most once regardless of the number of calls to clean.\n\nTherefore, I don\u0027t think we need `Reference.reachabilityFence(this)` anymore. Am I missing anything?",
      "parentUuid": "4458f60b_8b51f9e5",
      "range": {
        "startLine": 170,
        "startChar": 12,
        "endLine": 170,
        "endChar": 31
      },
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e0b9a1ce_f396c870",
        "filename": "libartservice/service/java/com/android/server/art/ArtdRefCache.java",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2024-03-15T18:34:43Z",
      "side": 1,
      "message": "Oh, wait, I see the race here. We may get a false warning before `mGuard.close()` is executed.\n\nDone.",
      "parentUuid": "9cdf0ed8_74d36abb",
      "range": {
        "startLine": 170,
        "startChar": 12,
        "endLine": 170,
        "endChar": 31
      },
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "142050c6_568c9546",
        "filename": "libartservice/service/java/com/android/server/art/ArtdRefCache.java",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2024-03-15T18:44:57Z",
      "side": 1,
      "message": "Can you please fill me in? The cleaner may only run if this object is phantom reachable. How do we get here then?",
      "parentUuid": "e0b9a1ce_f396c870",
      "range": {
        "startLine": 170,
        "startChar": 12,
        "endLine": 170,
        "endChar": 31
      },
      "revId": "6171c15e64f03b0f7f42905cb4d3fe40dfd59319",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}