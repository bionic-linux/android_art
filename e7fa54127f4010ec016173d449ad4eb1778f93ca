{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5687b694_5502f0f6",
        "filename": "libnativeloader/test/src/android/test/app/ProductAppTest.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-11-23T12:30:57Z",
      "side": 1,
      "message": "I found this out from logs on S, and all the tests below guarded with this fail there. I\u0027m not sure why the namespace becomes shared though - I\u0027d\u0027ve thought that https://r.android.com/924814 would make it non-shared, and it\u0027s certainly old enough to be in S. For reference, here\u0027s the logcat from this app in the penultimate patchset: http://gpaste/6040879874179072\n\n@kiyoungkim@google.com, any thoughts?",
      "range": {
        "startLine": 35,
        "startChar": 7,
        "endLine": 37,
        "endChar": 22
      },
      "revId": "e7fa54127f4010ec016173d449ad4eb1778f93ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e347d25_80c2f3ec",
        "filename": "libnativeloader/test/src/android/test/app/ProductAppTest.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1146974
      },
      "writtenOn": "2023-11-24T04:57:56Z",
      "side": 1,
      "message": "https://r.android.com/1191698 is merged in S. But there must be devices in the presubmit that have not set `ro.product.vndk.version`, although I confirm `aosp_cf_x86_64_phone` in sc-dev has set `ro.product.vndk.version`.\n\nCould you please try using the condition to read `ro.product.vndk.version` for `productAppsAreShared()`? As we removed `ro.product.vndk.version` recently, the function could be:\n```\n    private static boolean productAppsAreShared() {\n        return Build.VERSION.SDK_INT \u003c\u003d Build.VERSION_CODES.UPSIDE_DOWN_CAKE \u0026\u0026\n               SystemProperties.get(\"ro.product.vndk.version\").isEmpty();\n    }\n```",
      "parentUuid": "5687b694_5502f0f6",
      "range": {
        "startLine": 35,
        "startChar": 7,
        "endLine": 37,
        "endChar": 22
      },
      "revId": "e7fa54127f4010ec016173d449ad4eb1778f93ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "62661f2c_153cd642",
        "filename": "libnativeloader/test/src/android/test/app/ProductAppTest.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-11-28T00:58:27Z",
      "side": 1,
      "message": "Ok, I can do that for some presubmit runs, but since we already determined that `ro.product.vndk.version` is set in (at least) the sc-v2-dev cuttlefish images I\u0027m hesitant to check in that condition.\n\nStarted heavy presubmit runs on all the devices we have with S images: http://android-build/abtd/run/L80800030000514708/",
      "parentUuid": "8e347d25_80c2f3ec",
      "range": {
        "startLine": 35,
        "startChar": 7,
        "endLine": 37,
        "endChar": 22
      },
      "revId": "e7fa54127f4010ec016173d449ad4eb1778f93ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7dd432b7_880fd149",
        "filename": "libnativeloader/test/src/android/test/app/ProductAppTest.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1146974
      },
      "writtenOn": "2023-11-28T08:27:09Z",
      "side": 1,
      "message": "Thanks Martin.\n\nChecking `ro.product.vndk.version` works for the `productAppsAreShared()` function. Only sargo of S test targets did not set `ro.product.vndk.version`. So I can see `clns-shared` namespace problem from the test with only the sargo target in b/308228277.\n\nBut still `productAppsAreShared()` is not the only reason. The failure of sunfish in b/308228277 is caused by a different reason. I think S does not have all the patches in b/186055799, especially for aosp/1789089 that causes dlopen failure for product public libs.\n\nI think it is required to use `skipPublicProductLibTests()` for all product related tests instead of using `productAppsAreShared()` because not all test failures in `ProductAppTest` are caused by `productAppsAreShared()`. If it were the case, sunfish must not fail on `ProductAppTest`.",
      "parentUuid": "62661f2c_153cd642",
      "range": {
        "startLine": 35,
        "startChar": 7,
        "endLine": 37,
        "endChar": 22
      },
      "revId": "e7fa54127f4010ec016173d449ad4eb1778f93ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4abbea2_264d4448",
        "filename": "libnativeloader/test/src/android/test/app/ProductAppTest.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-11-28T21:44:06Z",
      "side": 1,
      "message": "Ok, I\u0027ll do some local runs with cuttlefish images to verify this works there too. You\u0027re right it works nicely on sargo, sunfish and redfin on S (http://android-build/abtd/run/L33400030000514738/ - the errors are in other tests).\n\n\u003e The failure of sunfish in b/308228277 is caused by a different reason\n\nNot sure what sunfish failure you mean, I can\u0027t see any in that ticket. It\u0027s only sargo. But yes, there are two unrelated failures at play here.\n\n\u003e I think it is required to use skipPublicProductLibTests() for all product related tests\n\nPublic libraries in /product is one thing, apps and shared libs in /product are other things. This test tries to cover many combinations of these aspects, so if some checks don\u0027t work I prefer to disable them individually and only when necessary.\n\nIf this works in cuttlefish from sc-dev and sc-v2-dev I\u0027m inclined to leave it like this.",
      "parentUuid": "7dd432b7_880fd149",
      "range": {
        "startLine": 35,
        "startChar": 7,
        "endLine": 37,
        "endChar": 22
      },
      "revId": "e7fa54127f4010ec016173d449ad4eb1778f93ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6f1f9ae1_a302ac96",
        "filename": "libnativeloader/test/src/android/test/app/ProductAppTest.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1146974
      },
      "writtenOn": "2023-11-29T07:09:03Z",
      "side": 1,
      "message": "\u003e Not sure what sunfish failure you mean, I can\u0027t see any in that ticket. \n\nI was referring to `testProductApp` in http://android-build/test_investigate/?testResultId\u003dTR19929019824997472\u0026invocationId\u003dI20200010211127356\nIn case of sunfish, the test will not be disabled even with the current `skipPublicProductLibTests()` guard.\n\n\u003e if some checks don\u0027t work I prefer to disable them individually and only when necessary.\nIf this works in cuttlefish from sc-dev and sc-v2-dev I\u0027m inclined to leave it like this.\n\nLGTM",
      "parentUuid": "a4abbea2_264d4448",
      "range": {
        "startLine": 35,
        "startChar": 7,
        "endLine": 37,
        "endChar": 22
      },
      "revId": "e7fa54127f4010ec016173d449ad4eb1778f93ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}