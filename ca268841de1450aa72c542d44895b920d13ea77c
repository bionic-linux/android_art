{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d87c57fc_1cc65432",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1889741
      },
      "writtenOn": "2022-11-24T09:35:58Z",
      "side": 1,
      "message": "We can construct a case where we have `If(Phi(0,4))` in DCE which gets optimized to `If(0)` and `If(4)` (see .smali code in 2246-). We then crash since we expect only `0` or `1` values. This wasn\u0027t detected by graph checker in earlier passes since the `4` was an input to a `Phi` (https://cs.android.com/android/platform/superproject/+/master:art/compiler/optimizing/graph_checker.cc;l\u003d981;drc\u003d434d968b4af0bc8af9889170250bee3e08839bea).\n\nSo, we must consider IntConstants which are neither `0` nor `1` and the question is how to interpret them. One possibility is to use `0` as `false` and the rest as `true`. This is how the code behaves when calling `booleanValueOf(Z)` in .smali with int values, even in tip of tree.\n\nAs a note, I think that we can still guarantee that `DataType::Type::kBool` values are going to be only `0` or `1` (The Phi has `kInt32` type).",
      "revId": "ca268841de1450aa72c542d44895b920d13ea77c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}