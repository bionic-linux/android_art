{
  "comments": [
    {
      "key": {
        "uuid": "e09eb33f_122beb34",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-07-02T08:32:25Z",
      "side": 1,
      "message": "I\u0027m having a hard time parsing what you\u0027re saying here. You do not want to wait for speed-profile of the secondary dex files which will happen in idle maintenance? Or are you saying our idle maintenance job does not work for secondary dex files?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e5d1e41f_d5a46df6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1206688
      },
      "writtenOn": "2018-07-02T11:14:06Z",
      "side": 1,
      "message": "\u003e\u003eOr are you saying our idle maintenance job does not work for secondary dex files?\nYes",
      "parentUuid": "e09eb33f_122beb34",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d78d3e2e_e6b487b8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2018-07-02T18:12:23Z",
      "side": 1,
      "message": "We are not aware of issues in this area.\n\nCould you please clarify what is your expectation and what you think it\u0027s not working?\n\n(As it is, this CL should not go in)",
      "parentUuid": "e5d1e41f_d5a46df6",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f6d894ee_eb4f571a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1206688
      },
      "writtenOn": "2018-07-03T01:43:40Z",
      "side": 1,
      "message": "\u003e\u003eCould you please clarify what is your expectation\nFor example, Wechat apk\u0027s \"/data/data/com.tencent.mm/tinker/patch-9e1ea20f/dex/oat/arm/tinker_classN.odex\" should be compiled with speed or speed-profile rather than quicken.\n\n\u003e\u003ewhat you think it\u0027s not working\nAs this commit message, Plugin dex(/data/data/pkg_path/*.odex) of these APKs were compiled with quicken even though we used \"adb shell cmd package compile -m speed -f package_name\".\nWe expected these APKs should be compiled with speed after we used \"adb shell cmd package compile -m speed -f package_name\".\n\nWechat apk link:\nhttps://wechat.en.uptodown.com/android",
      "parentUuid": "d78d3e2e_e6b487b8",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "33112017_66feefaa",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-07-03T09:01:03Z",
      "side": 1,
      "message": "\u003e \u003e\u003eCould you please clarify what is your expectation\n\u003e For example, Wechat apk\u0027s \"/data/data/com.tencent.mm/tinker/patch-9e1ea20f/dex/oat/arm/tinker_classN.odex\" should be compiled with speed or speed-profile rather than quicken.\n\nIt will be compiled speed-profile after the background dameon kicks in.\n\n\u003e \n\u003e \u003e\u003ewhat you think it\u0027s not working\n\u003e As this commit message, Plugin dex(/data/data/pkg_path/*.odex) of these APKs were compiled with quicken even though we used \"adb shell cmd package compile -m speed -f package_name\".\n\u003e We expected these APKs should be compiled with speed after we used \"adb shell cmd package compile -m speed -f package_name\".\n\nI believe this will only compile the primary base apk. You need to add --secondary-dex to your command.\n\n\u003e \n\u003e Wechat apk link:\n\u003e https://wechat.en.uptodown.com/android",
      "parentUuid": "f6d894ee_eb4f571a",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "846bae9e_a2e2a697",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1206688
      },
      "writtenOn": "2018-07-03T14:25:53Z",
      "side": 1,
      "message": "We still get the same results after added --secondary-dex.\nDid I do something wrong?\n\nTest results:\n$ adb shell cmd package compile --secondary-dex -m speed -f com.tencent.mm\nSuccess\n\n$ adb.exe -s 0123456789ABCDEF  shell find /data/data -name \u0027*.odex\u0027\n/data/data/com.tencent.mm/tinker/patch-9e1ea20f/dex/oat/arm/tinker_classN.odex\n/data/data/com.tencent.mm/app_xwalk_155/extracted_xwalkcore/oat/arm/classes.odex\n\nadb.exe -s 0123456789ABCDEF  shell oatdump --header-only --oat-file\u003d/data/data/com.tencent.mm/tinker/patch-9e1ea20f/dex/oat/arm/tinker_classN.odex\noat: /data/data/com.tencent.mm/tinker/patch-9e1ea20f/dex/oat/arm/tinker_classN.odex, compiler-filter \u003d quicken\nadb.exe -s 0123456789ABCDEF  shell oatdump --header-only --oat-file\u003d/data/data/com.tencent.mm/app_xwalk_155/extracted_xwalkcore/oat/arm/classes.odex\noat: /data/data/com.tencent.mm/app_xwalk_155/extracted_xwalkcore/oat/arm/classes.odex, compiler-filter \u003d quicken",
      "parentUuid": "33112017_66feefaa",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a08f716_2fb8d37f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2018-07-03T14:33:07Z",
      "side": 1,
      "message": "In order for the command to work the file must first be used. That means that the app needs to load it with standard class loaders (DexClassLoader, PathClassLoader or DelegateLastClassLoader). If the app uses custom class loaders the file might not be discovered/processed by the platform.\n\nYou can use \u0027adb shell dumpsys package dexopt\u0027 command to see what the platform know about each app\u0027s dex files.",
      "parentUuid": "846bae9e_a2e2a697",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2ec7e265_4fff3afb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1206688
      },
      "writtenOn": "2018-07-04T01:56:35Z",
      "side": 1,
      "message": "\u003e If the app uses custom class loaders the file might not be discovered/processed by the platform.\n\nDoes have methods which can resolve the case? \nThese dex files of custom class loader might cause app launch time bad.\nIf we can optimize all dex files, app launch time will get improvement.\n\nPrimary base.apk is speed indeed.\n$ adb shell dumpsys package dexopt\n  [com.tencent.mm]\n    path: /data/app/com.tencent.mm-rAd8lIXAPHDN_1brnXbwuA\u003d\u003d/base.apk\n      arm: /data/app/com.tencent.mm-rAd8lIXAPHDN_1brnXbwuA\u003d\u003d/oat/arm/base.odex[status\u003dkOatUpToDate, compilation_filter\u003ds\n      peed]",
      "parentUuid": "5a08f716_2fb8d37f",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "280765db_68439cd5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-07-04T07:50:19Z",
      "side": 1,
      "message": "AOT and custom class loaders are inherently unsafe, and we prefer correctness. In order to get the performance back, apps need to use 1st class supported class loaders like PathClassLoader.",
      "parentUuid": "2ec7e265_4fff3afb",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "45469d11_443df229",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1206688
      },
      "writtenOn": "2018-07-04T08:35:25Z",
      "side": 1,
      "message": "\u003e AOT and custom class loaders are inherently unsafe, and we prefer correctness.\n\nWe agreed your point. May we know about the unsafe issue?\nIf we know the unsafe issue detail, we can report to APK company and ask them to fix the issues.",
      "parentUuid": "280765db_68439cd5",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "380dad18_f55dfd80",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-07-04T08:40:21Z",
      "side": 1,
      "message": "Custom class loaders are implemented by the app, and can decide to change the assumptions we\u0027ve made in AOT about class layout, class hierarchy, etc. Such changes can make the AOT code crash.",
      "parentUuid": "45469d11_443df229",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b96bdac0_b2d8d0d6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1206688
      },
      "writtenOn": "2018-07-04T11:25:51Z",
      "side": 1,
      "message": "Does \"the AOT code crash\" mean dex2oat?\nIf it is dex2oat crash, the result is the app can\u0027t get correct dex code to execute, and then the app crash, right?\nJiagu may be the case. Most China APK contained Jiagu. To ask these APK companies don\u0027t use Jiagu that is difficult.\nCould we do both optimizing all secondary dex files and handling \"the AOT code crash\"?",
      "parentUuid": "380dad18_f55dfd80",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39025cb3_d5a93a7d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2018-07-04T11:36:05Z",
      "side": 1,
      "message": "No it won\u0027t be a dex2oat crash. It will be a runtime crash.",
      "parentUuid": "b96bdac0_b2d8d0d6",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 12,
        "endChar": 22
      },
      "revId": "32df1ede9a0ce7bdd244cb65e606d1d651e69cd9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}