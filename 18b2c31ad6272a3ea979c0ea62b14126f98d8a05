{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4e2d1215_858625c0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-03-14T21:16:27Z",
      "side": 1,
      "message": "From the looks of it, it\u0027s all the internal libs in art_runtime_base_broken_native_shared_libs, not just libdexfile. E.g. libart-compiler isn\u0027t a dependency of it.",
      "range": {
        "startLine": 9,
        "startChar": 50,
        "endLine": 9,
        "endChar": 63
      },
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9ceb411e_4128aab2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2023-03-14T22:09:19Z",
      "side": 1,
      "message": "Updated the commit message.",
      "parentUuid": "4e2d1215_858625c0",
      "range": {
        "startLine": 9,
        "startChar": 50,
        "endLine": 9,
        "endChar": 63
      },
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0aa58500_c3bdc388",
        "filename": "libdexfile/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-03-14T21:16:27Z",
      "side": 1,
      "message": "How come you need to add it to e.g. libprofiled and odrefreshd but not this (and several other) -d libraries?\n\n(In case it isn\u0027t clear, nearly all of ARTs internals have a -d and non-d variant of the same thing. The two sets of libs and binaries shouldn\u0027t depend on each other.)",
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ea05280a_83ca6495",
        "filename": "libdexfile/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2023-03-14T22:09:19Z",
      "side": 1,
      "message": "I believe it is be because these modules only require the stubs of their dependencies and one of:\n- their reverse dependencies only need their stubs\n- these modules have no stubs, so are always linked against by source.\n\nI think in this case specifically it\u0027s the latter reason, `libdexfile` has stubs but `libdexfiled` does not, so it uses source all the time regardless. But with `libdexfile` we have to mess with the `apex_available` values to ensure its source is used.\n\nThere are also some modules like `profmand` that only list `com.android.art.debug` in their `apex_available`, so they already deviate from the `apex_available` of most modules which list both `com.android.art` and `com.android.art.debug`.\n\nI did `mm` to build all the modules in this directory and it passed without changing these modules.",
      "parentUuid": "0aa58500_c3bdc388",
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed8a2699_74a800b8",
        "filename": "libdexfile/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-03-15T21:07:07Z",
      "side": 1,
      "message": "\u003e and it passed without changing these modules.\n\nSure, I was actually more concerned that the changes in the -d modules aren\u0027t actually needed, and that they got changed here by mistake. So in other words, do you need to change libprofiled, odrefreshd, and libartd? If not, let\u0027s avoid that since it may be confusing later.",
      "parentUuid": "ea05280a_83ca6495",
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1fce8806_92d05aed",
        "filename": "runtime/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 671,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-03-14T21:16:27Z",
      "side": 1,
      "message": "This library isn\u0027t included in test_broken_com.android.art. It doesn\u0027t work without this line?",
      "range": {
        "startLine": 671,
        "startChar": 8,
        "endLine": 671,
        "endChar": 38
      },
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bd3360ca_419e952d",
        "filename": "runtime/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 671,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2023-03-14T22:09:19Z",
      "side": 1,
      "message": "No, because I had to add `test_broken_com.android.art` to `libart-broken`\u0027s dependencies so that they have the same `apex_available`. then after doing that, libart no longer has the same `apex_available` as its dependencies, because they\u0027re the same modules as `libart-broken`\u0027s dependencies. So ` test_broken_com.android.art` has to be added here as well.",
      "parentUuid": "1fce8806_92d05aed",
      "range": {
        "startLine": 671,
        "startChar": 8,
        "endLine": 671,
        "endChar": 38
      },
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "879ee31c_f8834672",
        "filename": "runtime/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 685,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-03-14T21:16:27Z",
      "side": 1,
      "message": "And the other way around here. If you by \"both modules have the same apex_available\nvalues\" mean that the complete lists need to be identical, regardless of the availability needs of the specific module, then please add a comment to this list and the one for libart above explaining why they include APEXes they aren\u0027t included in.",
      "range": {
        "startLine": 684,
        "startChar": 0,
        "endLine": 685,
        "endChar": 32
      },
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1bc1a30b_6cd9b617",
        "filename": "runtime/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 685,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2023-03-14T22:09:19Z",
      "side": 1,
      "message": "Yes, the apex_available lists must be identical. I added comments and rephrased the commit message, but it should noted that we already had a very similar comment on many of the art modules already:\n\n```\n// TODO(b/183882457): This lib doesn\u0027t go into com.android.art, but\n// apex_available lists need to be the same for internal libs to avoid\n// stubs, and libartd depends on this.\n```",
      "parentUuid": "879ee31c_f8834672",
      "range": {
        "startLine": 684,
        "startChar": 0,
        "endLine": 685,
        "endChar": 32
      },
      "revId": "18b2c31ad6272a3ea979c0ea62b14126f98d8a05",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}