{
  "comments": [
    {
      "key": {
        "uuid": "74f4702c_58c25021",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 9
      },
      "lineNbr": 52,
      "author": {
        "id": 1275554
      },
      "writtenOn": "2020-02-18T22:25:45Z",
      "side": 1,
      "message": "As I mentioned, how about using MADV_FREE for 4.12+ because MADV_FREE in old verions(4.5 ~ 4.11) fallback to MADV_DONTNEED in kernel unless system has swap. However, from 4.12, regardless of swap existence, MADV_FREE will work without fallback MADV_DONTNEED. Moreover, from 4.12, we uses file lru to reclaim MADV_FREE pages instead of anon lru, which ends up reclaim easier.",
      "range": {
        "startLine": 52,
        "startChar": 25,
        "endLine": 52,
        "endChar": 48
      },
      "revId": "065803c38ead47c6e10b83e3ff48c66adc61ebae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3f51c48f_684b4bf5",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 9
      },
      "lineNbr": 52,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2020-02-18T22:46:44Z",
      "side": 1,
      "message": "I checked on Pixel 3 devices, which have kernel 4.9. But they also have swap, so it works. The performance improvement on Pixel 3 devices confirms this. Also, even if we use MADV_FREE on a \u003c4.12 kernel with no swap, it will anyway work as MADV_DONTNEED.\n\nIf you still think that it should be enabled only after",
      "parentUuid": "74f4702c_58c25021",
      "range": {
        "startLine": 52,
        "startChar": 25,
        "endLine": 52,
        "endChar": 48
      },
      "revId": "065803c38ead47c6e10b83e3ff48c66adc61ebae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1fbb12a7_4c9d3bba",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 9
      },
      "lineNbr": 52,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2020-02-18T23:05:00Z",
      "side": 1,
      "message": "Sorry for the typo.\n\nI meant to say, If you still think that it should be enabled only on \u003e\u003d4.12, then will do so.",
      "parentUuid": "3f51c48f_684b4bf5",
      "range": {
        "startLine": 52,
        "startChar": 25,
        "endLine": 52,
        "endChar": 48
      },
      "revId": "065803c38ead47c6e10b83e3ff48c66adc61ebae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a562ecbf_533a3a93",
        "filename": "libartbase/base/mem_map.cc",
        "patchSetId": 9
      },
      "lineNbr": 52,
      "author": {
        "id": 1275554
      },
      "writtenOn": "2020-02-19T00:33:45Z",
      "side": 1,
      "message": "Personally, I think that would be better with 4.12+ for start because it would make less noise across vendors which someone has swap, the others has no swap. Once we verify the upside in heavy memory pressure system(because 4.9 kernel is more popular in less memory system compared to 4.14), maybe we could backport the feature for swapless MADV_FREE to common kernel 4.9 if common kernel team still accepts it to 4.9 kernel. Ccing Suren and Tim to hear opinions.",
      "parentUuid": "1fbb12a7_4c9d3bba",
      "range": {
        "startLine": 52,
        "startChar": 25,
        "endLine": 52,
        "endChar": 48
      },
      "revId": "065803c38ead47c6e10b83e3ff48c66adc61ebae",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}