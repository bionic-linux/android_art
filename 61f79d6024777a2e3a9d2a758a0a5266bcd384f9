{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "084c2e46_1ffe8326",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-19T07:27:43Z",
      "side": 1,
      "message": "I think CL is ready for review. Can you please take a look? Thanks!",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "550ecd16_c7ffb141",
        "filename": "runtime/art_method-inl.h",
        "patchSetId": 7
      },
      "lineNbr": 624,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-19T16:45:54Z",
      "side": 1,
      "message": "Add a comment why you\u0027re also going through the JIT.",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "55c95add_81fb872b",
        "filename": "runtime/art_method-inl.h",
        "patchSetId": 7
      },
      "lineNbr": 624,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T09:01:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "550ecd16_c7ffb141",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "86a97e5a_bf124ee9",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 449,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-19T16:45:54Z",
      "side": 1,
      "message": "Don\u0027t we expect all entries here to be marked?",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b858c9fc_a6a55b35",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 449,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T09:01:58Z",
      "side": 1,
      "message": "`VisitRootTables` only touches `method_types_`. Here we update `method_code_map_`.",
      "parentUuid": "86a97e5a_bf124ee9",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ed5ec1c_b6e5f3a1",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 449,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-20T12:07:59Z",
      "side": 1,
      "message": "Sure, but the objects should be live given the ArtMethod was live. So similar to line 437, I think you can DCHECK that `new_method_type` is no null.",
      "parentUuid": "b858c9fc_a6a55b35",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7d6d130b_3250f9c3",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 449,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T12:30:29Z",
      "side": 1,
      "message": "Got it, done.",
      "parentUuid": "0ed5ec1c_b6e5f3a1",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f8650671_23b5811f",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 777,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-19T16:45:54Z",
      "side": 1,
      "message": "Add a comment what is happening here.",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fad4de9c_81dca416",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 777,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T09:01:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f8650671_23b5811f",
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f4e0fa6_b017359d",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 944,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-19T16:45:54Z",
      "side": 1,
      "message": "add a comment what happens here.",
      "range": {
        "startLine": 938,
        "startChar": 0,
        "endLine": 944,
        "endChar": 3
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "007b6526_7099c583",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 944,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T09:01:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2f4e0fa6_b017359d",
      "range": {
        "startLine": 938,
        "startChar": 0,
        "endLine": 944,
        "endChar": 3
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10bfb297_14a5f137",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 1153,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-19T16:45:54Z",
      "side": 1,
      "message": "You\u0027re doing this in `RemoveMethodsIn`. Mabye just mention that we could also look at clearing them here, but we\u0027re not bothering?",
      "range": {
        "startLine": 1152,
        "startChar": 54,
        "endLine": 1153,
        "endChar": 19
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f8158d3c_777f2d34",
        "filename": "runtime/jit/jit_code_cache.cc",
        "patchSetId": 7
      },
      "lineNbr": 1153,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T09:01:58Z",
      "side": 1,
      "message": "Thanks, done.",
      "parentUuid": "10bfb297_14a5f137",
      "range": {
        "startLine": 1152,
        "startChar": 54,
        "endLine": 1153,
        "endChar": 19
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7285b415_a0535b86",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-19T16:45:54Z",
      "side": 1,
      "message": "Why a multimap and not a std::map\u003cArtMethod, std::set\u003c...\u003e\u003e ?",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "fixSuggestions": [
        {
          "fixId": "5c4f3ab5_0dc38ca7",
          "description": "prompt_to_edit API",
          "replacements": [
            {
              "path": "runtime/jit/jit_code_cache.h",
              "range": {
                "startLine": 558,
                "startChar": 0,
                "endLine": 559,
                "endChar": 0
              },
              "replacement": "  std::unordered_map\u003cArtMethod*, GcRoot\u003cmirror::MethodType\u003e\u003e method_types_ GUARDED_BY(Locks::jit_lock_);\n"
            }
          ]
        }
      ],
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6aa5a4f7_b2336565",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T09:01:58Z",
      "side": 1,
      "message": "It seems that `GcRoot` is not comparable. Am I doing something wrong?",
      "parentUuid": "7285b415_a0535b86",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17102542_c4d7f571",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-20T12:07:59Z",
      "side": 1,
      "message": "What error do you get?",
      "parentUuid": "6aa5a4f7_b2336565",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89d818cb_48af7fca",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T12:30:29Z",
      "side": 1,
      "message": "I changed its type to `SafeMap\u003cArtMethod*, std::set\u003cGcRoot\u003cmirror::MethodType\u003e\u003e\u003e` and updated `JitCodeCache::Commit` part into \n```\n        auto mt_roots \u003d std::set\u003cGcRoot\u003cmirror::MethodType\u003e\u003e();\n        \n        for (auto root : roots) {\n          ObjPtr\u003cmirror::Class\u003e klass \u003d root-\u003eGetClass\u003ckDefaultVerifyFlags, kWithoutReadBarrier\u003e();\n          if (klass \u003d\u003d method_type_class ||\n              klass \u003d\u003d ReadBarrier::IsMarked(method_type_class.Ptr()) ||\n              ReadBarrier::IsMarked(klass.Ptr()) \u003d\u003d method_type_class) {\n            ObjPtr\u003cmirror::MethodType\u003e mt \u003d ObjPtr\u003cmirror::MethodType\u003e::DownCast(root.Get());\n            mt_roots.insert(GcRoot(mt));\n          }\n        }\n\n        method_types_.find(method)-\u003esecond.insert(mt_roots.begin(), mt_roots.end());\n```\n\nAnd in this case error I get is\n```\ne/libartd-runtime/linux_glibc_x86_64_static/ca20aeb40531de8f5d4d80e90f476059/obj/art/runtime/jit/jit_code_cache.o art/runtime/jit/jit_code_cache.cc\nIn file included from art/runtime/jit/jit_code_cache.cc:17:\nIn file included from art/runtime/jit/jit_code_cache.h:22:\nIn file included from prebuilts/clang/host/linux-x86/clang-r522817/include/c++/v1/memory:939:\nIn file included from prebuilts/clang/host/linux-x86/clang-r522817/include/c++/v1/__memory/shared_ptr.h:19:\nprebuilts/clang/host/linux-x86/clang-r522817/include/c++/v1/__functional/operations.h:358:16: error: invalid operands to binary expression (\u0027const art::GcRoot\u003cart::mirror::MethodType\u003e\u0027 and \u0027const art::GcRoot\u003cart::mirror::MethodType\u003e\u0027)\n```\n\nFull logs: gpaste/6211559403814912",
      "parentUuid": "17102542_c4d7f571",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab81b28c_a648f22f",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-20T12:31:59Z",
      "side": 1,
      "message": "Is it complaining about the `insert` or the declaration of `mt_roots` ?",
      "parentUuid": "89d818cb_48af7fca",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "678824b8_7c2feeb0",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-20T13:28:52Z",
      "side": 1,
      "message": "It complains about any `insert` operation to `std::set\u003cGcRoot\u003cMethodType\u003e\u003e`.",
      "parentUuid": "ab81b28c_a648f22f",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fe93a640_ffedfaf5",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2024-06-20T14:03:46Z",
      "side": 1,
      "message": "Can you try with plain pointers for now?",
      "parentUuid": "678824b8_7c2feeb0",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e743025_8a9f5c6f",
        "filename": "runtime/jit/jit_code_cache.h",
        "patchSetId": 7
      },
      "lineNbr": 558,
      "author": {
        "id": 1793992
      },
      "writtenOn": "2024-06-21T10:30:32Z",
      "side": 1,
      "message": "Keyed it by `const void*` as discussed offline.",
      "parentUuid": "fe93a640_ffedfaf5",
      "range": {
        "startLine": 558,
        "startChar": 7,
        "endLine": 558,
        "endChar": 15
      },
      "revId": "61f79d6024777a2e3a9d2a758a0a5266bcd384f9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}