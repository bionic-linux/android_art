{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "784f48e7_c6a43b2d",
        "filename": "test/generate-boot-image/generate-boot-image.cc",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2023-03-16T10:56:40Z",
      "side": 1,
      "message": "If the condition in compiler_driver.cc is `compiler_options.GetProfileCompilationInfo() !\u003d nullptr \u0026\u0026 !compiler_options.GetProfileCompilationInfo()-\u003eIsEmpty()`, using \"verify\" here will still be good because we always pass a profile, right?",
      "range": {
        "startLine": 114,
        "startChar": 33,
        "endLine": 114,
        "endChar": 46
      },
      "revId": "847da27594e23364ba61e77acbf4f8c33a467f95",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09427251_fa9b4507",
        "filename": "test/generate-boot-image/generate-boot-image.cc",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2023-03-16T11:18:13Z",
      "side": 1,
      "message": "Some gtests have various expectations on the boot image generated by speed compiling. I\u0027m trying to accomodate that to minimize the CL.",
      "parentUuid": "784f48e7_c6a43b2d",
      "range": {
        "startLine": 114,
        "startChar": 33,
        "endLine": 114,
        "endChar": 46
      },
      "revId": "847da27594e23364ba61e77acbf4f8c33a467f95",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5bafc443_1bbe0377",
        "filename": "test/generate-boot-image/generate-boot-image.cc",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2023-03-16T13:06:48Z",
      "side": 1,
      "message": "\u003e Some gtests have various expectations on the boot image generated by speed compiling.\n\nYes, that is true. I override the compiler filter [for chroot tests](https://cs.android.com/android/platform/superproject/+/master:art/tools/buildbot-sync.sh;l\u003d158;drc\u003d513801a31b69c4cf9397a85afd570a4c02b1f914) and [for some standalone gtests](https://cs.android.com/search?q\u003dgenerate-boot-image%20%22--compiler-filter%3Dspeed-profile%22%20lang:xml\u0026sq\u003d) as a solution. Changing the default to \"speed-profile\" will make standalone gtests very slow because `generate-boot-image` is called before every standalone gtest. The default \"verify\" filter here is for most of the standalone gtests, which don\u0027t have expectations on compiled code, and the tests pass with the \"verify\" filter. If the tests start to fail after this change, does it reveal a real problem with this change (that the condition should be what I proposed above to be more accurate than `IsAotCompilationEnabled`?",
      "parentUuid": "09427251_fa9b4507",
      "range": {
        "startLine": 114,
        "startChar": 33,
        "endLine": 114,
        "endChar": 46
      },
      "revId": "847da27594e23364ba61e77acbf4f8c33a467f95",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "059f8e06_774aeecb",
        "filename": "test/generate-boot-image/generate-boot-image.cc",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2023-03-16T13:08:56Z",
      "side": 1,
      "message": "So we want \"verify\" to not initialize classes anymore for the mainline extension. However, some tests do expect that. I could add a boot image extension check to special case it for the mainline extension if you prefer?",
      "parentUuid": "5bafc443_1bbe0377",
      "range": {
        "startLine": 114,
        "startChar": 33,
        "endLine": 114,
        "endChar": 46
      },
      "revId": "847da27594e23364ba61e77acbf4f8c33a467f95",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3bf6ed97_c3134cda",
        "filename": "test/generate-boot-image/generate-boot-image.cc",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2023-03-16T13:54:44Z",
      "side": 1,
      "message": "We want \"verify\" to not initialize classes anymore for the mainline extension, but we still want \"verify\" to initialize classes if a profile is passed.\n\n`generate-boot-image` passes a profile even if the compiler filter is \"verify\", so the classes are supposed to be initilaized. If classes are not initialized, that sounds like a real problem to me.\n\nI think the issue can be fixed by changing the condition in compiler_driver.cc from `compiler_options.IsAotCompilationEnabled()` to `compiler_options.GetProfileCompilationInfo() !\u003d nullptr \u0026\u0026 !compiler_options.GetProfileCompilationInfo()-\u003eIsEmpty()`. That will keep the status quo, if I\u0027m not wrong.",
      "parentUuid": "059f8e06_774aeecb",
      "range": {
        "startLine": 114,
        "startChar": 33,
        "endLine": 114,
        "endChar": 46
      },
      "revId": "847da27594e23364ba61e77acbf4f8c33a467f95",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}