{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "52e90cd9_c50127f2",
        "filename": "libprofile/profile/profile_compilation_info.cc",
        "patchSetId": 2
      },
      "lineNbr": 823,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-02-21T11:23:14Z",
      "side": 1,
      "message": "I think installd also uses flock on these files, which is active when the legacy implementation is used: http://cs/android-internal/frameworks/native/cmds/installd/dexopt.cpp;l\u003d198;rcl\u003d73c728e883c8f300623b00cd84b25f79e8e3c5b6 So don\u0027t we need to go into the legacy code path when dalvik.vm.useartservice isn\u0027t true?",
      "range": {
        "startLine": 820,
        "startChar": 0,
        "endLine": 823,
        "endChar": 3
      },
      "revId": "ea2c68d27e583cad5166fced930429f1752fc5aa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cec20d51_fb6c202c",
        "filename": "libprofile/profile/profile_compilation_info.cc",
        "patchSetId": 2
      },
      "lineNbr": 823,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2023-02-21T11:47:46Z",
      "side": 1,
      "message": "No, this change doesn\u0027t rely on the implementation on the other side. The other side can still acquire a flock. I added this fallback just for the SELinux policy limitation.",
      "parentUuid": "52e90cd9_c50127f2",
      "range": {
        "startLine": 820,
        "startChar": 0,
        "endLine": 823,
        "endChar": 3
      },
      "revId": "ea2c68d27e583cad5166fced930429f1752fc5aa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7680446_95165fb8",
        "filename": "libprofile/profile/profile_compilation_info.cc",
        "patchSetId": 2
      },
      "lineNbr": 823,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-02-21T13:10:27Z",
      "side": 1,
      "message": "Locks are a two way street. The code in installd is presumably written with the assumption that no other code changes the profile while it holds the flock. I think you\u0027ll have to motivate better that this change doesn\u0027t break that.",
      "parentUuid": "cec20d51_fb6c202c",
      "range": {
        "startLine": 820,
        "startChar": 0,
        "endLine": 823,
        "endChar": 3
      },
      "revId": "ea2c68d27e583cad5166fced930429f1752fc5aa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "faeb9a54_1d5d08ac",
        "filename": "libprofile/profile/profile_compilation_info.cc",
        "patchSetId": 2
      },
      "lineNbr": 823,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2023-02-21T13:20:26Z",
      "side": 1,
      "message": "Although I\u0027d much prefer just adding the check so we keep adhering to the compat behaviour in this case and don\u0027t have to scrutinise the legacy code for subtle pitfalls.",
      "parentUuid": "c7680446_95165fb8",
      "range": {
        "startLine": 820,
        "startChar": 0,
        "endLine": 823,
        "endChar": 3
      },
      "revId": "ea2c68d27e583cad5166fced930429f1752fc5aa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}