{
  "comments": [
    {
      "key": {
        "uuid": "3cb49adb_4e8ad8d3",
        "filename": "libartpalette/system/palette_android.cc",
        "patchSetId": 1
      },
      "lineNbr": 116,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2019-04-11T08:04:38Z",
      "side": 1,
      "message": "After WriteFully the earlier version follows up with FlushCloseOrErase() / Erase().\n\nIs it possible that the file is not fully present on secondary store before tombstoned is notified?",
      "range": {
        "startLine": 116,
        "startChar": 17,
        "endLine": 116,
        "endChar": 68
      },
      "revId": "7c018c94d454b818ac08870acad5040968f8058d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f8a89927_7426b88f",
        "filename": "libartpalette/system/palette_android.cc",
        "patchSetId": 1
      },
      "lineNbr": 116,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-04-11T12:30:11Z",
      "side": 1,
      "message": "Oops, the close call fell off, thanks.\n\nAs for flushing, this is a unix socket so afaict the fsync done in Erase etc won\u0027t do anything on it. If this socket API needs synchronisation between output_fd and tombstone_fd, then I think it\u0027d have to be done some other way (unless sockets behave differently in Bionic).",
      "parentUuid": "3cb49adb_4e8ad8d3",
      "range": {
        "startLine": 116,
        "startChar": 17,
        "endLine": 116,
        "endChar": 68
      },
      "revId": "7c018c94d454b818ac08870acad5040968f8058d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "40bfc9e8_a688927d",
        "filename": "libartpalette/system/palette_android.cc",
        "patchSetId": 1
      },
      "lineNbr": 116,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2019-04-11T12:53:13Z",
      "side": 1,
      "message": "Perhaps a comment here is necessary too as naively it looks like the earlier code assumed output_fd is a file descriptor passed by unix socket. It would either be properly flushed to disk or truncated to zero length.",
      "parentUuid": "f8a89927_7426b88f",
      "range": {
        "startLine": 116,
        "startChar": 17,
        "endLine": 116,
        "endChar": 68
      },
      "revId": "7c018c94d454b818ac08870acad5040968f8058d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c1dad09_39c9d697",
        "filename": "libartpalette/system/palette_android.cc",
        "patchSetId": 1
      },
      "lineNbr": 116,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2019-04-11T14:15:57Z",
      "side": 1,
      "message": "You\u0027re right, it might very well be a disk fd.\n\n(If we are to be rigorous though I can\u0027t find anything explicit about that flushing to storage gives any particular guarantees about the data being available to another process after this point - except if a reboot happens in between.)",
      "parentUuid": "40bfc9e8_a688927d",
      "range": {
        "startLine": 116,
        "startChar": 17,
        "endLine": 116,
        "endChar": 68
      },
      "revId": "7c018c94d454b818ac08870acad5040968f8058d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}